{"version":3,"sources":["defs.js","training_experiment/info.js","audio_controller.js","ui.js","randomize.js","training_experiment/lesson_block.js","training_experiment/training_block.js","spreadsheet_io.js","sessions.js","training_experiment/TrainingExperiment.js","serviceWorker.js","index.js"],"names":["LessonType","MUSICAL_PIECES","TONAL_CONTEXT","AUTOMATIC","Chords","BIG_MAJOR","SMALL_MAJOR","SMALL_MINOR","HALF_DIM","Timbres","StaticImages","Strings","SheetNames","musical_pieces_data","IntroText","className","InfoText","lesson_type","imgSrc","name","audioIdx2File","idx","AudioController","srcs","onDoneLoading","onAudioEnded","this","players","ids2players","players2ids","id","playerIdx","length","p","Audio","addEventListener","e","audioLoaded","push","loadCount","player","audio_id","play","LoadingScreen","ErrorScreen","error","InfoScreen","info","next","disabled","ContinueButton","type","onClick","shuffleArray","arr","map","a","Math","random","sort","b","randomSequence","items","count","ln","i","repeatArray","lesson_data","musical_pieces","tonal_context","automatic","NameOfChord","props","chordName","description","SongWithoutChords","songData","src","alt","LessonPart","part","session","state","trial_idx","done_playing","done_loading","trials_per_part","part_data","ls_prefix","continued","sequence","ls","get","set","console","log","that","audioController","d","setState","screen","button","React","Component","InfoBeforeLessonPartC","LessonBlock","data","steps","PART_A","PART_B","INFO","PART_C","DONE","step","nextStep","key","training_data","TrainingInfo","InfoBeforeTrainingPartB","InfoBeforeTrainingPartC","SuccessfulIdentification","width","height","ShowCorrectAnswer","correctChord","FailedIdentification","shouldShowCorrect","appendix","SongWithChords","chord_buttons","chord","gen_button","ChordSelection","with_song_names","label","TrainingPart","show_feedback","answer","response_start","Date","fail_show_correct","nextTrial","correct_audio_idx","trial","slice","filter","t","count_in_part","trial_data","chord_name","transposition","processAnswer","correct","td","time","toString","audio_index","chord_number","chord_type","transposition_play_count","get_transposition_play_count","selected_chord_type","response_time","trials","selected_audio_idx","song_data","TrainingBlock","INFO_A","INFO_B","INFO_C","read_url","parse_sheet_list","sheetNames","sheets","forEach","sheet","properties","title","gs","read","conn","sheetName","range","fetch","spreadsheet_id","api_key","write","Array","isArray","url","write_url","headers","method","mode","body","JSON","stringify","list_sheets","then","res","json","SessionEvent","SESSION_START","SESSION_CONTINUED","SESSION_END","parseSessions","sessions","values","session_event","number","event","writeSessionEvent","on_error","request_data","Object","assign","catch","readLessonType","response","row","parseInt","was_last_session_today","last_session","last_time","setHours","getHours","now","getDate","does_user_sheet_exists","user_id","includes","MAX_NUMBER_OF_SESSIONS","IntroScreen","hidden","document","getElementById","value","StartScreen","FinishScreen","done_saving","session_number","remaining","TrainingExperiment","INTRO","LESSON","TRAINING","FINISH","is_loading_session","did_check_user_registered","max_sessions_reached","session_done_for_today","user_unregistered","did_load_registration_list","did_load_lesson_type","undefined","maybe_start_session","previous_sessions","clear","err","last_session_number","continued_session","sessionEventError","continued_data","continued_step","stepWillChange","stepChanged","sheet_exists","sessionDataLoadError","end_time","start_time","dataSaveError","sessionDataLoaded","session_data","getScreenForStep","Boolean","window","location","hostname","match","ReactDOM","render","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.ef861087.chunk.js","sourcesContent":["export const LessonType = {\n  MUSICAL_PIECES: 0,\n  TONAL_CONTEXT: 1,\n  AUTOMATIC: 2,\n};\n\nexport const Chords = {\n  BIG_MAJOR: \"מז'ור גדול\",\n  SMALL_MAJOR: \"מז'ור קטן\",\n  SMALL_MINOR: \"מינור קטן\",\n  HALF_DIM:\"חצי מוקטן\"\n}\n\nexport const Timbres = {\n  PIANO: 0,\n  GUITAR: 1,\n}\n\nexport const StaticImages = {\n  happySmiley: \"static_images/happySmiley.jpg\",\n  sadSmiley: \"static_images/sadSmiley.png\",\n}\n\nexport const Strings = {\n  continue_text: \"המשך\",\n  success_identification: \"בחרת באקורד הנכון\",\n  failure_identification: \"בחרת באקורד הלא נכון\",\n  how_it_sounds: \"כך הוא נשמע\",\n  failure_song_has_chord:\"בשיר יש אקורד \",\n};\n\nexport const SheetNames = {\n  TRAINING_SESSIONS: \"TrainingSessions\",\n  LESSON_TYPES: \"LessonTypes\",\n}\n\n// For MUSICAL_CONTEXT lessons. A mapping of chord name to the image and song name that goes with it.\nexport let musical_pieces_data = {};\nmusical_pieces_data[Chords.BIG_MAJOR] = {\n  imgSrc: \"song_images/song1.png\",\n  name: \"Imagine\",\n};\nmusical_pieces_data[Chords.SMALL_MAJOR] = {\n  imgSrc: \"song_images/song2.png\",\n  name: \"הליכה לקיסריה\"\n};\nmusical_pieces_data[Chords.SMALL_MINOR] = {\n  imgSrc: \"song_images/song3.png\",\n  name: \"Rocket man\"\n};\nmusical_pieces_data[Chords.HALF_DIM] = {\n  imgSrc: \"song_images/song4.png\",\n  name: \"ברית עולם\"\n};\n","import React from 'react';\nimport { LessonType } from '../defs.js'\n\nexport function IntroText() {\n  return (\n    <div className = \"IntroText\">\n      <p>\n      לפניכם שיעור של 35 דקות. \n      לא ניתן לצאת במהלכו.\n      העבודה על הניסוי מחייבת חיבור אינטרנטי. עבודה ללא חיבור אינטרנטי תיפסל מהניסוי. \n      כמו כן, אנא הצטיידו באוזניות, לאחר שווידאתם עם הנסיינית (יעל) שהן איכותיות מספיק.\n      </p>\n      <p>\n      עליכם להפעיל את התוכנה פעם אחת בכל יום במשך חמישה ימים. לא תוכלו להפעילה יותר מפעם אחת ביום, אך עליכם לדאוג להפעילה בכל יום, ולסיים בכל הפעלה את ההדגמות והתרגילים (נתוני ההפעלה וההשתתפות יישלחו לנסיינית. התשלום על הניסוי מותנה בהקפדה על התנאים).\n      התחלת התוכנה מותנית בקביעת פגישה עם הנסיינית ליום השביעי. מי שטרם קבע פגישה, לא יכול להתחיל את העבודה בתוכנה.\n      </p>\n      <p>\n      אם ברצונכם להפעיל את התוכנה כעת, הכניסו את מספר תעודת הזהות שלכם ולחצו על המשך.\n      </p>\n    </div>);\n}\n\nexport function InfoText({lesson_type}) {\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    return (\n      <div className=\"infotext\">\n        <p>בניסוי זה תלמדו לזהות אקורדים מרובעים (בעלי ארבעה צלילים) משמיעה באמצעות קישורם לשירים ישראליים מוכרים.</p>\n        <p>לתוכנה שני חלקים – חלק השיעור וחלק התרגול. בחלק התרגול עליכם להקיש על האקורד המזוהה באמצעות עכבר המחשב.</p>\n        <p>אנא חברו אוזניות.</p>\n        <p>מיד תשמעו קטעים קצרים מתוך שירים ישראליים מוכרים. בכל קטע שתשמעו, האקורד הראשון יהיה האקורד המשמעותי, אליו עליכם להתייחס.</p>\n        <p>אנא קראו את הכיתוב המופיע על המסך לאורך כל השיעור.</p>\n        <p>לכל שאלה או בעיה, אנא שלחו הודעה כתובה למייל yaeljm@gmail.com או למספר הטלפון 0528931467, ותקבלו מענה בזריזות האפשרית.</p>\n        <p>בהצלחה!</p>\n      </div>\n    );\n\n  case LessonType.TONAL_CONTEXT:\n    return (\n      <div className=\"infotext\">\n        <p>בניסוי זה תלמדו לזהות אקורדים מרובעים (בעלי ארבעה צלילים) משמיעה באמצעות הקשר טונאלי: תחושת המתח או הפתרון הנובעת משמיעת אקורד בתוך משפט מוזיקלי.</p>\n        <p>לתוכנה שני חלקים – חלק השיעור וחלק התרגול. בחלק התרגול עליכם להקיש על האקורד המזוהה באמצעות עכבר המחשב.</p>\n        <p>אנא חברו אוזניות.</p>\n        <p>מיד תשמעו צמדי אקורדים. לפני כל צמד אקורדים תשמעו מבוא טונאלי – סולם עולה ויורד. בכל צמד אקורדים שתשמעו, האקורד הראשון יהיה האקורד המשמעותי, אליו עליכם להתייחס.</p>\n        <p>אנא קראו את הכיתוב המופיע על המסך לאורך כל השיעור.</p>\n        <p>לכל שאלה או בעיה, אנא שלחו הודעה כתובה למייל yaeljm@gmail.com או למספר הטלפון 0528931467, ותקבלו מענה בזריזות האפשרית.</p>\n        <p>בהצלחה!</p>\n      </div>\n    );\n\n  case LessonType.AUTOMATIC:\n    return (\n      <div className=\"infotext\">\n        <p>בניסוי זה תלמדו לזהות אקורדים מרובעים (בעלי ארבעה צלילים) משמיעה באמצעות זיהוי אוטומטי.</p>\n        <p>לתוכנה שני חלקים – חלק השיעור וחלק התרגול. בחלק התרגול עליכם להקיש על האקורד המזוהה באמצעות עכבר המחשב.</p>\n        <p>אנא חברו אוזניות.</p>\n        <p>מיד תישמעו אקורדים. </p>\n        <p>אנא קראו את הכיתוב המופיע על המסך לאורך כל השיעור.</p>\n        <p>לכל שאלה או בעיה, אנא שלחו הודעה כתובה למייל yaeljm@gmail.com או למספר הטלפון 0528931467, ותקבלו מענה בזריזות האפשרית.</p>\n        <p>בהצלחה!</p>\n      </div>\n    );\n  }\n}\n","let audioIdx2File = (idx) => \"audio/\" + idx + \".mp3\";\n\nexport class AudioController {\n  constructor(srcs, onDoneLoading, onAudioEnded) {\n    this.srcs = srcs;\n    this.players = [];\n    this.ids2players = {};\n    this.players2ids = {};\n    for (const id of this.srcs) {\n      const playerIdx = this.players.length;\n      this.ids2players[id] = playerIdx;\n      this.players2ids[playerIdx] = id;\n\n      const p = new Audio(audioIdx2File(id));\n      p.addEventListener('canplaythrough', (e => {this.audioLoaded(p)}), false);\n      p.addEventListener('ended', (e => {\n        if (this.onAudioEnded) this.onAudioEnded(id)\n      }), false);\n\n      this.players.push(p);\n    }\n\n    this.loadCount = 0;\n    this.onDoneLoading = onDoneLoading;\n    this.onAudioEnded = onAudioEnded;\n  }\n\n  audioLoaded(player) {\n    this.loadCount+=1;\n    if (this.loadCount === this.players.length) {\n      if (this.onDoneLoading) this.onDoneLoading();\n    }\n  }\n\n  play(audio_id) {\n    const playerIdx = this.ids2players[audio_id];\n    this.players[playerIdx].play();\n  }\n}\n","import React from 'react';\nimport { Strings } from './defs.js';\n\nexport const LoadingScreen = () => {\n  return <div className=\"containter text-center\"><p className=\"lead\">טוען...</p></div>;\n};\n\nexport const ErrorScreen = ({error}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-sm\">\n          <p>התרחשה שגיאה:</p>\n          <p className=\"lead center\">{error}</p>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport const InfoScreen = ({info, next}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-md-8 offset-md-2 infotext\">\n          {info}\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col\"></div>\n        <div className=\"col text-center\">\n          <br/>\n          <ContinueButton next={next} disabled={false} />\n        </div>\n        <div className=\"col\"></div>\n      </div>\n    </div>\n  );\n};\n\nexport const ContinueButton = ({next, disabled}) => {\n  return disabled ? \n    <button type=\"button\" className=\"btn btn-primary\" onClick={next} disabled>{Strings.continue_text}</button> :\n    <button type=\"button\" className=\"btn btn-primary\" onClick={next}>{Strings.continue_text}</button>;\n};\n","export function repeatArray(arr, count) {     \n  var ln = arr.length;\n  var b = [];\n  for(let i=0; i<count; i++) {      \n    b.push(arr[i%ln]);      \n  }\n      \n  return b;      \n}\n\nexport const shuffleArray = arr => arr\n  .map(a => [Math.random(), a])\n  .sort((a, b) => a[0] - b[0])\n  .map(a => a[1]);\n\nexport const randomSequence = (items, length) => shuffleArray(repeatArray(items, length));\n","import React from 'react';\nimport { musical_pieces_data, LessonType, Strings, Chords } from '../defs.js';\nimport { AudioController } from '../audio_controller.js';\nimport { InfoScreen, LoadingScreen, ContinueButton } from '../ui.js';\nimport { randomSequence } from '../randomize.js';\nimport ls from 'local-storage';\n\n// Recordings used in each lesson type and part. i.e. \n// for part 1 and musical_pieces lesson: lesson_data.musical_pieces[1]\nlet lesson_data = {\n  musical_pieces: [\n    [[1, Chords.BIG_MAJOR], [2, Chords.SMALL_MAJOR], [3, Chords.SMALL_MINOR], [4, Chords.HALF_DIM]],\n    [[5, Chords.BIG_MAJOR], [6, Chords.SMALL_MAJOR], [7, Chords.SMALL_MINOR], [8, Chords.HALF_DIM]],\n    [[9, Chords.BIG_MAJOR], [13, Chords.SMALL_MAJOR], [17, Chords.SMALL_MINOR], [21, Chords.HALF_DIM]],\n  ],\n  tonal_context: [\n    [[25, Chords.BIG_MAJOR], [26, Chords.SMALL_MAJOR], [27, Chords.SMALL_MINOR], [28, Chords.HALF_DIM]],\n    [[29, Chords.BIG_MAJOR], [30, Chords.SMALL_MAJOR], [31, Chords.SMALL_MINOR], [32, Chords.HALF_DIM]],\n    [[33, Chords.BIG_MAJOR], [35, Chords.SMALL_MAJOR], [37, Chords.SMALL_MINOR], [39, Chords.HALF_DIM],\n     [34, Chords.BIG_MAJOR], [36, Chords.SMALL_MAJOR], [38, Chords.SMALL_MINOR], [40, Chords.HALF_DIM]],\n  ],\n  automatic: [\n    [[9, Chords.BIG_MAJOR], [13, Chords.SMALL_MAJOR], [17, Chords.SMALL_MINOR], [21, Chords.HALF_DIM]],\n    [[41, Chords.BIG_MAJOR], [45, Chords.SMALL_MAJOR], [49, Chords.SMALL_MINOR], [53, Chords.HALF_DIM]],\n    [[41, Chords.BIG_MAJOR], [45, Chords.SMALL_MAJOR], [49, Chords.SMALL_MINOR], [53, Chords.HALF_DIM],\n     [9, Chords.BIG_MAJOR], [13, Chords.SMALL_MAJOR], [17, Chords.SMALL_MINOR], [21, Chords.HALF_DIM]],\n  ],\n};\n\n// The UI for AUTOMATIC and TONAL_CONTEXT lesson trials.\nconst NameOfChord = props => {\n  let { chordName, lesson_type } = props;\n  let description = \"\";\n  if (lesson_type === LessonType.TONAL_CONTEXT)\n    description = \"שם האקורד הראשון:\";\n  else if (lesson_type === LessonType.AUTOMATIC)\n    description = \"שם האקורד:\";\n\n  return (\n    <div className = \"row text-center successScreenWrapper\">\n      <div className=\"col-sm-8 offset-sm-2 align-middle\">\n        <span className=\"chordName\">\n          {description}\n        <br />\n        { chordName }\n        </span>\n      </div>\n    </div>\n  );\n};\n\n// The UI for MUSICAL_PIECES lesson trials.\nconst SongWithoutChords = props => {\n  let { chordName } = props;\n  let { songData } = props;\n  return(\n    <div className=\"songDisplayWrapper\">\n      <img className=\"songImage\" src={ songData.imgSrc } alt=\"\"/>\n      <div className=\"row\">\n        <div className=\"col text-center\">\n          <div className=\"songTitle\">\n            שם השיר:\n            <br/>\n            { songData.name }\n            <br/>\n            <br/>\n            שם האקורד:\n            <br/>\n            { chordName }\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n// This component represents one part of the lesson. There are 3 parts. The only difference \n// between them is the audio sequence. Audio playing code is here.\nclass LessonPart extends React.Component {\n  state = {\n    trial_idx: 0,\n    done_playing: false,\n    done_loading: false,\n  };\n\n  constructor({part, session, next}) {\n    super();\n    this.part = part;\n    this.next = next;\n    this.state.done_loading = false;\n    this.trials_per_part = 16;\n    this.session = session;\n\n    switch (this.session.lesson_type) {\n    case LessonType.MUSICAL_PIECES:\n      this.part_data = lesson_data.musical_pieces[part];\n      break;\n    case LessonType.TONAL_CONTEXT:\n      this.part_data = lesson_data.tonal_context[part];\n      break;\n    case LessonType.AUTOMATIC:\n      this.part_data = lesson_data.automatic[part];\n      break;\n    };\n\n    this.ls_prefix = \"lesson_part\" + part + \"_\";\n    if (session.continued) {\n      this.sequence = ls.get(this.ls_prefix + \"sequence\");\n      const trial_idx = ls.get(this.ls_prefix + \"trial_idx\");\n      if (trial_idx !== null) this.state.trial_idx = trial_idx;\n      session.continued = false;\n    }\n    else {\n      this.sequence = randomSequence(this.part_data, this.trials_per_part);\n      ls.set(this.ls_prefix + \"sequence\", this.sequence);\n      ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx);\n    }\n\n    console.log(\"LESSON PART \" + part + \" sequence:\");\n    console.log(this.sequence);\n\n    const that = this;\n    const doneLoadingAudio = () => {\n      that.setState({done_loading: true});\n      that.audioController.play(this.sequence[that.state.trial_idx][0]);\n    };\n\n    const donePlaying = () => {\n      that.setState({done_playing: true});\n    };\n\n    this.audioController = new AudioController(this.part_data.map(d => d[0]), doneLoadingAudio, donePlaying);\n  }\n\n  render() {\n    const that = this;\n    const nextTrial = () => {\n      const trial_idx = that.state.trial_idx;\n      if (trial_idx < that.trials_per_part - 1) {\n        that.setState({trial_idx: trial_idx+1,\n                       done_playing: false});\n        that.audioController.play(this.sequence[trial_idx+1][0]);\n        ls.set(this.ls_prefix + \"trial_idx\", trial_idx + 1);\n      }\n      else {\n        that.next();\n      }\n    };\n\n    const trialData  = this.sequence[this.state.trial_idx];\n    const chordName = trialData[1];\n    const songData = musical_pieces_data[chordName];\n\n    if (this.state.done_loading) {\n      let screen;\n      if (this.session.lesson_type === LessonType.MUSICAL_PIECES) {\n        screen = <SongWithoutChords chordName={chordName} songData={songData}/>;\n      }\n      else {\n        screen = <NameOfChord chordName={chordName} lesson_type={this.session.lesson_type}/>;\n      }\n      const button = this.state.done_playing ? (\n          <div className=\"row\">\n            <div className=\"col-sm-8 offset-sm-2 text-center\">\n              <br/>\n              <ContinueButton next={nextTrial} />\n            </div>\n          </div>) : null\n\n      return (\n        <div className=\"container\">\n          {screen}\n          {button}\n        </div>\n      );\n    }\n    else {\n      return <LoadingScreen />;\n    }\n  }\n}\n\n// This info screen shows up between the 2nd and 3rd parts of the lesson.\nconst InfoBeforeLessonPartC = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = <p>בחלק זה תשמעו את האקורדים המלווים את השיר, ועליכם לשיר או לזמזם את המנגינה של השיר הכתוב.</p>;\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info = <p>בחלק זה תשמעו את הסולם העולה והיורד ואחריו אקורד בודד.</p>;\n    break;\n  case LessonType.AUTOMATIC:\n    info = <p>בחלק זה תשמעו אקורדים בודדים משני הסוגים ששמעתם קודם לכן - בפסנתר ובגיטרה.</p>;\n    break;\n  };\n\n  return <InfoScreen info={info} next={next}/>;\n};\n\n// The main lesson block component.\nexport class LessonBlock extends React.Component {\n  steps = {\n    PART_A: 1,\n    PART_B: 2, \n    INFO: 3,\n    PART_C: 4,\n    DONE: 5,\n  }\n\n  state = {\n    step: 1,\n  }\n\n  nextStep = () => {\n    const { step } = this.state;\n\n    this.setState({\n      step: step + 1\n    });\n    ls.set(\"lesson_block_step\", step + 1);\n\n    if (step + 1 === this.steps.DONE)\n      this.next();\n  }\n\n  state = {\n    step: 1,\n  };\n  \n  constructor({data, session, next}) {\n    super();\n    this.data = data;\n    this.session = session;\n    this.next = next;\n\n    if (session.continued) {\n      this.state.step = ls.get(\"lesson_block_step\", this.state.step);\n    }\n    else {\n      ls.set(\"lesson_block_step\", this.state.step);\n    }\n  }\n  \n  render() {\n    const {step} = this.state;\n    let screen;\n\n    switch(step) {\n    case this.steps.PART_A:\n      screen = <LessonPart part={0} session={this.session} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_B:\n      screen = <LessonPart part={1} session={this.session} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.INFO:\n      this.session.continued = false;\n      screen = <InfoBeforeLessonPartC lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_C:\n      screen = <LessonPart part={2} session={this.session} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.DONE:\n      this.nextStep();\n    }\n\n    return screen;\n  }\n}\n","import React from 'react';\nimport { AudioController } from '../audio_controller.js';\nimport { LessonType, Strings, StaticImages, Chords, Timbres, musical_pieces_data } from '../defs.js';\nimport { InfoScreen, LoadingScreen, ContinueButton } from '../ui.js';\nimport { randomSequence, shuffleArray } from '../randomize.js';\nimport ls from 'local-storage';\n\n// each trial entry is [audio_idx, chord, transposition, timbre]\nlet training_data = {\n  musical_pieces: [\n    [[1, Chords.BIG_MAJOR, 0, null], [2, Chords.SMALL_MAJOR, 0, null], \n     [3, Chords.SMALL_MINOR, 0, null], [4, Chords.HALF_DIM, 0, null]],\n    [[5, Chords.BIG_MAJOR, 0, null], [6, Chords.SMALL_MAJOR, 0, null], \n     [7, Chords.SMALL_MINOR, 0, null], [8, Chords.HALF_DIM, 0, null]],\n    [ // piano recordings\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [10, Chords.BIG_MAJOR, 1, Timbres.PIANO], \n      [11, Chords.BIG_MAJOR, 2, Timbres.PIANO], [12, Chords.BIG_MAJOR, 3, Timbres.PIANO],\n      [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO], [14, Chords.SMALL_MAJOR, 1, Timbres.PIANO],\n      [15, Chords.SMALL_MAJOR, 2, Timbres.PIANO], [16, Chords.SMALL_MAJOR, 3, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [18, Chords.SMALL_MINOR, 1, Timbres.PIANO], \n      [19, Chords.SMALL_MINOR, 2, Timbres.PIANO], [20, Chords.SMALL_MINOR, 3, Timbres.PIANO],\n      [21, Chords.HALF_DIM, 0, Timbres.PIANO], [22, Chords.HALF_DIM, 1, Timbres.PIANO], \n      [23, Chords.HALF_DIM, 2, Timbres.PIANO], [24, Chords.HALF_DIM, 3, Timbres.PIANO],\n      // guitar recordings\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [42, Chords.BIG_MAJOR, 1, Timbres.GUITAR], \n      [43, Chords.BIG_MAJOR, 2, Timbres.GUITAR], [44, Chords.BIG_MAJOR, 3, Timbres.GUITAR],\n      [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR], [46, Chords.SMALL_MAJOR, 1, Timbres.GUITAR], \n      [47, Chords.SMALL_MAJOR, 2, Timbres.GUITAR], [48, Chords.SMALL_MAJOR, 3, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [50, Chords.SMALL_MINOR, 1, Timbres.GUITAR], \n      [51, Chords.SMALL_MINOR, 2, Timbres.GUITAR], [52, Chords.SMALL_MINOR, 3, Timbres.GUITAR],\n      [53, Chords.HALF_DIM, 0, Timbres.GUITAR], [54, Chords.HALF_DIM, 1, Timbres.GUITAR], \n      [55, Chords.HALF_DIM, 2, Timbres.GUITAR], [56, Chords.HALF_DIM, 3, Timbres.GUITAR],\n    ],\n  ],\n  tonal_context: [\n    [ // piano\n      [25, Chords.BIG_MAJOR, 0, Timbres.PIANO], [26, Chords.SMALL_MAJOR, 0, Timbres.PIANO],\n      [27, Chords.SMALL_MINOR, 0, Timbres.PIANO], [28, Chords.HALF_DIM, 0, Timbres.PIANO],\n      // guitar\n      [29, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [30, Chords.SMALL_MAJOR, 0, Timbres.GUITAR],\n      [31, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [32, Chords.HALF_DIM, 0, Timbres.GUITAR],\n    ],\n    [ // piano\n      [33, Chords.BIG_MAJOR, 0, Timbres.PIANO], [35, Chords.SMALL_MAJOR, 0, Timbres.PIANO],\n      [37, Chords.SMALL_MINOR, 0, Timbres.PIANO], [39, Chords.HALF_DIM, 0, Timbres.PIANO],\n      // guitar\n      [34, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [36, Chords.SMALL_MAJOR, 0, Timbres.GUITAR],\n      [38, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [40, Chords.HALF_DIM, 0, Timbres.GUITAR],\n    ],\n    [ // piano recordings\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [10, Chords.BIG_MAJOR, 1, Timbres.PIANO], \n      [11, Chords.BIG_MAJOR, 2, Timbres.PIANO], [12, Chords.BIG_MAJOR, 3, Timbres.PIANO],\n      [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO], [14, Chords.SMALL_MAJOR, 1, Timbres.PIANO],\n      [15, Chords.SMALL_MAJOR, 2, Timbres.PIANO], [16, Chords.SMALL_MAJOR, 3, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [18, Chords.SMALL_MINOR, 1, Timbres.PIANO], \n      [19, Chords.SMALL_MINOR, 2, Timbres.PIANO], [20, Chords.SMALL_MINOR, 3, Timbres.PIANO],\n      [21, Chords.HALF_DIM, 0, Timbres.PIANO], [22, Chords.HALF_DIM, 1, Timbres.PIANO], \n      [23, Chords.HALF_DIM, 2, Timbres.PIANO], [24, Chords.HALF_DIM, 3, Timbres.PIANO],\n      // guitar recordings\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [42, Chords.BIG_MAJOR, 1, Timbres.GUITAR], \n      [43, Chords.BIG_MAJOR, 2, Timbres.GUITAR], [44, Chords.BIG_MAJOR, 3, Timbres.GUITAR],\n      [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR], [46, Chords.SMALL_MAJOR, 1, Timbres.GUITAR], \n      [47, Chords.SMALL_MAJOR, 2, Timbres.GUITAR], [48, Chords.SMALL_MAJOR, 3, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [50, Chords.SMALL_MINOR, 1, Timbres.GUITAR], \n      [51, Chords.SMALL_MINOR, 2, Timbres.GUITAR], [52, Chords.SMALL_MINOR, 3, Timbres.GUITAR],\n      [53, Chords.HALF_DIM, 0, Timbres.GUITAR], [54, Chords.HALF_DIM, 1, Timbres.GUITAR], \n      [55, Chords.HALF_DIM, 2, Timbres.GUITAR], [56, Chords.HALF_DIM, 3, Timbres.GUITAR],\n    ],\n  ],\n  automatic: [\n    [ // piano\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [21, Chords.HALF_DIM, 0, Timbres.PIANO],\n      // guitar\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [53, Chords.HALF_DIM, 0, Timbres.GUITAR],\n    ],\n    [ // piano\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [21, Chords.HALF_DIM, 0, Timbres.PIANO],\n      // guitar\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [53, Chords.HALF_DIM, 0, Timbres.GUITAR],\n    ],\n    [ // piano recordings\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [10, Chords.BIG_MAJOR, 1, Timbres.PIANO], \n      [11, Chords.BIG_MAJOR, 2, Timbres.PIANO], [12, Chords.BIG_MAJOR, 3, Timbres.PIANO],\n      [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO], [14, Chords.SMALL_MAJOR, 1, Timbres.PIANO],\n      [15, Chords.SMALL_MAJOR, 2, Timbres.PIANO], [16, Chords.SMALL_MAJOR, 3, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [18, Chords.SMALL_MINOR, 1, Timbres.PIANO], \n      [19, Chords.SMALL_MINOR, 2, Timbres.PIANO], [20, Chords.SMALL_MINOR, 3, Timbres.PIANO],\n      [21, Chords.HALF_DIM, 0, Timbres.PIANO], [22, Chords.HALF_DIM, 1, Timbres.PIANO], \n      [23, Chords.HALF_DIM, 2, Timbres.PIANO], [24, Chords.HALF_DIM, 3, Timbres.PIANO],\n      // guitar recordings\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [42, Chords.BIG_MAJOR, 1, Timbres.GUITAR], \n      [43, Chords.BIG_MAJOR, 2, Timbres.GUITAR], [44, Chords.BIG_MAJOR, 3, Timbres.GUITAR],\n      [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR], [46, Chords.SMALL_MAJOR, 1, Timbres.GUITAR], \n      [47, Chords.SMALL_MAJOR, 2, Timbres.GUITAR], [48, Chords.SMALL_MAJOR, 3, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [50, Chords.SMALL_MINOR, 1, Timbres.GUITAR], \n      [51, Chords.SMALL_MINOR, 2, Timbres.GUITAR], [52, Chords.SMALL_MINOR, 3, Timbres.GUITAR],\n      [53, Chords.HALF_DIM, 0, Timbres.GUITAR], [54, Chords.HALF_DIM, 1, Timbres.GUITAR], \n      [55, Chords.HALF_DIM, 2, Timbres.GUITAR], [56, Chords.HALF_DIM, 3, Timbres.GUITAR],\n    ],\n  ],\n};\n\nconst TrainingInfo = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = (\n      <div>\n      <p>בחלק זה תשמעו קטעים מוזיקליים ותצטרכו לזהות את האקורד הראשון שלהם. בדומה לחלק הקודם, האקורד יושמע גם אחרי הקטע המוזיקלי.</p>\n      <p>עליכם לזהות את סוג האקורד במהירות האפשרית, וללחוץ עליו באמצעות העכבר.</p>\n      </div>);\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info = (\n      <div>\n        <p>בחלק זה תשמעו צמדים מוזיקליים לאחר מבוא טונאלי של סולם עולה ויורד, ותצטרכו לזהות את האקורד הראשון בכל צמד. האקורד אותו תצטרכו לזהות יושמע שוב לאחר שמיעת צמד האקורדים.</p>\n        <p>עליכם לזהות את סוג האקורד במהירות האפשרית, וללחוץ עליו באמצעות העכבר.</p>\n      </div>);\n  case LessonType.AUTOMATIC:\n    info = (\n      <div>\n        <p>בחלק זה תשמעו אקורדים בודדים, ותצטרכו לזהות אותם במהירות האפשרית, וללחוץ על סוג האקורד.</p>\n      </div>);\n  }\n  return <InfoScreen next={next} info={info}/>;\n};\n\nconst InfoBeforeTrainingPartB = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = (\n      <div>\n        <p>בחלק זה תשמעו קטעים מוזיקליים בחליל ופסנתר ותצטרכו לזהות את האקורד המושמע בליווי.</p>\n        <p>עליכם לזהות את סוג האקורד במהירות האפשרית, וללחוץ עליו באמצעות העכבר.</p>\n      </div>);\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info = <p>בחלק זה תשמעו מבוא טונאלי ואחריו אקורד בודד. תצטרכו לזהות את האקורד הבודד במהירות האפשרית, וללחוץ על סוג האקורד.</p>;\n    break;\n  case LessonType.AUTOMATIC:\n    info = <p>תזכורת: בחלק זה תשמעו אקורדים בודדים, ותצטרכו לזהות אותם במהירות האפשרית, וללחוץ על סוג האקורד.</p>;\n    break;\n  }\n  return <InfoScreen info={info} next={next}/>;\n};\n\nconst InfoBeforeTrainingPartC = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = <p>בחלק זה תשמעו אקורדים בודדים, ללא הקטע המוזיקלי, ותצטרכו לזהות אותם במהירות האפשרית, וללחוץ על סוג האקורד.</p>;\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info = <p>בחלק זה תשמעו אקורדים בודדים, ללא הקטע המוזיקלי, ותצטרכו לזהות אותם במהירות האפשרית, וללחוץ על סוג האקורד.</p>;\n    break;\n  case LessonType.AUTOMATIC:\n    info = <p>תזכורת: בחלק זה תשמעו אקורדים בודדים, ותצטרכו לזהות אותם במהירות האפשרית, וללחוץ על סוג האקורד.</p>;\n    break;\n  }\n  return <InfoScreen info={info} next={next}/>;\n};\n\nconst SuccessfulIdentification = props => {\n  const { next } = props;\n  return (\n    <div className=\"row successScreenWrapper\">\n      <div className=\"col-sm-8 offset-sm-2 text-center\">\n        <span className=\"songTitle\"> { Strings.success_identification } &nbsp;</span>\n        <img src= { StaticImages.happySmiley } width=\"150px\" height=\"150px\" alt=\"\"/>\n        <br/>\n        <br/>\n        <ContinueButton next={next} />\n      </div>\n    </div>\n  );\n};\n\nconst ShowCorrectAnswer = props => {\n  const { correctChord } = props;\n  return (\n    <div>\n      <div className=\"row\">\n        <div className=\"col-sm-8 offset-sm-1\">\n          <span className=\"songTitle\">{ Strings.failure_song_has_chord } </span>\n          <span className=\"songTitle\">{ correctChord }</span>\n          <br/>\n          <span className=\"songTitle\">{ Strings.how_it_sounds }</span>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst FailedIdentification = props => {\n  const { shouldShowCorrect, correctChord} = props;\n\n  let appendix = <div></div>;\n  if (shouldShowCorrect === true){\n    appendix = \n      <div className=\"row\">\n        <div className=\"col-sm-8 offset-sm-2 text-center\">\n          <ShowCorrectAnswer correctChord={ correctChord } />\n        </div>\n      </div>;\n  }\n  return (\n    <div>\n      <div className=\"row\">\n        <div className=\"col-sm-8 offset-sm-2 text-center\">\n            <img src= { StaticImages.sadSmiley } width=\"150px\" height=\"150px\" alt=\"\" className=\"sadSmiley\"/>\n            <span className=\"songTitle\"> { Strings.failure_identification } &nbsp;</span>\n            <br/>\n            <span className=\"songTitle\">{ Strings.how_it_sounds }</span>\n        </div>\n      </div>\n      { appendix }\n    </div>\n  );\n};\n\nconst SongWithChords = props => {\n  const { songData, chord_buttons, disabled, next } = props;\n\n  const gen_button = (chord, i) => {\n    if (disabled) \n      return <button className=\"chordBtn\" disabled key={i} onClick={(e) => next(chord)}>{chord}</button>;\n    else \n      return <button className=\"chordBtn\" key={i} onClick={(e) => next(chord)}>{chord}</button>;\n  };\n\n  return (\n    <div className=\"songDisplayWrapper\">\n      <img className=\"songImage\" src={ songData.imgSrc } alt=\"\"/>\n      <div className=\"row\">\n        <div className=\"col text-center songTitle\">\n          שם השיר:\n          <br/>\n          { songData.name }\n          <br/>\n          <br/>\n          שם האקורד:          \n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col text-center chords\">\n          {chord_buttons.map((chord, i) => gen_button(chord, i))}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst ChordSelection = props => {\n  let { chord_buttons, disabled, with_song_names, next } = props;\n  const gen_button = (chord) => {\n    const label = with_song_names ? <p>{chord} <br/> {musical_pieces_data[chord].name}</p> : <p>{chord}</p>;\n\n    if (disabled) \n      return <button className=\"chordBtn\" disabled onClick={(e) => next(chord)}>{label}</button>;\n    else \n      return <button className=\"chordBtn\" onClick={(e) => next(chord)}>{label}</button>;\n  };\n\n  return (\n    <div className=\"songDisplayWrapper\">\n      <div className=\"row\">\n        <div className=\"col-sm-2 offset-sm-2\">\n          {gen_button(chord_buttons[0])}\n        </div>\n        <div className=\"col-sm-4\">\n          &nbsp;\n        </div>\n        <div className=\"col-sm-2\">\n          {gen_button(chord_buttons[1])}\n        </div>\n      </div>\n      <div className=\"row text-center\">\n        <div className=\"col-sm-2 offset-sm-5 plusSign align-middle\">\n          +\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col-sm-2 offset-sm-2\">\n          {gen_button(chord_buttons[2])}\n        </div>\n        <div className=\"col-sm-4\">\n          &nbsp;\n        </div>\n        <div className=\"col-sm-2\">\n          {gen_button(chord_buttons[3])}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nclass TrainingPart extends React.Component {\n  state = {\n    trial_idx: 0,\n    done_loading: false,\n    done_playing: false,\n    show_feedback: false,\n    answer: null,\n  };\n\n  constructor({part, session, chord_buttons, next, data}) {\n    super();\n    this.part = part;\n    this.session = session;\n    this.chord_buttons = chord_buttons;\n    this.next = next;\n    this.data = data;\n    this.trials_per_part = 32;\n\n    switch (session.lesson_type) {\n    case LessonType.MUSICAL_PIECES:\n      this.part_data = training_data.musical_pieces[part];\n      break;\n    case LessonType.TONAL_CONTEXT:\n      this.part_data = training_data.tonal_context[part];\n      break;\n    case LessonType.AUTOMATIC:\n      this.part_data = training_data.automatic[part];\n      break;\n    };\n\n    this.ls_prefix = \"training_part\" + part + \"_\";\n    if (session.continued) {\n      this.sequence = ls.get(this.ls_prefix + \"sequence\");\n      const trial_idx = ls.get(this.ls_prefix + \"trial_idx\");\n      if (trial_idx !== null) this.state.trial_idx = trial_idx;\n      session.continued = false; // we only need to restore session once!\n    }\n    else {\n      this.sequence = randomSequence(this.part_data, this.trials_per_part);\n      ls.set(this.ls_prefix + \"sequence\", this.sequence);\n      ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx);\n    }\n    console.log(\"TRAINING PART \" + part + \" sequence:\");\n    console.log(this.sequence);\n\n    const that = this;\n    const doneLoadingAudio = () => {\n      that.setState({done_loading: true});\n      that.audioController.play(that.sequence[that.state.trial_idx][0]);\n    };\n\n    const donePlaying = () => {\n      that.setState({done_playing: true});\n      this.response_start = new Date();\n      \n      // this part runs when we give feedback for an incorrect answer.\n      if (this.state.show_feedback) {\n        if (!this.state.fail_show_correct) {\n          // play the correct answer audio idx\n          this.audioController.play(this.state.correct_audio_idx);\n          this.setState({fail_show_correct: true});\n        }\n        else {\n          // continue \n          this.nextTrial();\n        }\n      }\n    };\n\n    this.audioController = new AudioController(this.part_data.map(d => d[0]), doneLoadingAudio, donePlaying);\n  }\n\n  /* calculate the transposition count since the beginning of training (currently of part). */\n  get_transposition_play_count() { \n    const idx = this.state.trial_idx;\n    const trial = this.sequence[idx];\n    console.log(\"trial idx:\" + idx + \" trial: \" + trial);\n    console.log(\"slice:\");\n    console.log(this.sequence.slice(0, idx));\n    console.log(\"filter:\");\n    console.log(this.sequence.slice(0, idx)\n                .filter(t => t[1] === trial[1] && t[2] === trial[2]));\n    const count_in_part = this.sequence.slice(0, idx)\n      .filter(t => t[1] === trial[1] && t[2] === trial[2]).length + 1;\n    console.log(\"count_in_part: \" + count_in_part);\n    return count_in_part; // TODO: return actual transposition count (not in part)\n  }\n\n  render() {\n    const that = this;\n    const trial_data = this.sequence[this.state.trial_idx];\n    const chord_name = trial_data[1];\n    const transposition = trial_data[2];\n\n    const nextTrial = () => {\n      const trial_idx = that.state.trial_idx;\n      if (trial_idx < that.trials_per_part - 1) {\n        that.setState({trial_idx: trial_idx + 1,\n                       done_playing: false,\n                       show_feedback: false});\n        that.audioController.play(this.sequence[trial_idx+1][0]);\n      }\n      else {\n        that.next();\n      }\n    };\n\n    const processAnswer = (answer) => {\n      console.log(\"SELECTION: \" + answer);\n      const correct = answer === chord_name;\n      // save trial data\n      const td = {\n        time: new Date().toString(),\n        audio_index: trial_data[0],\n        chord_number: that.trials_per_part * this.part + this.state.trial_idx + 1,\n        chord_type: chord_name,\n        transposition: transposition + 1,\n        transposition_play_count: that.get_transposition_play_count(),\n        selected_chord_type: answer,\n        correct: correct,\n        response_time: new Date() - that.response_start,\n      };\n      that.data.trials.push(td);\n      ls.set(\"data\", that.data);\n      if (this.state.trial_idx+1 < this.trials_per_part)\n        ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx+1);\n\n      // continue to show answer feedback\n      if (!correct) {\n        // start playing the chosen chord and then the right chord.\n        // [idx, chord, trnsp, timbre]\n        const selected_audio_idx = that.part_data.\n          filter(d => d[1] === answer && d[2] === transposition && d[3] === trial_data[3])[0][0];\n        const correct_audio_idx = trial_data[0];\n\n        this.setState({show_feedback: true,\n                       correct: correct,\n                       fail_show_correct: false,\n                       correct_audio_idx: correct_audio_idx});\n        that.audioController.play(selected_audio_idx);\n      }\n      else {        \n        that.setState({show_feedback: true,\n                       correct: correct});\n      }\n    };\n    \n    if (!this.state.done_loading) \n      return <LoadingScreen />;\n\n    if (!this.state.show_feedback) {\n      let screen;\n      if (this.part < 2 && this.session.lesson_type === LessonType.MUSICAL_PIECES) {\n        const song_data = musical_pieces_data[chord_name];\n        screen = <SongWithChords songData={song_data} disabled={!this.state.done_playing} \n                                 chord_buttons={this.chord_buttons} next={processAnswer}/>;\n      }\n      else {\n        screen = <ChordSelection \n        chord_buttons={this.chord_buttons} \n        disabled={!this.state.done_playing} \n        with_song_names={this.session.lesson_type === LessonType.MUSICAL_PIECES}\n        next={processAnswer}/>;\n      }\n      \n      return (\n        <div className=\"container\">\n          {screen}\n        </div>\n      );\n    }\n    else { // show feedback screen\n      if (this.state.correct) {\n        return <SuccessfulIdentification next={nextTrial}/>;\n      } else {\n        this.nextTrial = nextTrial;\n        return <FailedIdentification shouldShowCorrect={this.state.fail_show_correct} correctChord={chord_name} />;\n      }\n    }\n  }\n};\n\nexport class TrainingBlock extends React.Component {\n  steps = {\n    INFO_A: 1,\n    PART_A: 2,\n    INFO_B: 3,\n    PART_B: 4,\n    INFO_C: 5,\n    PART_C: 6,\n    DONE: 7,\n  }\n\n  state = {\n    step: 1,\n  }\n\n  chord_buttons = shuffleArray([Chords.BIG_MAJOR, Chords.SMALL_MAJOR, Chords.SMALL_MINOR, Chords.HALF_DIM]);\n\n  nextStep = () => {\n    const { step } = this.state;\n    \n    this.setState({\n      step: step + 1\n    });\n    ls.set(\"training_block_step\", step + 1);\n\n    if (step + 1 === this.steps.DONE)\n      this.next();\n  }\n\n  constructor({data, session, next}) {\n    super();\n    this.data = data;\n    this.session = session;\n    this.next = next;\n\n    if (session.continued) {\n      this.chord_buttons = ls.get(\"training_block_chord_buttons\");      \n      this.state.step = ls.get(\"training_block_step\");\n    }\n    else {\n      ls.set(\"training_block_chord_buttons\", this.chord_buttons);\n      ls.set(\"training_block_step\", this.state.step);\n    }\n  }\n\n  render() {\n    const { step } = this.state;\n    let screen;\n    switch (step) {\n    case this.steps.INFO_A:\n      this.session.continued = false;\n      screen = <TrainingInfo lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_A:\n      screen = <TrainingPart part={0} session={this.session} next={this.nextStep} key={step} chord_buttons={this.chord_buttons} data={this.data} />;\n      break;\n    case this.steps.INFO_B:\n      this.session.continued = false;\n      screen = <InfoBeforeTrainingPartB lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_B:\n      screen = <TrainingPart part={1} session={this.session} next={this.nextStep} key={step} chord_buttons={this.chord_buttons} data={this.data} />;\n      break;\n    case this.steps.INFO_C:\n      this.session.continued = false;\n      screen = <InfoBeforeTrainingPartC lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_C:\n      screen = <TrainingPart part={2} session={this.session} next={this.nextStep} key={step} chord_buttons={this.chord_buttons} data={this.data} />;\n      break;\n    case this.steps.DONE:\n      screen = null;\n      break;\n    };\n\n    return screen;\n  }\n}\n","/* functions for reading and writing to a google spreadsheet.\n   \n */\n\nconst read_url = \"https://sheets.googleapis.com/v4/spreadsheets/\";\n\n// https://stackoverflow.com/questions/1714786/query-string-encoding-of-a-javascript-object\nconst serialize = function(obj, prefix) {\n  var str = [],\n    p;\n  for (p in obj) {\n    if (obj.hasOwnProperty(p)) {\n      var k = prefix ? prefix + \"[\" + p + \"]\" : p,\n        v = obj[p];\n      str.push((v !== null && typeof v === \"object\") ?\n        serialize(v, k) :\n        encodeURIComponent(k) + \"=\" + encodeURIComponent(v));\n    }\n  }\n  console.log(\"serialize: \" + str.join(\"&\"));\n  return str.join(\"&\");\n}\n\nconst parse_sheet_list = (data) => {\n  let sheetNames = [];\n  data.sheets.forEach(sheet => {\n    sheetNames.push(sheet.properties.title);\n  });\n  return sheetNames;\n};\n\nconst gs = {\n  read: function(conn, sheetName, range) {\n    return fetch(read_url + \n                 conn.spreadsheet_id + \n                 \"/values/\" + \n                 sheetName + \n                 \"!\" + range + \n                 \"?key=\" + conn.api_key);\n  },\n\n  write: function(conn, sheetName, data) {\n    if (!Array.isArray(data))\n        data = [data];\n\n    let url = conn.write_url + \"?sheet_name=\" + sheetName;\n    return fetch(url,\n                 {\n                   headers: {\n                     'Accept': 'application/json',\n                     'Content-Type': 'application/json'\n                   },\n                   method: \"POST\",\n                   mode: 'no-cors',\n                   body: JSON.stringify(data),\n                 });\n  },\n\n  list_sheets: function(conn) {\n    return fetch(read_url + conn.spreadsheet_id + \"?key=\" + conn.api_key)\n      .then(res => res.json())\n      .then(parse_sheet_list);\n  },\n};\n\nexport default gs;\n","import gs from './spreadsheet_io.js';\nimport { SheetNames } from './defs.js';\nimport ls from 'local-storage';\n\nconst FIRST_HOUR_OF_DAY = 3; // day starts at 3 am.\n\nexport const SessionEvent = {\n  SESSION_START: \"SESSION_START\",\n  SESSION_CONTINUED: \"SESSION_CONTINUED\",\n  SESSION_END: \"SESSION_END\",\n};\n\n// parse session json data from sheets api into an array of session objects.\nexport const parseSessions = (data) => {\n  let sessions = [];\n  data.values.forEach(session_event => {\n    let session = {\n      id: session_event[0],\n      number: session_event[1],\n      event: session_event[2],\n      lesson_type: session_event[3],\n      time: session_event[4],\n    };\n    sessions.push(session);\n  });\n  return sessions;\n};\n\nexport const writeSessionEvent = (conn, session, event, on_error) => {\n  let request_data = Object.assign({event: event,\n                                    time: new Date().toString()},\n                                    session);\n  console.log(\"writing session_data\");\n  console.log(request_data);\n  ls.set('session', session);\n  gs.write(conn, SheetNames.TRAINING_SESSIONS, request_data)\n    .catch(on_error);\n\n};\n\nexport const readSessionData = (conn) => {\n  return gs.read(conn, SheetNames.TRAINING_SESSIONS, \"A2:E10000\")\n    .then(response => response.json())\n    .then(parseSessions);\n  \n};\n\nexport const readLessonType = (conn, id) => {\n  const findLessonType = (data) => {\n    console.log(\"findLessontype\");\n    let lesson_type = -1;\n    data.values.forEach(row => {\n      if (row[0] === id)\n        lesson_type = parseInt(row[1]);\n    });    \n    return lesson_type;\n  }\n  console.log(\"readLessontype: \" + id);\n  return gs.read(conn, SheetNames.LESSON_TYPES, \"A2:B10000\")\n    .then(response => response.json())\n    .then(findLessonType)\n};\n\n// Return true if the last session was today. Day starts at FIRST_HOUR_OF_DAY\nexport const was_last_session_today = (last_session) => {\n  let last_time = new Date(last_session.time);\n  last_time.setHours(last_time.getHours() - FIRST_HOUR_OF_DAY);\n  let now = new Date();\n  now.setHours(now.getHours() - FIRST_HOUR_OF_DAY);\n  return now.getDate() === last_time.getDate();\n};\n\nexport const does_user_sheet_exists = (conn, user_id) => {\n  return gs.list_sheets(conn)\n    .then(sheets => sheets.includes(user_id));\n};\n","import React from 'react';\nimport './TrainingExperiment.css';\nimport { IntroText, InfoText } from './info.js';\nimport { LessonType, Strings } from '../defs.js';\nimport { LessonBlock } from './lesson_block.js';\nimport { TrainingBlock } from './training_block.js';\nimport { InfoScreen, LoadingScreen, ErrorScreen, ContinueButton } from '../ui.js';\nimport { does_user_sheet_exists, was_last_session_today, SessionEvent, writeSessionEvent, readSessionData, readLessonType } from '../sessions.js';\nimport gs from '../spreadsheet_io.js';\nimport ls from 'local-storage';\n\nconst MAX_NUMBER_OF_SESSIONS = 5;\n\n// 1st screen.\nfunction IntroScreen({next, data}) {\n  function handleContinue() {\n    data.id = document.getElementById('id_input').value;\n    next();\n  }\n\n  return ( // the hidden p tag is there to balance the \" marks\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-md-8 offset-md-2 infotext\">\n          <IntroText />\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col\"></div>\n        <div className=\"col text-center\">\n          <br/>\n          <label>ת\"ז: <input type=\"text\" id=\"id_input\"/><br/></label>\n          <p hidden>\"</p>\n          <br/>\n          <ContinueButton next={handleContinue} disabled={false} />\n        </div>\n        <div className=\"col\"></div>\n      </div>\n    </div>\n  );\n}\n\n// 2nd screen. Different text per lesson type.\nfunction StartScreen({next, lesson_type}) {\n  const info = <InfoText lesson_type={lesson_type} />;\n  return <InfoScreen info={info} next={next}/>;\n}\n\nfunction FinishScreen({data, done_saving, session_number}) {\n  const remaining = MAX_NUMBER_OF_SESSIONS - session_number - 1;\n  return (\n    <div className=\"container\">\n      <div className=\"col-md-8 offset-md-2\">\n        <p>הפעלה מספר {session_number+1} הסתיימה. נותרו עוד {remaining} הפעלות.</p>\n        <p>{done_saving ? \"הנתונים נשמרו בהצלחה!\" : \"אנא המתן לשמירת הנתונים...\"}</p>\n      </div>\n    </div>\n  );\n}\n\nclass TrainingExperiment extends React.Component {\n  conn = { // read/write connection details for google spreadsheet.\n    spreadsheet_id: '1D2s3D13ldvchzueCFWTkvH8kzhNBEMZzizPnjGQnhMY',\n    api_key: 'AIzaSyDHFHbGy_GhEt1Q4FW61YYEX2jk3hZcSoQ',\n    write_url: 'https://script.google.com/macros/s/AKfycbxv6Uc9VsHlKI6SMe6YmH-MELryrJYvYg-uQnGFhyMF2X7zyC-O/exec',\n  }\n\n  steps = {\n    INTRO: 1,\n    INFO: 2, \n    LESSON: 3,\n    TRAINING: 4,\n    FINISH: 5\n  }\n\n  state = {\n    step: 1,\n    is_loading_session: true, // true until session data is received.\n    did_check_user_registered: false, // false until sheet list is received.\n    done_saving: false, // false until the data is saved to the spreadsheet.\n    max_sessions_reached: false,\n    session_done_for_today: false,\n    user_unregistered: true,\n    did_load_registration_list: false,\n    did_load_lesson_type: false,\n  };\n\n  data = {\n    id: undefined,\n    trials: [],\n  };\n\n  maybe_start_session = () => {\n    // Check previous sessions data. Start a new session accordingly\n    // or enforce session limits.\n    let session = {id: this.data.id};\n    const previous_sessions = this.sessions.filter(e => e.id === session.id);\n    if (previous_sessions.length === 0) {\n      // First session\n      ls.clear();\n      session.number = 0;\n      this.setState({did_load_lesson_type: false});\n      readLessonType(this.conn, session.id)\n        .then(lesson_type => {\n          if (lesson_type === -1)\n            this.setState({session: session, \n                           user_unregistered: true,\n                           did_load_lesson_type: true});\n          else {\n            session.lesson_type = lesson_type;\n            writeSessionEvent(this.conn, session, \n                              SessionEvent.SESSION_START);\n            \n            this.setState({session: session,\n                           did_load_lesson_type: true});\n          }\n\n        })\n        .catch(err => { console.log(\"error while reading lessons: \" + err); });\n    }\n    else {\n      // Not first session\n      const last_session = previous_sessions[previous_sessions.length-1];\n      const last_session_number = parseInt(last_session.number);\n      \n      session.lesson_type = parseInt(last_session.lesson_type);\n      if (last_session.event !== SessionEvent.SESSION_END) {\n        // The last session for this subject id isn't finished.\n        if (was_last_session_today(last_session)) {\n          // Same day. Try to continue the last session.\n          session.number = last_session_number;\n          // Retreive session and data from local storage. <== TODO: deal with missing values.\n          console.log(\"Loading session data from local storage.\");\n          const continued_session = ls.get('session');\n          if (continued_session && continued_session.id === session.id) {\n            writeSessionEvent(this.conn, session, \n                              SessionEvent.SESSION_CONTINUED, this.sessionEventError);\n            session = continued_session;\n            const continued_data = ls.get('data');\n            if (continued_data) {\n              console.log(\"Loading experiment data from local storage.\");\n              this.data = continued_data;\n            }\n            \n            const continued_step = ls.get('step');\n            \n            session.continued = true;\n            this.setState({step: continued_step || this.steps.INFO,\n                           session: session});            \n          } \n          else {\n            // Can't continue session. Start a new one. \n            ls.clear();\n            session.number = last_session_number + 1;\n            writeSessionEvent(this.conn, session, \n                              SessionEvent.SESSION_START);\n            this.setState({session: session});\n          }\n        }\n        else {\n          // A new day. TODO: what happens when max session reached on unfinished session?\n          ls.clear();\n          if (last_session_number + 1 >= MAX_NUMBER_OF_SESSIONS) {\n            // enforce the session limit.\n            this.setState({max_sessions_reached: true,\n                           session: session});\n          } \n          else {\n            // Continue to next session. \n            // TODO: should this automatically add another lesson? or just use the same session number?\n            session.number = last_session_number + 1;\n            writeSessionEvent(this.conn, session, \n                              SessionEvent.SESSION_START);\n            this.setState({session: session});\n          }\n        }\n      }\n      else {\n        // The last session was finished. \n        ls.clear();\n        if (last_session_number + 1 >= MAX_NUMBER_OF_SESSIONS) {\n          // enforce the session limit.\n          this.setState({max_sessions_reached: true,\n                         session: session});\n        }\n        else {\n          if (!was_last_session_today(last_session)) {\n            // Start a new session\n            session.number = last_session_number + 1;\n            writeSessionEvent(this.conn, session, \n                              SessionEvent.SESSION_START);\n            this.setState({session: session});\n          }\n          else {\n            // No more sessions for today.\n            this.setState({session_done_for_today: true,\n                           session: session});\n          }\n        }\n      }\n    }\n  }\n\n  nextStep = () => {\n    const { step } = this.state;\n    if (step > 1) // otherwise the key will be overwritten before loading.\n      ls.set('step', step + 1);\n    this.stepWillChange(step);\n    this.setState({\n      step: step + 1\n    });\n    this.stepChanged(step + 1);\n  }\n\n  stepWillChange = (step) => {\n    if (step === this.steps.INTRO) {\n      does_user_sheet_exists(this.conn, this.data.id)\n        .then((sheet_exists) => { \n          this.setState({did_load_registration_list: true});\n          if (sheet_exists) {\n            this.setState({user_unregistered: false});\n            this.maybe_start_session(); \n          }\n          else this.setState({user_unregistered: true, session: {}});\n        }).catch(this.sessionDataLoadError);\n    }\n  } \n\n  stepChanged = (step) => {   \n    if (step === this.steps.FINISH) {\n      // end of session. \n      this.data.end_time = new Date().toString();\n\n      // write data\n      console.log(\"Saving data...\");\n      console.log(this.data.trials);\n\n      this.data.trials.forEach(t => { \n        t.id = this.data.id;\n        t.session_number = this.state.session.number;\n        t.start_time = this.data.start_time;\n        t.end_time = this.data.end_time;\n      });\n\n      let that = this;\n      gs.write(this.conn, this.data.id, this.data.trials)\n        .then(res => { that.setState({done_saving: true});\n                       ls.clear(); })\n        .catch(this.dataSaveError);\n\n      // write session ended event\n      writeSessionEvent(this.conn, this.state.session, \n                        SessionEvent.SESSION_END, this.sessionEventError);\n      // TODO: need to make sure both writes finished before setting done_saving: true!\n\n      // clear session from local storage. TODO: also do this only after both saves are done.\n\n    }\n  }\n\n  dataSaveError = (response) => {\n    console.log(\"error\" + response);\n  }\n\n  sessionEventError = (response) => { // TODO\n    console.log(\"error while writing session event.\");\n  }\n\n  sessionDataLoaded = (session_data) => {\n    this.setState({ is_loading_session: false });\n    this.sessions = session_data;\n  }\n\n  sessionDataLoadError = (response) => { // TODO\n    // ask to refresh the page, try again... contact info?\n    console.log(\"Session data load error: \" + response);\n  }\n\n  componentDidMount() {\n    // read session data\n    var that = this;\n    \n    readSessionData(this.conn)\n      .then(that.sessionDataLoaded)\n      .catch(that.sessionDataLoadError); // TODO: handle errors!\n\n    this.data.start_time = new Date().toString();\n  }\n\n  getScreenForStep(step) {\n    let screen;\n    {\n      switch(step) {\n      case this.steps.INTRO:\n        screen = <IntroScreen data={this.data} next={this.nextStep} />;\n        break;\n      case this.steps.INFO:\n        this.state.session.continued = false;\n        screen = <StartScreen next={this.nextStep} lesson_type={this.state.session.lesson_type} />;\n        break;\n      case this.steps.LESSON:\n        screen = <LessonBlock data={this.data} next={this.nextStep} session={this.state.session} />;\n        break;\n      case this.steps.TRAINING:\n        screen = <TrainingBlock data={this.data} next={this.nextStep} session={this.state.session} />;\n        break;\n      case this.steps.FINISH:\n        screen = <FinishScreen data={this.data} done_saving={this.state.done_saving} session_number={this.state.session.number} />;\n      }\n    }\n    return screen;\n  } \n\n  render() {\n    const {step} = this.state;\n\n    let screen;\n\n    if (this.state.is_loading_session || !this.state.did_load_lesson_type)\n      screen = <LoadingScreen />;\n    if (this.state.step === 2) {\n      // After entering ID on the intro screen we check the session data before continuing.\n      if (!this.state.did_load_registration_list || !this.state.session) \n        screen = <LoadingScreen />;\n      else {\n        if (this.state.max_sessions_reached)\n          screen = <ErrorScreen error=\"עברת את מספר ההפעלות המותר.\" />;\n        else if (this.state.session_done_for_today)\n          screen = <ErrorScreen error=\"ביצעת כבר הפעלה אחת של התוכנה היום. ניתן להתחבר שוב מחר.\" />;\n        else if (this.state.did_load_registration_list && this.state.user_unregistered)\n          screen = <ErrorScreen error=\"מספר הנבדק לא קיים במערכת! אנא צור קשר עם הנסיינית ונסה שוב.\" />;\n        else screen = this.getScreenForStep(step);\n      }\n    }\n    else screen = this.getScreenForStep(step);\n\n    return screen;\n  }\n}\n\nexport default TrainingExperiment;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport TrainingExperiment from './training_experiment/TrainingExperiment.js';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<TrainingExperiment />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}