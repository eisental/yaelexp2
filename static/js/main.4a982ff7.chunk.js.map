{"version":3,"sources":["defs.js","training_experiment/info.js","audio_controller.js","ui.js","randomize.js","training_experiment/lesson_block.js","training_experiment/training_block.js","spreadsheet_io.js","sessions.js","training_experiment/TrainingExperiment.js","test_experiment/pretest.js","test_experiment/audio_mapping.js","test_experiment/subtests.js","test_experiment/personal_info.js","test_experiment/TestExperiment.js","serviceWorker.js","index.js"],"names":["LessonType","MUSICAL_PIECES","TONAL_CONTEXT","AUTOMATIC","Chords","BIG_MAJOR","SMALL_MAJOR","SMALL_MINOR","HALF_DIM","Timbres","PIANO","GUITAR","SONG","StaticImages","Strings","SheetNames","musical_pieces_data","IntroText","className","InfoText","lesson_type","href","imgSrc","name","PretestInfo","audioIdx2File","idx","AudioController","srcs","onDoneLoading","onAudioEnded","this","players","ids2players","players2ids","id","playerIdx","length","p","Audio","addEventListener","e","audioLoaded","push","console","log","loadCount","player","audio_id","play","catch","err","pause","currentTime","LoadingScreen","ErrorScreen","error","InfoScreen","info","next","disabled","Button","label","onClick","classNameStr","type","ContinueButton","ReplayButton","src","ButtonTable","labels","values","gen_button","btn_idx","ComboBox","options","defaultValue","hidden","value","map","opt","key","repeatArray","arr","count","ln","b","i","shuffleArray","a","Math","random","sort","randomSequence","items","lesson_data","musical_pieces","tonal_context","automatic","NameOfChord","props","chordName","description","SongWithoutChords","songData","alt","LessonPart","part","session","state","trial_idx","done_playing","done_loading","trials_per_part","part_data","ls_prefix","continued","sequence","ls","get","set","that","audioController","d","setState","screen","button","React","Component","InfoBeforeLessonPartA","InfoBeforeLessonPartB","InfoBeforeLessonPartC","LessonBlock","data","steps","INFO_A","PART_A","INFO_B","PART_B","INFO_C","PART_C","DONE","step","nextStep","training_data","correction_data","TrainingInfo","InfoBeforeTrainingPartB","InfoBeforeTrainingPartC","SuccessfulIdentification","width","height","FailedIdentification","appendix","shouldShowCorrect","shouldShowButton","correctChord","text","SongWithChords","chord_buttons","chord","ChordSelection","with_song_names","TrainingPart","show_feedback","answer","correction_idxs","corrections_for_part","concat","response_start","Date","fail_show_correct","done_playing_correct_feedback","correct_audio_idx","trial","slice","filter","t","trial_data","chord_name","transposition","nextTrial","processAnswer","correct","td","time","toString","audio_index","chord_number","chord_type","transposition_play_count","get_transposition_play_count","selected_chord_type","response_time","trials","stop","selected_audio_idx","song_data","TrainingBlock","read_url","parse_sheet_list","sheetNames","sheets","forEach","sheet","properties","title","gs","read","conn","sheetName","range","fetch","spreadsheet_id","api_key","write","Array","isArray","url","write_url","headers","method","mode","body","JSON","stringify","list_sheets","then","res","json","SessionEvent","SESSION_START","SESSION_CONTINUED","SESSION_END","parseSessions","sessions","session_event","number","event","writeSessionEvent","on_error","request_data","Object","assign","readLessonType","response","row","parseInt","was_last_session_today","last_session","last_time","setHours","getHours","now","getDate","does_user_sheet_exists","user_id","includes","read_subject_data","ret","chord_button_labels","parse","MAX_NUMBER_OF_SESSIONS","IntroScreen","document","getElementById","FinishScreen","done_saving","session_number","remaining","ContinueScreen","PretestBlock","practice_trials_count","test_trails_count","button_idxs","practice_sequence","test_sequence","target_btn","selection","TrainingExperiment","INTRO","INFO","PRETEST_INFO","PRETEST","LESSON","TRAINING","FINISH","is_loading_session","did_check_user_registered","max_sessions_reached","session_done_for_today","user_unregistered","did_load_registration_list","did_load_lesson_type","undefined","maybe_start_session","previous_sessions","clear","alert","last_session_number","continued_session","continued_data","continued_step","stepChanged","cant_continue_session","new_step","stepWillChange","sheet_exists","sessionDataLoadError","end_time","start_time","dataSaveError","sessionEventError","sessionDataLoaded","session_data","continue_session","pretest_info","getScreenForStep","PretestTrial","button_labels","trial_chord","on_keep_going","keep_going","trials_count","subtest","keepGoing","cont_trial_idx","audio_mapping","test_a_indexing","timbre","test_c_indexing","SubtestInfo","test_num","is_free","info_div","TestBlock","test_idx","trial_num","show_info","loading","replay_count","is_playing","make_test_sequence","make_subtest_a_seq","test_data","make_subtest_c_seq","timbres","cur_timbre","c","trnsp","trnsps","startTrials","answer_received","trial_info","variant","replay","cont_sequence","cont_show_info","next_trial_button","replay_button","SubtestsBlock","subtests_count","nextTest","cont_test_order","test_order","cont_test_idx","PersonalInfoScreen","songsQuestionnaire","saveData","age","test","genderMaleChecked","checked","genderFemaleChecked","gender","musical_background","residence","education","big_maj_recognition","small_maj_recognition","small_min_recognition","half_dim_recognition","hwcomputer","hwdisplay","hwmouse","hwheadphones","form_data","computer","display","mouse","headphones","imagine_familiarity","imagine_like","caesaria_familiarity","caesaria_like","rocketman_familiarity","rocketman_like","britolam_familiarity","britolam_like","songsForm","numbered_options","keys","style","fontWeight","htmlFor","maxLength","rows","cols","LoginScreen","TestInfo","TestExperiment","sheet_suffix","LOGIN","SUB_TESTS_FREE","SUB_TESTS_FAST","PERSONAL_INFO","altered_step","subject_data","cont_data","cont_step","test_info","Boolean","window","location","hostname","match","App","exact","path","ReactDOM","render","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.4a982ff7.chunk.js","sourcesContent":["export const LessonType = {\n  MUSICAL_PIECES: 0,\n  TONAL_CONTEXT: 1,\n  AUTOMATIC: 2,\n};\n\nexport const Chords = {\n  BIG_MAJOR: \"' \",\n  SMALL_MAJOR: \"' \",\n  SMALL_MINOR: \" \",\n  HALF_DIM:\" \"\n}\n\nexport const Timbres = {\n  PIANO: 0,\n  GUITAR: 1,\n  SONG: 2,\n}\n\nexport const StaticImages = {\n  happySmiley: \"static_images/happySmiley.jpg\",\n  sadSmiley: \"static_images/sadSmiley.png\",\n}\n\nexport const Strings = {\n  continue_text: \"\",\n  success_identification: \"  \",\n  failure_identification: \"   \",\n  how_it_sounds: \"  \",\n};\n\nexport const SheetNames = {\n  TRAINING_SESSIONS: \"TrainingSessions\",\n  LESSON_TYPES: \"LessonTypes\",\n  SUBJECTS_DATA: \"SubjectsData\",\n}\n\n// For MUSICAL_CONTEXT lessons. A mapping of chord name to the image and song name that goes with it.\nexport let musical_pieces_data = {};\nmusical_pieces_data[Chords.BIG_MAJOR] = {\n  imgSrc: \"song_images/song1.png\",\n  name: \"Imagine\",\n};\nmusical_pieces_data[Chords.SMALL_MAJOR] = {\n  imgSrc: \"song_images/song2.png\",\n  name: \" \"\n};\nmusical_pieces_data[Chords.SMALL_MINOR] = {\n  imgSrc: \"song_images/song3.png\",\n  name: \"Rocket man\"\n};\nmusical_pieces_data[Chords.HALF_DIM] = {\n  imgSrc: \"song_images/song4.png\",\n  name: \" \"\n};\n","import React from 'react';\nimport { LessonType } from '../defs.js';\n\nexport function IntroText() {\n  return (\n    <div className = \"IntroText\">\n      <p>\n         35 . \n         .\n           .      . \n       ,   ,     ()   .\n      </p>\n      <p>\n                .       ,      ,       (    .       ).\n      </p>\n      <p>\n                -  ,  ,   .         ,     .\n            .      ,     , , ,     .\n      </p>\n      <p>\n           ,         .\n      </p>\n    </div>);\n}\n\nexport function InfoText({lesson_type}) {\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    return (\n      <div>\n        <p>      (  )     .</p>\n        <p>       .          .</p>\n        <p>      .         .</p>\n        <p>         .</p>\n        <p>   ,      <a href=\"mailto:yaeljm@gmail.com\">yaeljm@gmail.com</a>    0528931467,    .</p>\n        <p>!</p>\n      </div>\n    );\n\n  case LessonType.TONAL_CONTEXT:\n    return (\n      <div>\n        <p>      (  )    :          .</p>\n        <p>       .          .</p>\n        <p>      .         .</p>        \n        <p>         .</p>\n        <p>   ,      <a href=\"mailto:yaeljm@gmail.com\">yaeljm@gmail.com</a>    0528931467,    .</p>\n        <p>!</p>\n      </div>\n    );\n\n  case LessonType.AUTOMATIC:\n    return (\n      <div>\n        <p>      (  )    .</p>\n        <p>       .          .</p>\n        <p>      .         .</p>\n        <p>         .</p>\n        <p>   ,      <a href=\"mailto:yaeljm@gmail.com\">yaeljm@gmail.com</a>    0528931467,    .</p>\n        <p>!</p>\n      </div>\n    );\n  }\n}\n\nexport const PretestInfo = () => {\n  return (\n    <div>\n      <p>    4 .          .</p>\n      <p>        .</p>\n      <p>      .</p>\n    </div>\n  );\n};\n","let audioIdx2File = (idx) => \"audio/\" + idx + \".mp3\";\n\nexport class AudioController {\n  constructor(srcs, onDoneLoading, onAudioEnded) {\n    this.players = [];\n    this.ids2players = {};\n    this.players2ids = {};\n    for (const id of srcs) {\n      const playerIdx = this.players.length;\n\n      if (id in this.ids2players) {\n        continue;\n      }\n\n      this.ids2players[id] = playerIdx;\n      this.players2ids[playerIdx] = id;\n\n      const p = new Audio(audioIdx2File(id));\n      p.addEventListener('canplaythrough', (e => {this.audioLoaded(p)}), false);\n      p.addEventListener('ended', (e => {\n        if (this.onAudioEnded) this.onAudioEnded(id)\n      }), false);\n\n      this.players.push(p);\n    }\n\n    console.log(\"Loading \" + this.players.length + \" audio files\");\n    this.loadCount = 0;\n    this.onDoneLoading = onDoneLoading;\n    this.onAudioEnded = onAudioEnded;\n  }\n\n  audioLoaded(player) {\n    this.loadCount+=1;\n    if (this.loadCount === this.players.length) {\n      if (this.onDoneLoading) this.onDoneLoading();\n    }\n  }\n\n  play(audio_id) {\n    const playerIdx = this.ids2players[audio_id];\n    this.players[playerIdx].play()\n      .catch(err => {\n        console.log(\"Error while playing audio file.\");\n      });\n  }\n\n  stop(audio_id) {\n    const playerIdx = this.ids2players[audio_id];\n    this.players[playerIdx].pause();\n    this.players[playerIdx].currentTime = 0;\n  }\n}\n","import React from 'react';\nimport { Strings } from './defs.js';\n\nexport const LoadingScreen = () => {\n  return <div className=\"containter text-center\"><p className=\"lead\">...</p></div>;\n};\n\nexport const ErrorScreen = ({error}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-sm\">\n          <p> :</p>\n          <p className=\"lead center\">{error}</p>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport const InfoScreen = ({info, next}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-md-8 offset-md-2 infotext\">\n          {info}\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col\"></div>\n        <div className=\"col text-center\">\n          <br/>\n          <ContinueButton next={next} disabled={false} />\n        </div>\n        <div className=\"col\"></div>\n      </div>\n    </div>\n  );\n};\n\nexport const Button = ({label, onClick, disabled, className}) => {\n  const classNameStr = className ? \"btn \" + className : \"btn btn-primary\";\n\n  return disabled ? \n    <button type=\"button\" className={classNameStr} onClick={onClick} disabled>{label}</button> :\n    <button type=\"button\" className={classNameStr} onClick={onClick}>{label}</button>;\n};\n\nexport const ContinueButton = ({next, disabled, className}) => {\n  return <Button label={Strings.continue_text} onClick={next} disabled={disabled} className={className} />;\n};\n\nexport const ReplayButton = ({onClick, disabled}) => {\n  const label = <img src=\"static_images/speaker.png\" />;\n  return <Button label={label} disabled={disabled} onClick={onClick} className=\"btn-basic btn-replay\" />;\n};\n\n/* 4 buttons in a square layout with fixation point in the middle. Each button is assigned a value to be passed to \n   the next function when it's clicked. */\nexport const ButtonTable = ({labels, values, disabled, next}) => {\n  const gen_button = (btn_idx) => {\n    if (disabled) \n      return <button className=\"chordBtn\" disabled onClick={(e) => next(values[btn_idx])}>{labels[btn_idx]}</button>;\n    else \n      return <button className=\"chordBtn\" onClick={(e) => next(values[btn_idx])}>{labels[btn_idx]}</button>;\n  };\n\n  return (\n    <table className=\"chordSelection\">\n      <tbody>\n        <tr>\n          <td>{gen_button(0)}</td>\n          <td></td>\n          <td>{gen_button(1)}</td>\n        </tr>\n        <tr>\n          <td></td>\n          <td className=\"plusSign align-middle\">+</td>\n          <td></td>\n        </tr>\n        <tr>\n          <td>{gen_button(2)}</td>\n          <td></td>\n          <td>{gen_button(3)}</td>\n        </tr>\n      </tbody>\n    </table>   \n  );\n};\n\nexport const ComboBox = ({id, options}) => {\n  return (\n    <select id={id} name={id} defaultValue=\"-\">\n      <option hidden disabled value=\"-\"></option>\n      {options.map(opt => <option value={opt} key={opt}>{opt}</option>)}\n    </select>\n  );\n};\n","export const repeatArray = (arr, count) => {\n  const ln = arr.length;\n  let b = [];\n\n  for (let i=0; i<count; i++) {      \n    b.push(arr[i%ln]);      \n  }\n      \n  return b;      \n};\n\n/* random int between min and max inclusive. */\nexport const randomInt = (min, max) => \n  Math.floor(Math.random() * (max - min + 1) + min);\n\nexport const randomElement = arr => arr[randomInt(0, arr.length-1)];\n\nexport const shuffleArray = arr => arr\n  .map(a => [Math.random(), a])\n  .sort((a, b) => a[0] - b[0])\n  .map(a => a[1]);\n\nexport const randomSequence = (items, length) => shuffleArray(repeatArray(items, length));\n\nexport const pick_unique_two = arr => {\n  const fst_idx = randomInt(0, arr.length-1);\n  const fst = arr[fst_idx];\n  const snd = randomElement(arr.slice(0, fst_idx).concat(arr.slice(fst_idx+1, arr.length)));\n  return [fst, snd];\n};\n","import React from 'react';\nimport { musical_pieces_data, LessonType, Chords } from '../defs.js';\nimport { AudioController } from '../audio_controller.js';\nimport { InfoScreen, LoadingScreen, ContinueButton } from '../ui.js';\nimport { randomSequence } from '../randomize.js';\nimport ls from 'local-storage';\n\n// Recordings used in each lesson type and part. i.e. \n// for part 1 and musical_pieces lesson: lesson_data.musical_pieces[1]\nlet lesson_data = {\n  musical_pieces: [\n    [[1, Chords.BIG_MAJOR], [2, Chords.SMALL_MAJOR], [3, Chords.SMALL_MINOR], [4, Chords.HALF_DIM]],\n    [[5, Chords.BIG_MAJOR], [6, Chords.SMALL_MAJOR], [7, Chords.SMALL_MINOR], [8, Chords.HALF_DIM]],\n    [[1009, Chords.BIG_MAJOR], [1013, Chords.SMALL_MAJOR], [1017, Chords.SMALL_MINOR], [1021, Chords.HALF_DIM]],\n  ],\n  tonal_context: [\n    [[25, Chords.BIG_MAJOR], [26, Chords.SMALL_MAJOR], [27, Chords.SMALL_MINOR], [28, Chords.HALF_DIM]],\n    [[29, Chords.BIG_MAJOR], [30, Chords.SMALL_MAJOR], [31, Chords.SMALL_MINOR], [32, Chords.HALF_DIM]],\n    [[33, Chords.BIG_MAJOR], [35, Chords.SMALL_MAJOR], [37, Chords.SMALL_MINOR], [39, Chords.HALF_DIM],\n     [34, Chords.BIG_MAJOR], [36, Chords.SMALL_MAJOR], [38, Chords.SMALL_MINOR], [40, Chords.HALF_DIM]],\n  ],\n  automatic: [\n    [[9, Chords.BIG_MAJOR], [13, Chords.SMALL_MAJOR], [17, Chords.SMALL_MINOR], [21, Chords.HALF_DIM]],\n    [[41, Chords.BIG_MAJOR], [45, Chords.SMALL_MAJOR], [49, Chords.SMALL_MINOR], [53, Chords.HALF_DIM]],\n    [[41, Chords.BIG_MAJOR], [45, Chords.SMALL_MAJOR], [49, Chords.SMALL_MINOR], [53, Chords.HALF_DIM],\n     [9, Chords.BIG_MAJOR], [13, Chords.SMALL_MAJOR], [17, Chords.SMALL_MINOR], [21, Chords.HALF_DIM]],\n  ],\n};\n\n// The UI for AUTOMATIC and TONAL_CONTEXT lesson trials.\nconst NameOfChord = props => {\n  let { chordName, lesson_type } = props;\n  let description = \"\";\n  if (lesson_type === LessonType.TONAL_CONTEXT)\n    description = \"  :\";\n  else if (lesson_type === LessonType.AUTOMATIC)\n    description = \" :\";\n\n  return (\n    <div className = \"row text-center successScreenWrapper\">\n      <div className=\"col-sm-8 offset-sm-2 align-middle\">\n        <span className=\"chordName\">\n          {description}\n        <br />\n        { chordName }\n        </span>\n      </div>\n    </div>\n  );\n};\n\n// The UI for MUSICAL_PIECES lesson trials.\nconst SongWithoutChords = props => {\n  let { chordName } = props;\n  let { songData } = props;\n  return(\n    <div className=\"songDisplayWrapper\">\n      <img className=\"songImage\" src={ songData.imgSrc } alt=\"\"/>\n      <div className=\"row\">\n        <div className=\"col text-center\">\n          <div className=\"songTitle\">\n             :\n            <br/>\n            { songData.name }\n            <br/>\n            <br/>\n             :\n            <br/>\n            { chordName }\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n// This component represents one part of the lesson. There are 3 parts. The only difference \n// between them is the audio sequence. Audio playing code is here.\nclass LessonPart extends React.Component {\n  state = {\n    trial_idx: 0,\n    done_playing: false,\n    done_loading: false,\n  }\n\n  constructor({part, session, next}) {\n    super();\n    this.part = part;\n    this.next = next;\n    this.state.done_loading = false;\n    this.trials_per_part = 16;\n    this.session = session;\n\n    switch (this.session.lesson_type) {\n    case LessonType.MUSICAL_PIECES:\n      this.part_data = lesson_data.musical_pieces[part];\n      break;\n    case LessonType.TONAL_CONTEXT:\n      this.part_data = lesson_data.tonal_context[part];\n      break;\n    case LessonType.AUTOMATIC:\n      this.part_data = lesson_data.automatic[part];\n      break;\n    };\n\n    this.ls_prefix = \"lesson_part\" + part + \"_\";\n    if (session.continued) {\n      this.sequence = ls.get(this.ls_prefix + \"sequence\");\n      const trial_idx = ls.get(this.ls_prefix + \"trial_idx\");\n      if (trial_idx !== null) this.state.trial_idx = trial_idx;\n      session.continued = false;\n    }\n    else {\n      this.sequence = randomSequence(this.part_data, this.trials_per_part);\n      ls.set(this.ls_prefix + \"sequence\", this.sequence);\n      ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx);\n    }\n\n//    console.log(\"LESSON PART \" + part + \" sequence:\");\n//    console.log(this.sequence);\n\n    const that = this;\n    const doneLoadingAudio = () => {\n      that.setState({done_loading: true});\n      that.audioController.play(this.sequence[that.state.trial_idx][0]);\n    };\n\n    const donePlaying = () => {\n      that.setState({done_playing: true});\n    };\n\n    this.audioController = new AudioController(this.part_data.map(d => d[0]), doneLoadingAudio, donePlaying);\n  }\n\n  render() {\n    const that = this;\n    const nextTrial = () => {\n      const trial_idx = that.state.trial_idx;\n      if (trial_idx < that.trials_per_part - 1) {\n        that.setState({trial_idx: trial_idx+1,\n                       done_playing: false});\n        that.audioController.play(this.sequence[trial_idx+1][0]);\n        ls.set(this.ls_prefix + \"trial_idx\", trial_idx + 1);\n      }\n      else {\n        that.next();\n      }\n    };\n\n    const trialData  = this.sequence[this.state.trial_idx];\n    const chordName = trialData[1];\n    const songData = musical_pieces_data[chordName];\n\n    if (this.state.done_loading) {\n      let screen;\n      if (this.session.lesson_type === LessonType.MUSICAL_PIECES) {\n        screen = <SongWithoutChords chordName={chordName} songData={songData}/>;\n      }\n      else {\n        screen = <NameOfChord chordName={chordName} lesson_type={this.session.lesson_type}/>;\n      }\n      const button = this.state.done_playing ? (\n          <div className=\"row\">\n            <div className=\"col-sm-8 offset-sm-2 text-center\">\n              <br/>\n              <ContinueButton next={nextTrial} />\n            </div>\n          </div>) : null;\n\n      return (\n        <div className=\"container\">\n          {screen}\n          {button}\n        </div>\n      );\n    }\n    else {\n      return <LoadingScreen />;\n    }\n  }\n}\n\nconst InfoBeforeLessonPartA = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = \n      <div>\n        <p>       .   ,     ,   .</p>\n        <p>          ,     .       .</p>\n      </div>;\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info = \n      <div>\n        <p>   .           .    ,     ,   .</p>\n        <p>          ,     .       .</p>\n      </div>;\n    break;\n  case LessonType.AUTOMATIC:\n    info = \n      <div>\n        <p>  . </p>\n        <p>          ,     .       .</p>\n      </div>;\n    break;\n  };\n\n  return <InfoScreen info={info} next={next}/>;\n};\n\nconst InfoBeforeLessonPartB = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = \n      <p>\n           ,      . \n        ,     ,   .\n                ,     .       .\n      </p>;\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info =\n      <p>\n           ,     . \n        ,     ,   .\n                ,     .       .\n      </p>;\n    break;\n  case LessonType.AUTOMATIC:\n    info = \n      <p>\n           ,     .           ,     .       .\n      </p>;\n    break;\n  };\n\n  return <InfoScreen info={info} next={next}/>;\n};\n\nconst InfoBeforeLessonPartC = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = <p>       ,         .</p>;\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info = <p>         .</p>;\n    break;\n  case LessonType.AUTOMATIC:\n    info = <p>          -  .</p>;\n    break;\n  };\n\n  return <InfoScreen info={info} next={next}/>;\n};\n\n// The main lesson block component.\nexport class LessonBlock extends React.Component {\n  steps = {\n    INFO_A: 1,\n    PART_A: 2,\n    INFO_B: 3,\n    PART_B: 4, \n    INFO_C: 5,\n    PART_C: 6,\n    DONE: 7,\n  }\n\n  state = {\n    step: 1,\n  }\n\n  nextStep = () => {\n    const { step } = this.state;\n\n    this.setState({\n      step: step + 1\n    });\n    ls.set(\"lesson_block_step\", step + 1);\n\n    if (step + 1 === this.steps.DONE)\n      this.next();\n  }\n\n  state = {\n    step: 1,\n  };\n  \n  constructor({data, session, next}) {\n    super();\n    this.data = data;\n    this.session = session;\n    this.next = next;\n\n    if (session.continued) {\n      this.state.step = ls.get(\"lesson_block_step\", this.state.step);\n    }\n    else {\n      ls.set(\"lesson_block_step\", this.state.step);\n    }\n  }\n  \n  render() {\n    const {step} = this.state;\n    let screen;\n\n    switch(step) {\n    case this.steps.INFO_A:\n      this.session.continued = false;\n      screen = <InfoBeforeLessonPartA lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_A:\n      screen = <LessonPart part={0} session={this.session} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.INFO_B:\n      this.session.continued = false;\n      screen = <InfoBeforeLessonPartB lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_B:\n      screen = <LessonPart part={1} session={this.session} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.INFO_C:\n      this.session.continued = false;\n      screen = <InfoBeforeLessonPartC lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_C:\n      screen = <LessonPart part={2} session={this.session} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.DONE:\n      this.nextStep();\n    }\n\n    return screen;\n  }\n}\n","import React from 'react';\nimport { AudioController } from '../audio_controller.js';\nimport { LessonType, Strings, StaticImages, Chords, Timbres, musical_pieces_data } from '../defs.js';\nimport { InfoScreen, LoadingScreen, ContinueButton, ButtonTable } from '../ui.js';\nimport { randomSequence, shuffleArray } from '../randomize.js';\nimport ls from 'local-storage';\n\n// each trial entry is [audio_idx, chord, transposition, timbre]\nconst training_data = {\n  musical_pieces: [\n    [[1, Chords.BIG_MAJOR, 0, null], [2, Chords.SMALL_MAJOR, 0, null], \n     [3, Chords.SMALL_MINOR, 0, null], [4, Chords.HALF_DIM, 0, null]],\n    [[5, Chords.BIG_MAJOR, 0, null], [6, Chords.SMALL_MAJOR, 0, null], \n     [7, Chords.SMALL_MINOR, 0, null], [8, Chords.HALF_DIM, 0, null]],\n    [ // piano recordings\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [10, Chords.BIG_MAJOR, 1, Timbres.PIANO], \n      [11, Chords.BIG_MAJOR, 2, Timbres.PIANO], [12, Chords.BIG_MAJOR, 3, Timbres.PIANO],\n      [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO], [14, Chords.SMALL_MAJOR, 1, Timbres.PIANO],\n      [15, Chords.SMALL_MAJOR, 2, Timbres.PIANO], [16, Chords.SMALL_MAJOR, 3, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [18, Chords.SMALL_MINOR, 1, Timbres.PIANO], \n      [19, Chords.SMALL_MINOR, 2, Timbres.PIANO], [20, Chords.SMALL_MINOR, 3, Timbres.PIANO],\n      [21, Chords.HALF_DIM, 0, Timbres.PIANO], [22, Chords.HALF_DIM, 1, Timbres.PIANO], \n      [23, Chords.HALF_DIM, 2, Timbres.PIANO], [24, Chords.HALF_DIM, 3, Timbres.PIANO],\n      // guitar recordings\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [42, Chords.BIG_MAJOR, 1, Timbres.GUITAR], \n      [43, Chords.BIG_MAJOR, 2, Timbres.GUITAR], [44, Chords.BIG_MAJOR, 3, Timbres.GUITAR],\n      [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR], [46, Chords.SMALL_MAJOR, 1, Timbres.GUITAR], \n      [47, Chords.SMALL_MAJOR, 2, Timbres.GUITAR], [48, Chords.SMALL_MAJOR, 3, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [50, Chords.SMALL_MINOR, 1, Timbres.GUITAR], \n      [51, Chords.SMALL_MINOR, 2, Timbres.GUITAR], [52, Chords.SMALL_MINOR, 3, Timbres.GUITAR],\n      [53, Chords.HALF_DIM, 0, Timbres.GUITAR], [54, Chords.HALF_DIM, 1, Timbres.GUITAR], \n      [55, Chords.HALF_DIM, 2, Timbres.GUITAR], [56, Chords.HALF_DIM, 3, Timbres.GUITAR],\n    ],\n  ],\n  tonal_context: [\n    [ // piano\n      [25, Chords.BIG_MAJOR, 0, Timbres.PIANO], [26, Chords.SMALL_MAJOR, 0, Timbres.PIANO],\n      [27, Chords.SMALL_MINOR, 0, Timbres.PIANO], [28, Chords.HALF_DIM, 0, Timbres.PIANO],\n      // guitar\n      [29, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [30, Chords.SMALL_MAJOR, 0, Timbres.GUITAR],\n      [31, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [32, Chords.HALF_DIM, 0, Timbres.GUITAR],\n    ],\n    [ // piano\n      [33, Chords.BIG_MAJOR, 0, Timbres.PIANO], [35, Chords.SMALL_MAJOR, 0, Timbres.PIANO],\n      [37, Chords.SMALL_MINOR, 0, Timbres.PIANO], [39, Chords.HALF_DIM, 0, Timbres.PIANO],\n      // guitar\n      [34, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [36, Chords.SMALL_MAJOR, 0, Timbres.GUITAR],\n      [38, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [40, Chords.HALF_DIM, 0, Timbres.GUITAR],\n    ],\n    [ // piano recordings\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [10, Chords.BIG_MAJOR, 1, Timbres.PIANO], \n      [11, Chords.BIG_MAJOR, 2, Timbres.PIANO], [12, Chords.BIG_MAJOR, 3, Timbres.PIANO],\n      [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO], [14, Chords.SMALL_MAJOR, 1, Timbres.PIANO],\n      [15, Chords.SMALL_MAJOR, 2, Timbres.PIANO], [16, Chords.SMALL_MAJOR, 3, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [18, Chords.SMALL_MINOR, 1, Timbres.PIANO], \n      [19, Chords.SMALL_MINOR, 2, Timbres.PIANO], [20, Chords.SMALL_MINOR, 3, Timbres.PIANO],\n      [21, Chords.HALF_DIM, 0, Timbres.PIANO], [22, Chords.HALF_DIM, 1, Timbres.PIANO], \n      [23, Chords.HALF_DIM, 2, Timbres.PIANO], [24, Chords.HALF_DIM, 3, Timbres.PIANO],\n      // guitar recordings\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [42, Chords.BIG_MAJOR, 1, Timbres.GUITAR], \n      [43, Chords.BIG_MAJOR, 2, Timbres.GUITAR], [44, Chords.BIG_MAJOR, 3, Timbres.GUITAR],\n      [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR], [46, Chords.SMALL_MAJOR, 1, Timbres.GUITAR], \n      [47, Chords.SMALL_MAJOR, 2, Timbres.GUITAR], [48, Chords.SMALL_MAJOR, 3, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [50, Chords.SMALL_MINOR, 1, Timbres.GUITAR], \n      [51, Chords.SMALL_MINOR, 2, Timbres.GUITAR], [52, Chords.SMALL_MINOR, 3, Timbres.GUITAR],\n      [53, Chords.HALF_DIM, 0, Timbres.GUITAR], [54, Chords.HALF_DIM, 1, Timbres.GUITAR], \n      [55, Chords.HALF_DIM, 2, Timbres.GUITAR], [56, Chords.HALF_DIM, 3, Timbres.GUITAR],\n    ],\n  ],\n  automatic: [\n    [ // piano\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [21, Chords.HALF_DIM, 0, Timbres.PIANO],\n      // guitar\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [53, Chords.HALF_DIM, 0, Timbres.GUITAR],\n    ],\n    [ // piano\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [21, Chords.HALF_DIM, 0, Timbres.PIANO],\n      // guitar\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [53, Chords.HALF_DIM, 0, Timbres.GUITAR],\n    ],\n    [ // piano recordings\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [10, Chords.BIG_MAJOR, 1, Timbres.PIANO], \n      [11, Chords.BIG_MAJOR, 2, Timbres.PIANO], [12, Chords.BIG_MAJOR, 3, Timbres.PIANO],\n      [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO], [14, Chords.SMALL_MAJOR, 1, Timbres.PIANO],\n      [15, Chords.SMALL_MAJOR, 2, Timbres.PIANO], [16, Chords.SMALL_MAJOR, 3, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [18, Chords.SMALL_MINOR, 1, Timbres.PIANO], \n      [19, Chords.SMALL_MINOR, 2, Timbres.PIANO], [20, Chords.SMALL_MINOR, 3, Timbres.PIANO],\n      [21, Chords.HALF_DIM, 0, Timbres.PIANO], [22, Chords.HALF_DIM, 1, Timbres.PIANO], \n      [23, Chords.HALF_DIM, 2, Timbres.PIANO], [24, Chords.HALF_DIM, 3, Timbres.PIANO],\n      // guitar recordings\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [42, Chords.BIG_MAJOR, 1, Timbres.GUITAR], \n      [43, Chords.BIG_MAJOR, 2, Timbres.GUITAR], [44, Chords.BIG_MAJOR, 3, Timbres.GUITAR],\n      [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR], [46, Chords.SMALL_MAJOR, 1, Timbres.GUITAR], \n      [47, Chords.SMALL_MAJOR, 2, Timbres.GUITAR], [48, Chords.SMALL_MAJOR, 3, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [50, Chords.SMALL_MINOR, 1, Timbres.GUITAR], \n      [51, Chords.SMALL_MINOR, 2, Timbres.GUITAR], [52, Chords.SMALL_MINOR, 3, Timbres.GUITAR],\n      [53, Chords.HALF_DIM, 0, Timbres.GUITAR], [54, Chords.HALF_DIM, 1, Timbres.GUITAR], \n      [55, Chords.HALF_DIM, 2, Timbres.GUITAR], [56, Chords.HALF_DIM, 3, Timbres.GUITAR],\n    ],\n  ],\n};\n\nconst correction_data = {\n  [LessonType.MUSICAL_PIECES]: [\n    {[Chords.BIG_MAJOR]: 9, [Chords.SMALL_MAJOR]: 13, [Chords.SMALL_MINOR]: 17, [Chords.HALF_DIM]: 21 },\n    {[Chords.BIG_MAJOR]: 9, [Chords.SMALL_MAJOR]: 13, [Chords.SMALL_MINOR]: 17, [Chords.HALF_DIM]: 21 },\n    null,\n  ],\n  [LessonType.TONAL_CONTEXT]: [\n    {[Chords.BIG_MAJOR]: 9, [Chords.SMALL_MAJOR]: 13, [Chords.SMALL_MINOR]: 17, [Chords.HALF_DIM]: 21 },\n    {[Chords.BIG_MAJOR]: 9, [Chords.SMALL_MAJOR]: 13, [Chords.SMALL_MINOR]: 17, [Chords.HALF_DIM]: 21 },\n    null,\n  ],\n  [LessonType.AUTOMATIC]: [null, null, null]\n};\n\nconst TrainingInfo = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = (\n      <div>\n      <p>          .   ,      .</p>\n      <p>      ,    .</p>\n      </div>);\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info = (\n      <div>\n        <p>           ,       .</p>\n        <p>      ,    .</p>\n      </div>);\n    break;\n  case LessonType.AUTOMATIC:\n    info = (\n      <div>\n        <p>    ,     ,    .</p>\n      </div>);\n  }\n  return <InfoScreen next={next} info={info}/>;\n};\n\nconst InfoBeforeTrainingPartB = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = (\n      <div>\n        <p>    ,      ,      .</p>\n        <p>      ,    .</p>\n      </div>);\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info = <p>       .       ,    .</p>;\n    break;\n  case LessonType.AUTOMATIC:\n    info = <p>:     ,     ,    .</p>;\n    break;\n  }\n  return <InfoScreen info={info} next={next}/>;\n};\n\nconst InfoBeforeTrainingPartC = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = <p>    ,   ,     ,    .</p>;\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info = <p>    ,   ,     ,    .</p>;\n    break;\n  case LessonType.AUTOMATIC:\n    info = <p>:     ,     ,    .</p>;\n    break;\n  }\n  return <InfoScreen info={info} next={next}/>;\n};\n\nconst SuccessfulIdentification = props => {\n  const { next } = props;\n  return (\n    <div className=\"row successScreenWrapper\">\n      <div className=\"col-sm-8 offset-sm-2 text-center\">\n        <span className=\"songTitle\"> { Strings.success_identification } &nbsp;</span>\n        <img src= { StaticImages.happySmiley } width=\"150px\" height=\"150px\" alt=\"\"/>\n        <br/>\n        <br/>\n        <ContinueButton next={next} />\n      </div>\n    </div>\n  );\n};\n\nconst FailedIdentification = props => {\n  const { shouldShowCorrect, shouldShowButton, correctChord, lesson_type, part, next} = props;\n\n  let appendix;\n\n  if (shouldShowCorrect === true){\n    const button = shouldShowButton ? <ContinueButton next={next} /> : null;\n    let text;\n    if (part === 2 || lesson_type === LessonType.AUTOMATIC) text = \"    \";\n    else if (lesson_type === LessonType.MUSICAL_PIECES) text = \"   \";\n    else text = \"   \";\n    \n    appendix = \n      <div>\n        <span className=\"songTitle\">{ text } </span>\n        <span className=\"songTitle\">{ correctChord }</span>\n        <br/>\n        <span className=\"songTitle\">{ Strings.how_it_sounds }</span>\n        <br/>\n        <br/>\n        {button}\n      </div>;\n  } else appendix = null;\n\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-sm-9 offset-sm-1 text-center\">\n            <span className=\"songTitle\"> { Strings.failure_identification } &nbsp;</span>\n            <br/>\n            <span className=\"songTitle\">{ Strings.how_it_sounds }</span>\n            { appendix }\n        </div>\n        <div className=\"col-sm-2\">\n          <img src= { StaticImages.sadSmiley } width=\"150px\" height=\"150px\" alt=\"\" className=\"sadSmiley\"/>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst SongWithChords = props => {\n  const { songData, chord_buttons, disabled, next } = props;\n\n  const gen_button = (chord, i) => {\n    if (disabled) \n      return <td key={i}><button className=\"chordBtn\" disabled key={i} onClick={(e) => next(chord)}>{chord}</button></td>;\n    else \n      return <td key={i}><button className=\"chordBtn\" key={i} onClick={(e) => next(chord)}>{chord}</button></td>;\n  };\n\n  return (\n    <div className=\"songDisplayWrapper\">\n      <img className=\"songImage\" src={ songData.imgSrc } alt=\"\"/>\n      <div className=\"row\">\n        <div className=\"col text-center songTitle\">\n           :\n          <br/>\n          { songData.name }\n          <br/>\n          <br/>\n           :\n        </div>\n\n      </div>\n      <div className=\"row chordsTable text-center\">\n        <div className=\"col text-center chords\">\n          <table className=\"chordsTable text-center\">\n            <tbody>\n              <tr>\n                {chord_buttons.map((chord, i) => gen_button(chord, i))}\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst ChordSelection = ({chord_buttons, disabled, with_song_names, next}) => {\n  const labels = chord_buttons.map(chord => with_song_names ? \n                                   <p>{chord} <br/> {musical_pieces_data[chord].name}</p> : \n                                   <p>{chord}</p>);\n\n  return <ButtonTable labels={labels} values={chord_buttons} disabled={disabled} next={next} />;\n};\n\nclass TrainingPart extends React.Component {\n  state = {\n    trial_idx: 0,\n    done_loading: false,\n    done_playing: false,\n    show_feedback: false,\n    answer: null,\n  };\n\n  trials_per_part = 32;\n\n  constructor({part, session, chord_buttons, next, data}) {\n    super();\n    this.part = part;\n    this.session = session;\n    this.chord_buttons = chord_buttons;\n    this.next = next;\n    this.data = data;\n\n    switch (session.lesson_type) {\n    case LessonType.MUSICAL_PIECES:\n      this.part_data = training_data.musical_pieces[part];\n      break;\n    case LessonType.TONAL_CONTEXT:\n      this.part_data = training_data.tonal_context[part];\n      break;\n    case LessonType.AUTOMATIC:\n      this.part_data = training_data.automatic[part];\n      break;\n    };\n\n    this.ls_prefix = \"training_part\" + part + \"_\";\n    if (session.continued) {\n      this.sequence = ls.get(this.ls_prefix + \"sequence\");\n      const trial_idx = ls.get(this.ls_prefix + \"trial_idx\");\n      if (trial_idx !== null) this.state.trial_idx = trial_idx;\n      session.continued = false; // we only need to restore session once!\n    }\n    else {\n      this.sequence = randomSequence(this.part_data, this.trials_per_part);\n      ls.set(this.ls_prefix + \"sequence\", this.sequence);\n      ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx);\n    }\n//    console.log(\"TRAINING PART \" + part + \" sequence:\");\n//    console.log(this.sequence);\n\n    const that = this;\n    const doneLoadingAudio = () => {\n      that.setState({done_loading: true});\n      that.audioController.play(that.sequence[that.state.trial_idx][0]);\n      that.response_start = new Date();\n    };\n\n    const donePlaying = () => {\n      that.setState({done_playing: true});\n      \n      // this part runs when we give feedback for an incorrect answer.\n      if (this.state.show_feedback) {\n        if (!this.state.fail_show_correct) {\n          // play the correct answer audio idx\n          this.audioController.play(this.state.correct_audio_idx);\n          this.setState({fail_show_correct: true});\n        } else {\n          // done playing feedback, show continue button.\n          this.setState({done_playing_correct_feedback: true});\n        }\n      }\n    };\n\n    let correction_idxs = [];\n    const corrections_for_part = correction_data[this.session.lesson_type][this.part];\n    if (corrections_for_part !== null) {\n      for (const chord in corrections_for_part)\n        correction_idxs.push(corrections_for_part[chord]);\n    }\n\n    this.audioController = new AudioController(correction_idxs.concat(this.part_data.map(d => d[0])), doneLoadingAudio, donePlaying);\n  }\n\n  /* calculate the transposition count since the beginning of training (currently of part). */\n  get_transposition_play_count() { \n    const idx = this.state.trial_idx;\n    const trial = this.sequence[idx];\n    const count_in_part = this.sequence.slice(0, idx)\n      .filter(t => t[1] === trial[1] && t[2] === trial[2]).length + 1;\n    return count_in_part;\n  }\n\n  render() {\n    const that = this;\n    const trial_data = this.sequence[this.state.trial_idx];\n    const chord_name = trial_data[1];\n    const transposition = trial_data[2];\n\n    const nextTrial = () => {\n      const trial_idx = that.state.trial_idx;\n      if (trial_idx < that.trials_per_part - 1) {\n        that.setState({trial_idx: trial_idx + 1,\n                       done_playing: false,\n                       show_feedback: false});\n        that.audioController.play(this.sequence[trial_idx+1][0]);\n        that.response_start = new Date(); // RT measurement\n      }\n      else {\n        that.next();\n      }\n    };\n\n    const processAnswer = (answer) => {\n      const correct = answer === chord_name;\n      // save trial data\n      const td = {\n        time: new Date().toString(),\n        audio_index: trial_data[0],\n        chord_number: that.trials_per_part * this.part + this.state.trial_idx + 1,\n        chord_type: chord_name,\n        transposition: transposition + 1,\n        transposition_play_count: that.get_transposition_play_count(),\n        selected_chord_type: answer,\n        correct: correct,\n        response_time: new Date() - that.response_start,\n      };\n      that.data.trials.push(td);\n      ls.set(\"data\", that.data);\n      if (this.state.trial_idx+1 < this.trials_per_part)\n        ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx+1);\n\n      // stop playback\n      that.audioController.stop(trial_data[0]);\n\n      // continue to show answer feedback\n      if (!correct) {\n        // start playing the chosen chord and then the right chord.\n        // [idx, chord, trnsp, timbre]\n\n        const corrections_for_part = correction_data[this.session.lesson_type][this.part];\n        const selected_audio_idx = corrections_for_part !== null ?\n              corrections_for_part[answer] :\n              that.part_data.filter(d => d[1] === answer && d[2] === transposition && d[3] === trial_data[3])[0][0];\n\n        const correct_audio_idx = corrections_for_part !== null ?\n              corrections_for_part[trial_data[1]] :\n              trial_data[0];\n\n        this.setState({show_feedback: true,\n                       correct: correct,\n                       fail_show_correct: false,\n                       done_playing_correct_feedback: false,\n                       correct_audio_idx: correct_audio_idx});\n        that.audioController.play(selected_audio_idx);\n      }\n      else {        \n        that.setState({show_feedback: true,\n                       correct: correct});\n      }\n    };\n    \n    if (!this.state.done_loading) \n      return <LoadingScreen />;\n\n    if (!this.state.show_feedback) {\n      let screen;\n      if (this.part === 0 && this.session.lesson_type === LessonType.MUSICAL_PIECES) {\n        const song_data = musical_pieces_data[chord_name];\n        screen = <SongWithChords songData={song_data} chord_buttons={this.chord_buttons} next={processAnswer}/>;\n      }\n      else {\n        screen = <ChordSelection chord_buttons={this.chord_buttons} next={processAnswer}/>;\n      }\n      \n      return (\n        <div className=\"container\">\n          {screen}\n        </div>\n      );\n    }\n    else { // show feedback screen\n      if (this.state.correct) {\n        return <SuccessfulIdentification next={nextTrial}/>;\n      } else {\n        this.nextTrial = nextTrial;\n        return <FailedIdentification shouldShowCorrect={this.state.fail_show_correct} shouldShowButton={this.state.done_playing_correct_feedback} correctChord={chord_name} lesson_type={this.session.lesson_type} next={nextTrial} part={this.part}/>;\n      }\n    }\n  }\n};\n\nexport class TrainingBlock extends React.Component {\n  steps = {\n    INFO_A: 1,\n    PART_A: 2,\n    INFO_B: 3,\n    PART_B: 4,\n    INFO_C: 5,\n    PART_C: 6,\n    DONE: 7,\n  }\n\n  state = {\n    step: 1,\n  }\n\n  chord_buttons = shuffleArray([Chords.BIG_MAJOR, Chords.SMALL_MAJOR, Chords.SMALL_MINOR, Chords.HALF_DIM]);\n\n  nextStep = () => {\n    const { step } = this.state;\n    \n    this.setState({\n      step: step + 1\n    });\n    ls.set(\"training_block_step\", step + 1);\n\n    if (step + 1 === this.steps.DONE)\n      this.next();\n  }\n\n  constructor({data, session, next}) {\n    super();\n    this.data = data;\n    this.session = session;\n    this.next = next;\n\n    if (session.continued) {\n      this.chord_buttons = ls.get(\"training_block_chord_buttons\");      \n      this.state.step = ls.get(\"training_block_step\");\n    }\n    else {\n      ls.set(\"training_block_chord_buttons\", this.chord_buttons);\n      ls.set(\"training_block_step\", this.state.step);\n    }\n  }\n\n  render() {\n    const { step } = this.state;\n    let screen;\n    switch (step) {\n    case this.steps.INFO_A:\n      this.session.continued = false;\n      screen = <TrainingInfo lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_A:\n      screen = <TrainingPart part={0} session={this.session} next={this.nextStep} key={step} chord_buttons={this.chord_buttons} data={this.data} />;\n      break;\n    case this.steps.INFO_B:\n      this.session.continued = false;\n      screen = <InfoBeforeTrainingPartB lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_B:\n      screen = <TrainingPart part={1} session={this.session} next={this.nextStep} key={step} chord_buttons={this.chord_buttons} data={this.data} />;\n      break;\n    case this.steps.INFO_C:\n      this.session.continued = false;\n      screen = <InfoBeforeTrainingPartC lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_C:\n      screen = <TrainingPart part={2} session={this.session} next={this.nextStep} key={step} chord_buttons={this.chord_buttons} data={this.data} />;\n      break;\n    case this.steps.DONE:\n      screen = null;\n      break;\n    };\n\n    return screen;\n  }\n}\n","/* functions for reading and writing to a google spreadsheet.\n   \n */\n\nconst read_url = \"https://sheets.googleapis.com/v4/spreadsheets/\";\n\n// https://stackoverflow.com/questions/1714786/query-string-encoding-of-a-javascript-object\nexport const serialize = function(obj, prefix) {\n  var str = [],\n    p;\n  for (p in obj) {\n    if (obj.hasOwnProperty(p)) {\n      var k = prefix ? prefix + \"[\" + p + \"]\" : p,\n        v = obj[p];\n      str.push((v !== null && typeof v === \"object\") ?\n        serialize(v, k) :\n        encodeURIComponent(k) + \"=\" + encodeURIComponent(v));\n    }\n  }\n  console.log(\"serialize: \" + str.join(\"&\"));\n  return str.join(\"&\");\n}\n\nconst parse_sheet_list = (data) => {\n  let sheetNames = [];\n  data.sheets.forEach(sheet => {\n    sheetNames.push(sheet.properties.title);\n  });\n  return sheetNames;\n};\n\nconst gs = {\n  read: function(conn, sheetName, range) {\n    return fetch(read_url + \n                 conn.spreadsheet_id + \n                 \"/values/\" + \n                 sheetName + \n                 \"!\" + range + \n                 \"?key=\" + conn.api_key);\n  },\n\n  write: function(conn, sheetName, data) {\n    if (!Array.isArray(data))\n        data = [data];\n\n    let url = conn.write_url + \"?sheet_name=\" + sheetName;\n    return fetch(url,\n                 {\n                   headers: {\n                     'Accept': 'application/json',\n                     'Content-Type': 'application/json'\n                   },\n                   method: \"POST\",\n                   mode: 'no-cors',\n                   body: JSON.stringify(data),\n                 });\n  },\n\n  list_sheets: function(conn) {\n    return fetch(read_url + conn.spreadsheet_id + \"?key=\" + conn.api_key)\n      .then(res => res.json())\n      .then(parse_sheet_list);\n  },\n};\n\nexport default gs;\n","import gs from './spreadsheet_io.js';\nimport { SheetNames } from './defs.js';\nimport ls from 'local-storage';\n\nconst FIRST_HOUR_OF_DAY = 3; // day starts at 3 am.\n\nexport const SessionEvent = {\n  SESSION_START: \"SESSION_START\",\n  SESSION_CONTINUED: \"SESSION_CONTINUED\",\n  SESSION_END: \"SESSION_END\",\n};\n\n// parse session json data from sheets api into an array of session objects.\nexport const parseSessions = (data) => {\n  let sessions = [];\n  data.values.forEach(session_event => {\n    let session = {\n      id: session_event[0],\n      number: session_event[1],\n      event: session_event[2],\n      lesson_type: session_event[3],\n      time: session_event[4],\n    };\n    sessions.push(session);\n  });\n  return sessions;\n};\n\nexport const writeSessionEvent = (conn, session, event, on_error) => {\n  let request_data = Object.assign({event: event,\n                                    time: new Date().toString()},\n                                    session);\n  ls.set('session', session);\n  gs.write(conn, SheetNames.TRAINING_SESSIONS, request_data)\n    .catch(on_error);\n\n};\n\nexport const readSessionData = (conn) => {\n  return gs.read(conn, SheetNames.TRAINING_SESSIONS, \"A2:E10000\")\n    .then(response => response.json())\n    .then(parseSessions);\n  \n};\n\nexport const readLessonType = (conn, id) => {\n  const findLessonType = (data) => {\n    let lesson_type = -1;\n    data.values.forEach(row => {\n      if (row[0] === id)\n        lesson_type = parseInt(row[1]);\n    });    \n    return lesson_type;\n  }\n\n  return gs.read(conn, SheetNames.LESSON_TYPES, \"A2:B10000\")\n    .then(response => response.json())\n    .then(findLessonType);\n};\n\n// Return true if the last session was today. Day starts at FIRST_HOUR_OF_DAY\nexport const was_last_session_today = (last_session) => {\n  let last_time = new Date(last_session.time);\n  last_time.setHours(last_time.getHours() - FIRST_HOUR_OF_DAY);\n  let now = new Date();\n  now.setHours(now.getHours() - FIRST_HOUR_OF_DAY);\n  return now.getDate() === last_time.getDate();\n};\n\nexport const does_user_sheet_exists = (conn, user_id) => {\n  return gs.list_sheets(conn)\n    .then(sheets => sheets.includes(user_id));\n};\n\nexport const read_subject_data = (conn, id) => {\n  return gs.read(conn, SheetNames.SUBJECTS_DATA, \"A2:C10000\")\n    .then(response => response.json())\n    .then(data => {\n      let ret = null;\n\n      data.values.forEach(row => {\n        if (row[0] === id) {\n          ret = {\n            lesson_type: row[1],\n            chord_button_labels: JSON.parse(row[2])\n          };\n        }\n      });\n\n      return ret;\n    });\n};\n","import React from 'react';\nimport '../Experiment.css';\nimport './TrainingExperiment.css';\nimport { IntroText, InfoText, PretestInfo } from './info.js';\nimport { LessonBlock } from './lesson_block.js';\nimport { TrainingBlock } from './training_block.js';\nimport { InfoScreen, LoadingScreen, ErrorScreen, ContinueButton, ButtonTable } from '../ui.js';\nimport { does_user_sheet_exists, was_last_session_today, SessionEvent, writeSessionEvent, readSessionData, readLessonType } from '../sessions.js';\nimport { randomSequence } from '../randomize.js';\nimport gs from '../spreadsheet_io.js';\nimport ls from 'local-storage';\n\nconst MAX_NUMBER_OF_SESSIONS = 5;\n\n// 1st screen.\nconst IntroScreen = ({next, data}) => {\n  function handleContinue() {\n    data.id = document.getElementById('id_input').value;\n    next();\n  }\n\n  return ( // the hidden p tag is there to balance the \" marks\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-md-8 offset-md-2 infotext\">\n          <IntroText />\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col\"></div>\n        <div className=\"col text-center\">\n          <br/>\n          <label>\": <input type=\"text\" id=\"id_input\"/><br/></label>\n          <p hidden>\"</p>\n          <br/>\n          <ContinueButton next={handleContinue} disabled={false} />\n        </div>\n        <div className=\"col\"></div>\n      </div>\n    </div>\n  );\n};\n\nconst FinishScreen = ({done_saving, session_number}) => {\n  const remaining = MAX_NUMBER_OF_SESSIONS - session_number;\n  return (\n    <div className=\"container\">\n      <div className=\"col-md-8 offset-md-2\">\n        <p>  {session_number} .   {remaining} .</p>\n        <p>{done_saving ? \"  !\" : \"   ...\"}</p>\n      </div>\n    </div>\n  );\n};\n\nconst ContinueScreen = ({session_number, next}) => {\n  const info = <p className=\"text-center\">        {session_number}.</p>;\n  return <InfoScreen info={info} next={next} />;\n};\n\nclass PretestBlock extends React.Component {\n  state = {\n    trial_idx: 0,\n  };\n\n  practice_trials_count = 8;\n  test_trails_count = 20;\n  button_idxs = [0, 1, 2, 3];\n\n  constructor({session, next, data}) {\n    super();\n    this.next = next;\n    this.data = data;\n    this.session = session;\n\n    this.ls_prefix = \"pretest_\";\n    if (session.continued) {\n      this.sequence = ls.get(this.ls_prefix + \"sequence\");\n      const trial_idx = ls.get(this.ls_prefix + \"trial_idx\");\n      if (trial_idx !== null) this.state.trial_idx = trial_idx;\n      session.continued = false;\n    }\n    else {\n      const practice_sequence = randomSequence(this.button_idxs, this.practice_trials_count);\n      const test_sequence = randomSequence(this.button_idxs, this.test_trails_count);\n      this.sequence = practice_sequence.concat(test_sequence);\n      ls.set(this.ls_prefix + \"sequence\", this.sequence);\n      ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx);\n    }\n\n//    console.log(\"Pretest sequence:\");\n//    console.log(this.sequence);\n    this.response_start = new Date();\n  }\n\n  render() {\n    const that = this;\n    const target_btn = this.sequence[this.state.trial_idx];\n\n    const nextTrial = (selection) => {\n      if (this.state.trial_idx+1 > this.practice_trials_count) {\n        // save trial data\n        const correct = selection === target_btn;\n        const td = {\n          time: new Date().toString(),\n          correct: correct,\n          response_time: new Date() - that.response_start,\n          session_number: 0,\n        };\n        that.data.trials.push(td);\n        ls.set(\"data\", that.data);\n      }\n\n      if (this.state.trial_idx < that.practice_trials_count + that.test_trails_count - 1) {\n        that.setState({trial_idx: this.state.trial_idx + 1});\n        that.response_start = new Date();\n        ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx+1);\n      }\n      else {\n        that.next();\n      }\n    };\n    let labels = [null, null, null, null];\n    labels[target_btn] = <div className=\"pretestCircle\"></div>;\n    return (\n      <div className=\"container\">\n        <ButtonTable labels={labels} values={this.button_idxs} next={nextTrial} key={this.state.trial_idx}/>\n      </div>\n    );\n  }\n};\n\nclass TrainingExperiment extends React.Component {\n  conn = { // read/write connection details for google spreadsheet.\n    spreadsheet_id: '1D2s3D13ldvchzueCFWTkvH8kzhNBEMZzizPnjGQnhMY',\n    api_key: 'AIzaSyDHFHbGy_GhEt1Q4FW61YYEX2jk3hZcSoQ',\n    write_url: 'https://script.google.com/macros/s/AKfycbxv6Uc9VsHlKI6SMe6YmH-MELryrJYvYg-uQnGFhyMF2X7zyC-O/exec',\n  }\n\n  steps = {\n    INTRO: 1,\n    INFO: 2, \n    PRETEST_INFO: 3,\n    PRETEST: 4, \n    LESSON: 5,\n    TRAINING: 6,\n    FINISH: 7\n  }\n\n  state = {\n    step: 1,\n    is_loading_session: true, // true until session data is received.\n    did_check_user_registered: false, // false until sheet list is received.\n    done_saving: false, // false until the data is saved to the spreadsheet.\n    max_sessions_reached: false,\n    session_done_for_today: false,\n    user_unregistered: true,\n    did_load_registration_list: false,\n    did_load_lesson_type: false,\n  };\n\n  data = {\n    id: undefined,\n    trials: [],\n  };\n\n  maybe_start_session = () => {\n    // Check previous sessions data. Start a new session accordingly\n    // or enforce session limits.\n    let session = {id: this.data.id};\n    const previous_sessions = this.sessions.filter(e => e.id === session.id);\n    if (previous_sessions.length === 0) {\n      // First session\n      ls.clear();\n      session.number = 1;\n      this.setState({did_load_lesson_type: false});\n      readLessonType(this.conn, session.id)\n        .then(lesson_type => {\n          if (lesson_type === -1)\n            this.setState({session: session, \n                           user_unregistered: true,\n                           did_load_lesson_type: true});\n          else {\n            session.lesson_type = lesson_type;\n            writeSessionEvent(this.conn, session, \n                              SessionEvent.SESSION_START);\n            \n            this.setState({session: session,\n                           did_load_lesson_type: true});\n          }\n\n        })\n        .catch(err => { alert(\"Error while reading lessons: \" + err); });\n    }\n    else {\n      // Not first session\n      const last_session = previous_sessions[previous_sessions.length-1];\n      const last_session_number = parseInt(last_session.number);\n      \n      session.lesson_type = parseInt(last_session.lesson_type);\n      if (last_session.event !== SessionEvent.SESSION_END) {\n        // The last session for this subject id isn't finished.\n        if (was_last_session_today(last_session)) {\n          // Same day. Try to continue the last session.\n          session.number = last_session_number;\n          // Retreive session and data from local storage.\n          console.log(\"Looking for session data in local storage.\");\n          const continued_session = ls.get('session');\n          if (continued_session && continued_session.id === session.id) {\n            session = continued_session;\n            const continued_data = ls.get('data');\n            if (continued_data) {\n              console.log(\"Loading experiment data from local storage.\");\n              this.data = continued_data;\n            }\n            \n            const continued_step = ls.get('step');\n            \n            session.continued = true;\n            this.setState({continued_step: continued_step || this.steps.INFO,\n                           session: session});\n            this.stepChanged(continued_step);\n          } \n          else {\n            // Can't continue session. Redo the session (this shouldn't actually happen)\n            ls.clear();\n            session.number = last_session_number;\n            writeSessionEvent(this.conn, session, \n                                SessionEvent.SESSION_START);\n            this.setState({session: session});\n          }\n        }\n        else {\n          // A new day.\n          ls.clear();\n          this.setState({cant_continue_session: true,\n                         session: session});\n        }\n      }\n      else {\n        // The last session was finished. \n        ls.clear();\n        if (last_session_number >= MAX_NUMBER_OF_SESSIONS) {\n          // enforce the session limit.\n          this.setState({max_sessions_reached: true,\n                         session: session});\n        }\n        else {\n          if (!was_last_session_today(last_session)) {\n            // Start a new session\n            session.number = last_session_number + 1;\n            writeSessionEvent(this.conn, session, \n                              SessionEvent.SESSION_START);\n            this.setState({session: session});\n          }\n          else {\n            // No more sessions for today.\n            this.setState({session_done_for_today: true,\n                           session: session});\n          }\n        }\n      }\n    }\n  }\n\n  nextStep = () => {\n    const { step } = this.state;\n    let new_step;\n\n    // jump over pretest after the 1st session.\n    if (this.state.session && this.state.session.number && \n        this.state.session.number !== 1 && (step + 1 === this.steps.PRETEST_INFO || step + 1 === this.steps.PRETEST)) \n      new_step = this.steps.LESSON;\n    else \n      new_step = step + 1;\n\n    if (step > 1) // otherwise the key will be overwritten before loading.\n      ls.set('step', new_step);\n    this.stepWillChange(step, new_step);\n    this.setState({\n      step: new_step\n    });\n    this.stepChanged(new_step);\n  }\n\n  stepWillChange = (step, new_step) => {\n    if (step === this.steps.INTRO) {\n      does_user_sheet_exists(this.conn, this.data.id)\n        .then((sheet_exists) => { \n          this.setState({did_load_registration_list: true});\n          if (sheet_exists) {\n            this.setState({user_unregistered: false});\n            this.maybe_start_session(); \n          }\n          else this.setState({user_unregistered: true, session: {}});\n        }).catch(this.sessionDataLoadError);\n    }\n  } \n\n  stepChanged = (step) => {   \n    if (step === this.steps.FINISH) {\n      // end of session. \n      this.data.end_time = new Date().toString();\n\n      // write data\n      console.log(\"Saving data...\");\n//      console.log(this.data.trials);\n\n      this.data.trials.forEach(t => { \n        t.id = this.data.id;\n        if (t.session_number === undefined)\n          t.session_number = this.state.session.number;\n        t.start_time = this.data.start_time;\n        t.end_time = this.data.end_time;\n      });\n\n      let that = this;\n      gs.write(this.conn, this.data.id, this.data.trials)\n        .then(res => { that.setState({done_saving: true});\n                       ls.clear(); })\n        .catch(this.dataSaveError);\n\n      // write session ended event\n      writeSessionEvent(this.conn, this.state.session, \n                        SessionEvent.SESSION_END, this.sessionEventError);\n      // TODO: need to make sure both writes finished before setting done_saving: true!\n\n      // clear session from local storage. TODO: also do this only after both saves are done.\n\n    }\n  }\n\n  dataSaveError = (response) => {\n    alert(\"Error while saving data: \" + response);\n  }\n\n  sessionEventError = (response) => { // TODO\n    alert(\"Error while writing session event.\");\n  }\n\n  sessionDataLoaded = (session_data) => {\n    this.setState({ is_loading_session: false });\n    this.sessions = session_data;\n  }\n\n  sessionDataLoadError = (response) => { // TODO\n    // ask to refresh the page, try again... contact info?\n    alert(\"Session data load error: \" + response);\n  }\n\n  componentDidMount() {\n    // read session data\n    var that = this;\n    \n    readSessionData(this.conn)\n      .then(that.sessionDataLoaded)\n      .catch(that.sessionDataLoadError);\n\n    this.data.start_time = new Date().toString();\n  }\n\n  getScreenForStep(step) {\n    let screen;\n    switch(step) {\n      case this.steps.INTRO:\n        screen = <IntroScreen data={this.data} next={this.nextStep} />;\n        break;\n      case this.steps.INFO:\n        this.state.session.continued = false;\n        const info = <InfoText lesson_type={this.state.session.lesson_type} />;\n        screen = <InfoScreen info={info} next={this.nextStep}/>;\n        break;\n      case this.steps.PRETEST_INFO:\n        this.state.session.continued = false;\n        const pretest_info = <PretestInfo />;\n        screen = <InfoScreen info={pretest_info} next={this.nextStep} />;\n        break;\n      case this.steps.PRETEST:\n        screen = <PretestBlock data={this.data} next={this.nextStep} session={this.state.session} />;\n        break;\n      case this.steps.LESSON:\n        screen = <LessonBlock data={this.data} next={this.nextStep} session={this.state.session} />;\n        break;\n      case this.steps.TRAINING:\n        screen = <TrainingBlock data={this.data} next={this.nextStep} session={this.state.session} />;\n        break;\n      case this.steps.FINISH:\n        screen = <FinishScreen done_saving={this.state.done_saving} session_number={this.state.session.number} />;\n    }\n    \n    return screen;\n  } \n\n  continue_session = () => {\n    const { continued_step, step } = this.state;\n    this.stepWillChange(step, continued_step);\n    this.setState({\n      step: continued_step,\n      continued_step: undefined\n    });\n    this.stepChanged(continued_step);\n\n    writeSessionEvent(this.conn, this.state.session, \n                      SessionEvent.SESSION_CONTINUED, this.sessionEventError);\n  }\n\n  render() {\n    const {step} = this.state;\n\n    let screen;\n\n    if (this.state.is_loading_session || !this.state.did_load_lesson_type)\n      screen = <LoadingScreen />;\n    \n    if (this.state.continued_step !== undefined) {\n      screen = <ContinueScreen session_number={this.state.session.number} next={this.continue_session}/>;\n    } else if (this.state.step === 2) {\n      // After entering ID on the intro screen we check the session data before continuing.\n      if (!this.state.did_load_registration_list || !this.state.session) \n        screen = <LoadingScreen />;\n      else {\n        if (this.state.max_sessions_reached)\n          screen = <ErrorScreen error=\"    .\" />;\n        else if (this.state.session_done_for_today)\n          screen = <ErrorScreen error=\"      .    .\" />;\n        else if (this.state.did_load_registration_list && this.state.user_unregistered)\n          screen = <ErrorScreen error=\"    !       .\" />;\n        else if (this.state.cant_continue_session) \n          screen = <ErrorScreen error=\"    .    .     .\" />;\n        else screen = this.getScreenForStep(step);\n      }\n    }\n    else screen = this.getScreenForStep(step);\n\n    return screen;\n  }\n}\n\nexport default TrainingExperiment;\n","import React from 'react';\nimport { Button, ButtonTable } from '../ui.js';\nimport ls from 'local-storage';\nimport { randomSequence } from '../randomize.js';\n\nconst PretestTrial = ({button_labels, next, trial_idx, trial_chord}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"overlay-box\"><p>{trial_chord}</p></div>\n      <div className=\"row\">\n        <ButtonTable labels={button_labels} values={button_labels} next={next} key={trial_idx} />\n      </div>\n    </div>    \n\n  );\n};\n\nconst ContinueScreen = ({next, on_keep_going}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col text-center\">\n          <p>    ?</p>\n        </div>\n      </div>\n      <br/>\n      <div className=\"row\">\n        <div className=\"col-sm-2 offset-sm-4 text-center\">\n          <Button label=\"\" onClick={on_keep_going}/>\n        </div>      \n        <div className=\"col-sm-2 text-center\">\n          <Button label=\"\" onClick={next}/>\n        </div>\n      </div>            \n    </div>\n  );\n};\n\nexport class PretestBlock extends React.Component {\n  state = {\n    trial_idx: 0,\n    keep_going: false,\n  }\n\n  trials_count = 14;\n\n  ls_prefix = \"test_pretest_\";\n\n  constructor({data, next, button_labels}) {\n    super();\n    this.data = data;\n    this.next = next;\n    this.button_labels = button_labels;\n    \n    const cont_trial_idx = ls.get(this.ls_prefix + \"trial_idx\");\n    if (cont_trial_idx !== null) {      \n      console.log(\"loading sequence from local storage\");\n      this.sequence = ls.get(this.ls_prefix + \"sequence\");\n      this.state.trial_idx = cont_trial_idx;\n    }\n    else {\n      this.sequence = randomSequence(button_labels, this.trials_count);\n      ls.set(this.ls_prefix + \"sequence\", this.sequence);\n      ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx);      \n    }\n//    console.log(\"sequence:\");\n//    console.log(this.sequence);\n  }\n\n  nextTrial = (answer) => {\n    const { trial_idx } = this.state;\n\n    this.data.trials.push({\n      time: new Date().toString(),\n      subtest: 0,\n      chord_type: this.sequence[trial_idx % this.trials_count],\n      selected_chord_type: answer,\n      correct: answer === this.sequence[trial_idx % this.trials_count],\n      response_time: new Date() - this.response_start\n    });\n    ls.set(\"test_data\", this.data);\n\n    this.setState({trial_idx: trial_idx + 1,\n                   keep_going: false});\n    ls.set(this.ls_prefix + \"trial_idx\", trial_idx + 1);\n    this.response_start = new Date();\n  }\n\n  keepGoing = () => {\n    this.sequence = randomSequence(this.button_labels, this.trials_count);\n    ls.set(this.ls_prefix + \"sequence\", this.sequence);      \n    console.log(\"sequence:\");\n    console.log(this.sequence);\n    this.setState({keep_going: true});\n    this.response_start = new Date();\n  };\n\n  componentDidMount() {\n    this.response_start = new Date();\n  }\n  \n  render() {\n    const { trial_idx } = this.state;\n    if (trial_idx > 0 && this.state.keep_going === false && ((trial_idx) % this.trials_count === 0)) {\n      return <ContinueScreen next={this.next} on_keep_going={this.keepGoing} />;\n    }\n    else {\n      return <PretestTrial button_labels={this.button_labels} next={this.nextTrial} trial_idx={this.state.trial_idx} trial_chord={this.sequence[this.state.trial_idx % this.trials_count]}/>;\n    }\n  }\n}\n\n","import { Chords, Timbres } from '../defs.js';\n\n// subtest number -> [[audio_idx, chord, transposition, timbre], ...]\nexport const audio_mapping = [\n  // Subtest A\n  [[57, Chords.BIG_MAJOR, 0, Timbres.PIANO], [58, Chords.BIG_MAJOR, 1, Timbres.PIANO],\n   [59, Chords.BIG_MAJOR, 2, Timbres.PIANO], [60, Chords.BIG_MAJOR, 3, Timbres.PIANO],\n   [61, Chords.SMALL_MAJOR, 0, Timbres.PIANO], [62, Chords.SMALL_MAJOR, 1, Timbres.PIANO],\n   [63, Chords.SMALL_MAJOR, 2, Timbres.PIANO], [64, Chords.SMALL_MAJOR, 3, Timbres.PIANO],\n   [65, Chords.SMALL_MINOR, 0, Timbres.PIANO], [66, Chords.SMALL_MINOR, 1, Timbres.PIANO],\n   [67, Chords.SMALL_MINOR, 2, Timbres.PIANO], [68, Chords.SMALL_MINOR, 3, Timbres.PIANO],\n   [69, Chords.HALF_DIM, 0, Timbres.PIANO], [70, Chords.HALF_DIM, 1, Timbres.PIANO],\n   [71, Chords.HALF_DIM, 2, Timbres.PIANO], [72, Chords.HALF_DIM, 3, Timbres.PIANO],\n\n   [73, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [74, Chords.BIG_MAJOR, 1, Timbres.GUITAR],\n   [75, Chords.BIG_MAJOR, 2, Timbres.GUITAR], [76, Chords.BIG_MAJOR, 3, Timbres.GUITAR],\n   [77, Chords.SMALL_MAJOR, 0, Timbres.GUITAR], [78, Chords.SMALL_MAJOR, 1, Timbres.GUITAR],\n   [79, Chords.SMALL_MAJOR, 2, Timbres.GUITAR], [80, Chords.SMALL_MAJOR, 3, Timbres.GUITAR],\n   [81, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [82, Chords.SMALL_MINOR, 1, Timbres.GUITAR],\n   [83, Chords.SMALL_MINOR, 2, Timbres.GUITAR], [84, Chords.SMALL_MINOR, 3, Timbres.GUITAR],\n   [85, Chords.HALF_DIM, 0, Timbres.GUITAR], [86, Chords.HALF_DIM, 1, Timbres.GUITAR],\n   [87, Chords.HALF_DIM, 2, Timbres.GUITAR], [88, Chords.HALF_DIM, 3, Timbres.GUITAR],   \n  ],\n\n  // Subtest B\n  [[89, Chords.BIG_MAJOR, 0, Timbres.SONG], [90, Chords.SMALL_MAJOR, 0, Timbres.SONG],\n   [91, Chords.SMALL_MINOR, 0, Timbres.SONG], [92, Chords.HALF_DIM, 0, Timbres.SONG],\n   [93, Chords.BIG_MAJOR, 1, Timbres.SONG], [94, Chords.BIG_MAJOR, 2, Timbres.SONG],\n   [95, Chords.BIG_MAJOR, 3, Timbres.SONG], [96, Chords.SMALL_MAJOR, 1, Timbres.SONG],\n   [97, Chords.SMALL_MAJOR, 2, Timbres.SONG], [98, Chords.SMALL_MAJOR, 3, Timbres.SONG],\n   [99, Chords.SMALL_MINOR, 1, Timbres.SONG], [100, Chords.SMALL_MINOR, 2, Timbres.SONG],\n   [101, Chords.SMALL_MINOR, 3, Timbres.SONG], [102, Chords.HALF_DIM, 1, Timbres.SONG],\n   [103, Chords.HALF_DIM, 3, Timbres.SONG], [104, Chords.HALF_DIM, 2, Timbres.SONG],\n  ],\n\n  // Subtest C\n  [[105, Chords.BIG_MAJOR, 0, Timbres.PIANO], [106, Chords.BIG_MAJOR, 1, Timbres.PIANO],\n   [107, Chords.BIG_MAJOR, 2, Timbres.PIANO], [108, Chords.BIG_MAJOR, 3, Timbres.PIANO],\n   [109, Chords.BIG_MAJOR, 0, Timbres.PIANO], [110, Chords.BIG_MAJOR, 1, Timbres.PIANO],\n   [111, Chords.BIG_MAJOR, 2, Timbres.PIANO], [112, Chords.BIG_MAJOR, 3, Timbres.PIANO],\n   [113, Chords.BIG_MAJOR, 0, Timbres.PIANO], [114, Chords.BIG_MAJOR, 1, Timbres.PIANO],\n   [115, Chords.BIG_MAJOR, 2, Timbres.PIANO], [116, Chords.BIG_MAJOR, 3, Timbres.PIANO],\n   [117, Chords.BIG_MAJOR, 0, Timbres.PIANO], [118, Chords.BIG_MAJOR, 1, Timbres.PIANO],\n   [119, Chords.BIG_MAJOR, 2, Timbres.PIANO], [120, Chords.BIG_MAJOR, 3, Timbres.PIANO],\n\n   [121, Chords.SMALL_MAJOR, 0, Timbres.PIANO], [122, Chords.SMALL_MAJOR, 1, Timbres.PIANO],\n   [123, Chords.SMALL_MAJOR, 2, Timbres.PIANO], [124, Chords.SMALL_MAJOR, 3, Timbres.PIANO],\n   [125, Chords.SMALL_MAJOR, 0, Timbres.PIANO], [126, Chords.SMALL_MAJOR, 1, Timbres.PIANO],\n   [127, Chords.SMALL_MAJOR, 2, Timbres.PIANO], [128, Chords.SMALL_MAJOR, 3, Timbres.PIANO],\n   [129, Chords.SMALL_MAJOR, 0, Timbres.PIANO], [130, Chords.SMALL_MAJOR, 1, Timbres.PIANO],\n   [131, Chords.SMALL_MAJOR, 2, Timbres.PIANO], [132, Chords.SMALL_MAJOR, 3, Timbres.PIANO],\n   [133, Chords.SMALL_MAJOR, 0, Timbres.PIANO], [134, Chords.SMALL_MAJOR, 1, Timbres.PIANO],\n   [135, Chords.SMALL_MAJOR, 2, Timbres.PIANO], [136, Chords.SMALL_MAJOR, 3, Timbres.PIANO],\n\n   [137, Chords.SMALL_MINOR, 0, Timbres.PIANO], [138, Chords.SMALL_MINOR, 1, Timbres.PIANO],\n   [139, Chords.SMALL_MINOR, 2, Timbres.PIANO], [140, Chords.SMALL_MINOR, 3, Timbres.PIANO],\n   [141, Chords.SMALL_MINOR, 0, Timbres.PIANO], [142, Chords.SMALL_MINOR, 1, Timbres.PIANO],\n   [143, Chords.SMALL_MINOR, 2, Timbres.PIANO], [144, Chords.SMALL_MINOR, 3, Timbres.PIANO],\n   [145, Chords.SMALL_MINOR, 0, Timbres.PIANO], [146, Chords.SMALL_MINOR, 1, Timbres.PIANO],\n   [147, Chords.SMALL_MINOR, 2, Timbres.PIANO], [148, Chords.SMALL_MINOR, 3, Timbres.PIANO],\n   [149, Chords.SMALL_MINOR, 0, Timbres.PIANO], [150, Chords.SMALL_MINOR, 1, Timbres.PIANO],\n   [151, Chords.SMALL_MINOR, 2, Timbres.PIANO], [152, Chords.SMALL_MINOR, 3, Timbres.PIANO],\n\n   [153, Chords.HALF_DIM, 0, Timbres.PIANO], [154, Chords.HALF_DIM, 1, Timbres.PIANO],\n   [155, Chords.HALF_DIM, 2, Timbres.PIANO], [156, Chords.HALF_DIM, 3, Timbres.PIANO],\n   [157, Chords.HALF_DIM, 0, Timbres.PIANO], [158, Chords.HALF_DIM, 1, Timbres.PIANO],\n   [159, Chords.HALF_DIM, 2, Timbres.PIANO], [160, Chords.HALF_DIM, 3, Timbres.PIANO],\n   [161, Chords.HALF_DIM, 0, Timbres.PIANO], [162, Chords.HALF_DIM, 1, Timbres.PIANO],\n   [163, Chords.HALF_DIM, 2, Timbres.PIANO], [164, Chords.HALF_DIM, 3, Timbres.PIANO],\n   [165, Chords.HALF_DIM, 0, Timbres.PIANO], [166, Chords.HALF_DIM, 1, Timbres.PIANO],\n   [167, Chords.HALF_DIM, 2, Timbres.PIANO], [168, Chords.HALF_DIM, 3, Timbres.PIANO],\n\n   // guitar\n   [169, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [170, Chords.BIG_MAJOR, 1, Timbres.GUITAR],\n   [171, Chords.BIG_MAJOR, 2, Timbres.GUITAR], [172, Chords.BIG_MAJOR, 3, Timbres.GUITAR],\n   [173, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [174, Chords.BIG_MAJOR, 1, Timbres.GUITAR],\n   [175, Chords.BIG_MAJOR, 2, Timbres.GUITAR], [176, Chords.BIG_MAJOR, 3, Timbres.GUITAR],\n   [177, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [178, Chords.BIG_MAJOR, 1, Timbres.GUITAR],\n   [179, Chords.BIG_MAJOR, 2, Timbres.GUITAR], [180, Chords.BIG_MAJOR, 3, Timbres.GUITAR],\n   [181, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [182, Chords.BIG_MAJOR, 1, Timbres.GUITAR],\n   [183, Chords.BIG_MAJOR, 2, Timbres.GUITAR], [184, Chords.BIG_MAJOR, 3, Timbres.GUITAR],\n\n   [185, Chords.SMALL_MAJOR, 0, Timbres.GUITAR], [186, Chords.SMALL_MAJOR, 1, Timbres.GUITAR],\n   [187, Chords.SMALL_MAJOR, 2, Timbres.GUITAR], [188, Chords.SMALL_MAJOR, 3, Timbres.GUITAR],\n   [189, Chords.SMALL_MAJOR, 0, Timbres.GUITAR], [190, Chords.SMALL_MAJOR, 1, Timbres.GUITAR],\n   [191, Chords.SMALL_MAJOR, 2, Timbres.GUITAR], [192, Chords.SMALL_MAJOR, 3, Timbres.GUITAR],\n   [193, Chords.SMALL_MAJOR, 0, Timbres.GUITAR], [194, Chords.SMALL_MAJOR, 1, Timbres.GUITAR],\n   [195, Chords.SMALL_MAJOR, 2, Timbres.GUITAR], [196, Chords.SMALL_MAJOR, 3, Timbres.GUITAR],\n   [197, Chords.SMALL_MAJOR, 0, Timbres.GUITAR], [198, Chords.SMALL_MAJOR, 1, Timbres.GUITAR],\n   [199, Chords.SMALL_MAJOR, 2, Timbres.GUITAR], [200, Chords.SMALL_MAJOR, 3, Timbres.GUITAR],\n\n   [201, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [202, Chords.SMALL_MINOR, 1, Timbres.GUITAR],\n   [203, Chords.SMALL_MINOR, 2, Timbres.GUITAR], [204, Chords.SMALL_MINOR, 3, Timbres.GUITAR],\n   [205, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [206, Chords.SMALL_MINOR, 1, Timbres.GUITAR],\n   [207, Chords.SMALL_MINOR, 2, Timbres.GUITAR], [208, Chords.SMALL_MINOR, 3, Timbres.GUITAR],\n   [209, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [210, Chords.SMALL_MINOR, 1, Timbres.GUITAR],\n   [211, Chords.SMALL_MINOR, 2, Timbres.GUITAR], [212, Chords.SMALL_MINOR, 3, Timbres.GUITAR],\n   [213, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [214, Chords.SMALL_MINOR, 1, Timbres.GUITAR],\n   [215, Chords.SMALL_MINOR, 2, Timbres.GUITAR], [216, Chords.SMALL_MINOR, 3, Timbres.GUITAR],\n\n   [217, Chords.HALF_DIM, 0, Timbres.GUITAR], [218, Chords.HALF_DIM, 1, Timbres.GUITAR],\n   [219, Chords.HALF_DIM, 2, Timbres.GUITAR], [220, Chords.HALF_DIM, 3, Timbres.GUITAR],\n   [221, Chords.HALF_DIM, 0, Timbres.GUITAR], [222, Chords.HALF_DIM, 1, Timbres.GUITAR],\n   [223, Chords.HALF_DIM, 2, Timbres.GUITAR], [224, Chords.HALF_DIM, 3, Timbres.GUITAR],\n   [225, Chords.HALF_DIM, 0, Timbres.GUITAR], [226, Chords.HALF_DIM, 1, Timbres.GUITAR],\n   [227, Chords.HALF_DIM, 2, Timbres.GUITAR], [228, Chords.HALF_DIM, 3, Timbres.GUITAR],\n   [229, Chords.HALF_DIM, 0, Timbres.GUITAR], [230, Chords.HALF_DIM, 1, Timbres.GUITAR],\n   [231, Chords.HALF_DIM, 2, Timbres.GUITAR], [232, Chords.HALF_DIM, 3, Timbres.GUITAR],\n  ],\n];\n\nexport const test_a_indexing = (chord, transposition, timbre) => {\n  let idx = 0;\n  if (timbre === Timbres.PIANO) idx += 0;\n  else if (timbre === Timbres.GUITAR) idx += 16;\n\n  switch (chord) {\n    case Chords.BIG_MAJOR: idx += 0; break;\n    case Chords.SMALL_MAJOR: idx += 4; break;\n    case Chords.SMALL_MINOR: idx += 8; break;\n    case Chords.HALF_DIM: idx += 12; break;\n  }\n\n  return idx + transposition;\n};\n\nexport const test_c_indexing = (chord, transposition, timbre, type) => {\n  /*\n  PIANO>\n    BIG_MAJOR:    0-15\n    SMALL_MAJOR: 16-31\n    SMALL_MINOR: 32-47\n    HALF_DIM:    48-63\n  GUITAR>\n    BIG_MAJOR:   64-79\n    SMALL_MAJOR: 80-95\n    SMALL_MINOR: 96-111\n    HALF_DIM:   112-127  \n  */\n\n  let idx = 0;\n  if (timbre === Timbres.PIANO) idx += 0;\n  else if (timbre === Timbres.GUITAR) idx += 64;\n\n  switch (chord) {\n    case Chords.BIG_MAJOR: idx += 0; break;\n    case Chords.SMALL_MAJOR: idx += 16; break;\n    case Chords.SMALL_MINOR: idx += 32; break;\n    case Chords.HALF_DIM: idx += 48; break;\n  }\n\n  return idx + type*4 + transposition;\n};\n","import React from 'react';\nimport { ReplayButton, ContinueButton, LoadingScreen, ButtonTable, InfoScreen } from '../ui.js';\nimport { Chords, Timbres } from '../defs.js';\nimport { audio_mapping, test_a_indexing, test_c_indexing } from './audio_mapping.js';\nimport ls from 'local-storage';\nimport { repeatArray, randomInt, randomElement, shuffleArray, randomSequence } from '../randomize.js';\nimport { AudioController } from '../audio_controller.js';\n\nconst SubtestInfo = ({test_num, is_free, next}) => {\n  let info;\n  switch (test_num) {\n  case 0:\n    if (is_free) {\n      info = <p>    .     ,    .          (  ).</p>;\n    }\n    else {\n      info = <p>    .     ,    .</p>;\n    }\n    break;\n  case 1:\n    if (is_free) {\n      info = <p>       .         .      .         .          (  ).</p>;\n    }\n    else {\n      info = <p>       .         .      .         .</p>;\n    }\n    break;\n  case 2:\n    if (is_free) {\n      info = <p>   .         (    ,   ,    ).  ,    ,     ,   .         ,    .          (  ).</p>;\n    }\n    else {\n      info = <p>   .         (    ,   ,    ).  ,    ,     ,   .         ,    .</p>;\n    }\n    break;\n  }\n\n  const info_div = <div>{info}</div>;\n  return <InfoScreen info={info_div} next={next} />;\n};\n\nclass TestBlock extends React.Component {\n  trial_num = 16\n\n  state = {\n    trial_idx: 0,\n    show_info: true,\n    loading: true,\n    replay_count: 2,\n    is_playing: true,\n  }\n\n  constructor({test_num, test_idx, is_free, chord_button_labels, next, data}) {\n    super();\n    this.test_num = test_num;\n    this.test_idx = test_idx;\n    this.is_free = is_free;\n    this.chord_button_labels = chord_button_labels;\n    this.next = next;\n    this.data = data;\n    this.ls_prefix = \"test_subtests_\" + (is_free ? \"free\" : \"fast\") + \"_testblock\" + test_num + \"_\";\n\n    this.test_data = audio_mapping[test_num];\n\n    const cont_sequence = ls.get(this.ls_prefix + \"sequence\");\n    if (cont_sequence !== null) {\n      this.sequence = cont_sequence;\n\n      const cont_trial_idx = ls.get(this.ls_prefix + \"trial_idx\");\n      if (cont_trial_idx !== null)\n        this.state.trial_idx = cont_trial_idx;\n\n      const cont_show_info = ls.get(this.ls_prefix + \"show_info\");\n      if (cont_show_info !== null)\n        this.state.show_info = cont_show_info;\n    }\n    else {       \n      this.sequence = this.make_test_sequence(test_num);\n      ls.set(this.ls_prefix + \"sequence\", this.sequence);\n      ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx);\n      ls.set(this.ls_prefix + \"show_info\", this.state.show_info);\n    }\n\n    console.log(\"Trial sequence:\");\n    console.log(this.sequence);\n\n    const that = this;\n    const doneLoadingAudio = () => {\n      that.setState({loading: false});\n    };\n\n    const donePlaying = () => {\n      that.setState({is_playing: false});\n    };\n\n    this.audioController = new AudioController(this.sequence.map(d => d[0]), doneLoadingAudio, donePlaying);\n\n    //console.log(\"Starting subtest \" + this.test_num + \". sequence:\");\n    //console.log(this.sequence);\n\n    if (!this.state.show_info) {\n      this.audioController.play(this.sequence[this.state.trial_idx][0]);\n      this.response_start = new Date();\n    }\n  }\n\n  make_test_sequence = (test_num) => {\n    switch (test_num) {\n    case 0:\n      return this.make_subtest_a_seq();\n    case 1:\n      return shuffleArray(this.test_data);\n    case 2:       \n      return this.make_subtest_c_seq();\n    default:\n      return null;\n    }\n  }\n  \n  make_subtest_a_seq = () => {\n    let sequence = [];    \n    let timbres = shuffleArray([...repeatArray([Timbres.PIANO], 8), \n                                ...repeatArray([Timbres.GUITAR], 8)]);\n    let cur_timbre = 0;\n    for (let c in Chords) {\n      for (let trnsp=0; trnsp<4; trnsp++) {\n        sequence.push(this.test_data[test_a_indexing(Chords[c], trnsp, timbres[cur_timbre])]);\n        cur_timbre++;\n      }\n    }\n\n    return shuffleArray(sequence);\n  }\n\n  make_subtest_c_seq = () => {\n    let sequence = [];\n    let timbres = shuffleArray([...repeatArray([Timbres.PIANO], 8), \n                                ...repeatArray([Timbres.GUITAR], 8)]);\n    let trnsps = shuffleArray(repeatArray([0,1,2,3], 16));\n    let i = 0;\n\n    for (let c in Chords) {\n      for (let type=0; type<4; type++) {\n        sequence.push(this.test_data[test_c_indexing(Chords[c], trnsps[i], timbres[i], type)]);\n        i++;\n      }\n    }\n    return shuffleArray(sequence);\n  }\n  \n  get_transposition_play_count = () => { \n    const idx = this.state.trial_idx;\n    const trial = this.sequence[idx];\n    return this.sequence.slice(0, idx)\n      .filter(t => t[1] === trial[1] && t[2] === trial[2]).length + 1;\n  }\n\n  startTrials = () => {\n    this.setState({show_info: false});\n    ls.set(this.ls_prefix + \"show_info\", false);\n\n    this.audioController.play(this.sequence[this.state.trial_idx][0]);\n    this.response_start = new Date();\n  }\n\n  nextTrial = () => {\n    const { trial_idx } = this.state;\n\n    this.audioController.stop(this.sequence[trial_idx][0]);\n\n    if (trial_idx + 1 >= this.sequence.length) {\n      this.next();\n    }\n    else {\n      this.setState({trial_idx: trial_idx + 1,\n                     answer_received: false,\n                     replay_count: 2,\n                     is_playing: true});\n      ls.set(this.ls_prefix + \"trial_idx\", trial_idx + 1);\n      ls.set(\"test_data\", this.data);\n\n      this.audioController.play(this.sequence[trial_idx+1][0]);\n      this.response_start = new Date();\n    }\n  }\n\n  processAnswer = (answer) => {\n    const { trial_idx } = this.state;\n\n    // collect data\n    const trial_info = this.sequence[trial_idx];\n    const td = {\n      time: new Date().toString(),\n      subtest: this.test_num + 1,\n      variant: trial_info[4],\n      audio_index: trial_info[0],\n      chord_number: this.trial_num * this.test_idx + this.state.trial_idx + 1,\n      chord_type: trial_info[1],\n      transposition: trial_info[2] + 1,\n      transposition_play_count: this.get_transposition_play_count(),\n      selected_chord_type: answer,\n      correct: answer === trial_info[1],\n      response_time: new Date() - this.response_start,\n    };\n\n    this.data.trials.push(td);\n\n    this.setState({answer_received: true,\n                   replay_count: 0});\n  }\n\n  replay = () => {\n    const { trial_idx, replay_count } = this.state;\n    this.setState({replay_count: replay_count-1,\n                   is_playing: true});\n    this.audioController.play(this.sequence[trial_idx][0]);\n  }\n\n  render() {\n    const { trial_idx, show_info, loading, answer_received, is_playing, replay_count } = this.state;\n    if (loading)\n      return <LoadingScreen />;\n    else if (show_info) {\n      return <SubtestInfo test_num={this.test_num} next={this.startTrials} is_free={this.is_free} />;\n    }\n    else {\n      let next_trial_button = null;\n      let replay_button = null;\n      \n      if (answer_received && !is_playing) {\n        next_trial_button = (\n          <div className=\"center-trial-btn\">\n            <ContinueButton next={this.nextTrial} className=\"btn-secondary\"/>\n          </div>\n        );\n      }\n      else if (this.is_free && !answer_received && replay_count > 0 && !is_playing) {\n        replay_button = (\n          <div className=\"center-trial-btn\">\n            <ReplayButton onClick={this.replay} />\n          </div>\n        );\n      }\n            \n      return (\n        <div className=\"container\">\n          <div className=\"row\">          \n            <ButtonTable labels={this.chord_button_labels} values={this.chord_button_labels} next={this.processAnswer} disabled={answer_received} key={trial_idx} />\n          </div>\n          {next_trial_button}\n          {replay_button}\n        </div>\n      );\n    }\n  }\n}\n\nexport class SubtestsBlock extends React.Component {\n  subtests_count = 3;\n\n  state = {\n    test_idx: 0,\n  }\n\n  nextTest = () => {\n    const { test_idx } = this.state;\n    if (test_idx + 1 >= this.subtests_count) \n      this.next();\n    else {\n      this.setState({ test_idx: test_idx + 1 });\n      ls.set(this.ls_prefix + \"test_idx\", test_idx + 1);\n    }\n  }\n\n  constructor({data, next, is_free, button_labels}) {\n    super();\n    this.data = data;\n    this.next = next;\n    this.is_free = is_free;\n    this.chord_button_labels = button_labels;\n    this.ls_prefix = \"test_subtests_\" + (is_free ? \"free_\" : \"fast_\");\n\n    const cont_test_order = ls.get(this.ls_prefix + \"test_order\");\n    if (cont_test_order !== null) {\n      this.test_order = cont_test_order;\n      \n      const cont_test_idx = ls.get(this.ls_prefix + \"test_idx\");\n      if (cont_test_idx) this.state.test_idx = cont_test_idx;\n    }\n    else {\n      this.test_order = shuffleArray([0, 1, 2]);\n\n      ls.set(this.ls_prefix + \"test_order\", this.test_order);\n      ls.set(this.ls_prefix + \"test_idx\", this.state.test_idx);\n    }\n\n    console.log(\"Test order: \" + this.test_order);    \n  }\n\n  render() {\n    const { test_idx } = this.state;\n    const test_num = this.test_order[test_idx];\n    \n    return <TestBlock test_num={test_num} test_idx={test_idx} is_free={this.is_free}\n                      chord_button_labels={this.chord_button_labels} \n                      next={this.nextTest} \n                      data={this.data}\n                      key={test_num} />;\n  }\n}\n","import React from 'react';\nimport { ComboBox, ContinueButton } from '../ui.js';\nimport ls from 'local-storage';\n\nexport class PersonalInfoScreen extends React.Component {\n  constructor({data, next, songsQuestionnaire}) {\n    super();\n    this.data = data;\n    this.next = next;\n    this.songsQuestionnaire = songsQuestionnaire;\n  }\n\n  saveData = () => {\n    const age = document.getElementById('age').value;\n    if (!/^(0|[1-9]\\d*)$/.test(age)) {\n      alert(\"    .\");\n      return;\n    }\n\n    const genderMaleChecked = document.getElementById('male').checked;\n    const genderFemaleChecked = document.getElementById('female').checked;\n    if (!genderMaleChecked && !genderFemaleChecked) {\n      alert(\"  .\");\n      return;\n    }\n    const gender = genderMaleChecked ? 2 : 1;\n\n    const musical_background = document.getElementById('musical_background').value;\n    const residence = document.getElementById('residence').value;\n    const education = document.getElementById('education').value;\n\n    const big_maj_recognition = document.getElementById('big_maj_recognition').value;\n    const small_maj_recognition = document.getElementById('small_maj_recognition').value;\n    const small_min_recognition = document.getElementById('small_min_recognition').value;\n    const half_dim_recognition = document.getElementById('half_dim_recognition').value;\n    const hwcomputer = document.getElementById('hwcomputer').value;\n    const hwdisplay = document.getElementById('hwdisplay').value;\n    const hwmouse = document.getElementById('hwmouse').value;\n    const hwheadphones = document.getElementById('hwheadphones').value;\n    if (big_maj_recognition.length===0 || small_maj_recognition.length===0 ||\n        small_min_recognition.length===0 || half_dim_recognition.length===0 ||\n        hwcomputer.length===0 || hwdisplay.length===0 || \n        hwmouse.length===0 || hwheadphones.length===0 ||\n        education===\"-\" || residence===\"-\" || musical_background===\"-\") {\n      alert(\"    .\");\n      return;\n    }\n\n    let form_data = {\n      time: new Date().toString(),\n      subtest: 5,\n      age: age,\n      gender: gender,\n      musical_background: musical_background,\n      residence: residence,\n      education: education,\n      big_maj_recognition: big_maj_recognition,\n      small_maj_recognition: small_maj_recognition,\n      small_min_recognition: small_min_recognition,\n      half_dim_recognition: half_dim_recognition,\n      computer: hwcomputer,\n      display: hwdisplay,\n      mouse: hwmouse,\n      headphones: hwheadphones,\n    };\n\n    if (this.songsQuestionnaire) {\n      const imagine_familiarity = document.getElementById('imagine_familiarity').value;\n      const imagine_like = document.getElementById('imagine_like').value;\n      const caesaria_familiarity = document.getElementById('caesaria_familiarity').value;\n      const caesaria_like = document.getElementById('caesaria_like').value;\n      const rocketman_familiarity = document.getElementById('rocketman_familiarity').value;\n      const rocketman_like = document.getElementById('rocketman_like').value;\n      const britolam_familiarity = document.getElementById('britolam_familiarity').value;\n      const britolam_like = document.getElementById('britolam_like').value;\n\n      if (imagine_familiarity===\"-\" || imagine_like===\"-\" || \n          caesaria_familiarity===\"-\" || caesaria_like===\"-\" ||\n          rocketman_familiarity===\"-\" || rocketman_like===\"-\" ||\n          britolam_familiarity===\"-\" || britolam_like===\"-\") {\n        alert(\"    .\");\n        return;\n      }\n\n      form_data.imagine_familiarity = imagine_familiarity;\n      form_data.imagine_like = imagine_like;\n      form_data.caesaria_familiarity = caesaria_familiarity;\n      form_data.caesaria_like = caesaria_like;\n      form_data.rocketman_familiarity = rocketman_familiarity;\n      form_data.rocketman_like = rocketman_like;\n      form_data.britolam_familiarity = britolam_familiarity;\n      form_data.britolam_like = britolam_like;\n    }\n\n    this.data.trials.push(form_data);\n\n\n    ls.set(\"test_data\", this.data);\n    this.next();\n  }\n\n  render() { \n    let songsForm = null;\n    if (this.songsQuestionnaire) {\n      const numbered_options = [...Array(7).keys()].map(i => i+1);\n\n      songsForm = (\n        <div className=\"songs_form\">\n          <p style={{fontWeight: 'bold'}}> :</p>\n          <p>       1-7,  1   -7 .</p>\n          <label htmlFor=\"imagine_familiarity\">      \"imagine\"  ' ?</label>\n          <ComboBox id=\"imagine_familiarity\" options={numbered_options}/>\n          <br/>\n          <label htmlFor=\"imagine_like\">     ?</label>\n          <ComboBox id=\"imagine_like\" options={numbered_options}/>\n          <br/>\n          <br/>\n          <label htmlFor=\"caesaria_familiarity\">      \"  ( )\"     ?</label>\n          <ComboBox id=\"caesaria_familiarity\" options={numbered_options}/>\n          <br/>\n          <label htmlFor=\"caesaria_like\">     ?</label>\n          <ComboBox id=\"caesaria_like\" options={numbered_options}/>\n          <br/>\n          <br/>\n          <label htmlFor=\"rocketman_familiarity\">      \"Rocket Man\"   '?</label>\n          <ComboBox id=\"rocketman_familiarity\" options={numbered_options}/>\n          <br/>\n          <label htmlFor=\"rocketman_like\">     ?</label>\n          <ComboBox id=\"rocketman_like\" options={numbered_options}/>\n          <br/>\n          <br/>\n          <label htmlFor=\"britolam_familiarity\">      \" \"     ?</label>\n          <ComboBox id=\"britolam_familiarity\" options={numbered_options}/>\n          <br/>\n          <label htmlFor=\"britolam_like\">     ?</label>\n          <ComboBox id=\"britolam_like\" options={numbered_options}/>\n          <br/>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"container\">\n        <div className=\"row\">\n          <div className=\"col-sm-8 offset-sm-2 personal-info-form\">\n            <p style={{fontWeight: 'bold'}}>  :</p>\n            <label htmlFor=\"age\">:</label>\n            <input type=\"text\" id=\"age\" name=\"age\" maxLength=\"2\"/>\n            <br/>\n            <label htmlFor=\"gender\">:</label>\n            <label htmlFor=\"male\"></label>\n            <input type=\"radio\" id=\"male\" name=\"gender\" value=\"male\"/>\n            <label htmlFor=\"female\"></label>\n            <input type=\"radio\" id=\"female\" name=\"gender\" value=\"female\"/>\n            <br/>\n            <label htmlFor=\"musical_background\">  :</label>\n            <select id=\"musical_background\" name=\"musical_background\" defaultValue=\"-\">\n              <option hidden disabled value=\"-\"></option>\n              <option value=\"1\"></option>\n              <option value=\"2\">  </option>\n              <option value=\"3\">  </option>\n            </select>\n            <br/>\n            <label htmlFor=\"residence\"> :</label>\n            <select id=\"residence\" name=\"residence\" defaultValue=\"-\">\n              <option hidden disabled value=\"-\"></option>\n              <option value=\"1\"> </option>\n              <option value=\"2\"> </option>\n              <option value=\"3\"> </option>\n              <option value=\"4\"></option>\n              <option value=\"5\"></option>\n            </select>\n            <br/>\n            <label htmlFor=\"education\">:</label>\n            <select id=\"education\" name=\"education\" defaultValue=\"-\">\n              <option hidden disabled value=\"-\"></option>\n              <option value=\"1\"></option>\n              <option value=\"2\"> </option>\n              <option value=\"3\"> </option>\n              <option value=\"4\"> </option>\n              <option value=\"5\"> </option>\n            </select>\n            <br/>\n            <label htmlFor=\"big_maj_recognition\">      \"' \"?</label>\n            <textarea id=\"big_maj_recognition\" rows=\"2\" cols=\"50\"/>\n            <label htmlFor=\"small_maj_recognition\">      \"' \"?</label>\n            <textarea id=\"small_maj_recognition\" rows=\"2\" cols=\"50\"/>\n            <label htmlFor=\"small_min_recognition\">      \" \"?</label>\n            <textarea id=\"small_min_recognition\" rows=\"2\" cols=\"50\"/>\n            <label htmlFor=\"half_dim_recognition\">      \" \"?</label>\n            <textarea id=\"half_dim_recognition\" rows=\"2\" cols=\"50\"/>            \n            <p>         .         .</p>\n            <label htmlFor=\"hwcomputer\">:</label><br/>\n            <textarea id=\"hwcomputer\" rows=\"2\" cols=\"50\"/><br/>\n            <label htmlFor=\"display\"> :</label><br/>\n            <textarea id=\"hwdisplay\" rows=\"2\" cols=\"50\"/><br/>\n            <label htmlFor=\"hwmouse\">:</label><br/>\n            <textarea id=\"hwmouse\" rows=\"2\" cols=\"50\"/><br/>\n            <label htmlFor=\"hwheadphones\">:</label><br/>\n            <textarea id=\"hwheadphones\" rows=\"2\" cols=\"50\"/><br/>\n            <br/>\n\n            {songsForm}\n          </div>\n        </div>\n        <div className=\"row\">\n          <div className=\"col-sm-8 offset-sm-2 text-center\">\n            <ContinueButton next={this.saveData} />\n          </div>\n        </div>\n        <div className=\"row\">&nbsp;</div>\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport '../Experiment.css';\nimport './TestExperiment.css';\nimport { InfoScreen, ContinueButton, ErrorScreen, LoadingScreen } from '../ui.js';\nimport { LessonType, Chords } from '../defs.js';\nimport { PretestBlock } from './pretest.js';\nimport { SubtestsBlock } from './subtests.js';\nimport { PersonalInfoScreen } from './personal_info.js';\nimport ls from 'local-storage';\nimport { read_subject_data, does_user_sheet_exists } from '../sessions.js';\nimport gs from '../spreadsheet_io.js';\nimport { shuffleArray } from '../randomize.js';\n\nconst LoginScreen = ({next, data}) => {\n  const handleContinue = () => {\n    data.id = document.getElementById('id_input').value;\n    next();\n  };\n\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-md-8 offset-md-2 infotext\">\n          <p>   -30 .</p>\n          <p>   .</p>\n          <p>   .      .</p>\n          <p> ,   ,     ()   .</p>\n          <p>   ,       ,   \"\".</p>          \n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col\"></div>\n        <div className=\"col text-center\">\n          <br/>\n          <label>\": <input type=\"text\" id=\"id_input\"/><br/></label>\n          <p hidden>\"</p>\n          <br/>\n          <ContinueButton next={handleContinue} disabled={false} />            \n        </div>\n        <div className=\"col\"></div>\n      </div>      \n    </div>\n  );\n};\n\nconst FinishScreen = ({data, done_saving}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"col-md-8 offset-md-2 finish-screen text-center\">\n        <h1> !</h1>\n        <p>{done_saving ? \"  !\" : \"   ...\"}</p>\n      </div>\n    </div>\n  );\n};\n\nconst TestInfo = () => {\n  return (\n    <div>\n      <p>      : ' , ' ,  ,  .</p>\n      <p>,     :      ,         .</p>\n      <p>    ,   .</p>\n      <p>         .             .        .</p>\n      <p>        .</p>\n      <p>!</p>\n    </div>\n  );\n};\n\nclass TestExperiment extends React.Component {\n  conn = { // read/write connection details for google spreadsheet.\n    spreadsheet_id: '1D2s3D13ldvchzueCFWTkvH8kzhNBEMZzizPnjGQnhMY',\n    api_key: 'AIzaSyDHFHbGy_GhEt1Q4FW61YYEX2jk3hZcSoQ',\n    write_url: 'https://script.google.com/macros/s/AKfycbxv6Uc9VsHlKI6SMe6YmH-MELryrJYvYg-uQnGFhyMF2X7zyC-O/exec',\n  }\n\n  ls_prefix = \"test_\";\n  sheet_suffix = \"-test\";\n\n  steps = {\n    LOGIN: 1,\n    INFO: 2,\n    PRETEST: 3,\n    SUB_TESTS_FREE: 4,\n    SUB_TESTS_FAST: 5,\n    PERSONAL_INFO: 6,\n    FINISH: 7,\n  }\n\n  state = {\n    step: 1,\n    error: null,\n    loading: false,\n  }\n\n  data = {\n    id: undefined,\n    trials: [],\n  }\n\n  nextStep = () => {\n    const { step } = this.state;\n    const new_step = step + 1;\n\n    if (step > 1)\n      ls.set(this.ls_prefix + \"step\", new_step);\n\n    const altered_step = this.stepWillChange(step, new_step);\n    this.setState({step: altered_step || new_step});\n    this.stepChanged(altered_step || new_step);\n  }\n\n  stepWillChange = (step, new_step) => {\n    if (step === this.steps.LOGIN) {\n      this.setState({loading: true});\n      does_user_sheet_exists(this.conn, this.data.id + this.sheet_suffix)\n        .then(sheet_exists => {\n          if (sheet_exists) {\n            ls.set(this.ls_prefix + \"data\", this.data);\n            read_subject_data(this.conn, this.data.id)\n              .then(subject_data => {\n                if (subject_data) {\n                  this.lesson_type = subject_data.lesson_type;\n                  this.chord_button_labels = subject_data.chord_button_labels;\n                  this.setState({loading: false});\n                }\n                else {\n                  this.setState({error: \"      \" + this.data.id + \".\"});\n                }\n              })\n              .catch(err => {\n                this.setState({error: \"  .      . \" + err});\n              });\n          }\n          else {\n            this.setState({error: \"    \" + this.data.id + \"   .\",\n                           loading: false});\n          }\n\n        })\n        .catch(err => {\n          this.setState({error: \"  .      . \" + err});\n        });\n\n      // try to recover from local storage\n      const cont_data = ls.get(this.ls_prefix + \"data\");\n      if (cont_data && cont_data.id === this.data.id) {\n        console.log(\"Loading from local storage...\");\n        \n        this.data = cont_data;\n        \n        const cont_step = ls.get(this.ls_prefix + \"step\");\n        if (cont_step) \n          return cont_step;\n      }\n      else {\n        console.log(\"clearing local storage\");\n        ls.clear();\n      }\n    }\n\n    return undefined;\n  }\n\n  stepChanged = (step) => {\n    if (step === this.steps.FINISH) {\n      this.data.end_time = new Date().toString();\n      console.log(\"Saving data...\");\n      console.log(this.data.trials);\n\n      this.data.trials.forEach(t => {\n        t.id = this.data.id;\n        t.start_time = this.data.start_time;\n        t.end_time = this.data.end_time;\n      });\n      \n      const that = this;\n      gs.write(this.conn, \"\" + this.data.id + this.sheet_suffix, this.data.trials)\n        .then(res => { \n          that.setState({done_saving: true});\n          ls.clear(); \n        })\n        .catch(this.dataSaveError);\n    }\n  }\n\n  dataSaveError(response) {\n    alert(\"Error while saving data: \" + response);\n  }\n\n  componentDidMount() {\n    this.data.start_time = new Date().toString();\n  }\n\n  render() {\n    const {step} = this.state;\n\n    if (this.state.error) {\n      return <ErrorScreen error={this.state.error} />;\n    } \n    else if (this.state.loading) {\n      return <LoadingScreen />;\n    } \n    else {\n      switch(step) {\n      case this.steps.LOGIN: \n        return <LoginScreen next={this.nextStep} data={this.data} key={step}/>;\n      case this.steps.INFO:\n        const test_info = <TestInfo />;\n        return <InfoScreen info={test_info} next={this.nextStep} key={step}/>;\n      case this.steps.PRETEST:\n        return <PretestBlock next={this.nextStep} button_labels={this.chord_button_labels} data={this.data} key={step}/>;\n      case this.steps.SUB_TESTS_FREE:\n        return <SubtestsBlock next={this.nextStep} data={this.data} button_labels={this.chord_button_labels} is_free={true} key={step} />;\n      case this.steps.SUB_TESTS_FAST:\n        return <SubtestsBlock next={this.nextStep} data={this.data} button_labels={this.chord_button_labels} is_free={false} key={step} />;\n      case this.steps.PERSONAL_INFO:\n        return <PersonalInfoScreen next={this.nextStep} data={this.data} key={step} songsQuestionnaire={this.lesson_type==LessonType.MUSICAL_PIECES}/>;\n      case this.steps.FINISH:\n        return <FinishScreen done_saving={this.state.done_saving} key={step} />;\n      default:\n        return <div>???</div>;\n      }\n    }\n  }\n}\n\nexport default TestExperiment;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport TrainingExperiment from './training_experiment/TrainingExperiment.js';\nimport TestExperiment from './test_experiment/TestExperiment.js';\nimport * as serviceWorker from './serviceWorker';\nimport { Switch, HashRouter, Route } from \"react-router-dom\";\n\nclass App extends React.Component {\n  render() {\n    return (\n      <HashRouter>\n        <Switch>\n          <Route exact path=\"/\"><TrainingExperiment/></Route>\n          <Route path=\"/test\"><TestExperiment/></Route>\n          <Route>  !</Route>\n        </Switch>\n      </HashRouter>\n    );\n  }\n}\n\nReactDOM.render(<App/>, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}