{"version":3,"sources":["defs.js","training_experiment/info.js","audio_controller.js","ui.js","randomize.js","training_experiment/lesson_block.js","training_experiment/training_block.js","spreadsheet_io.js","sessions.js","training_experiment/TrainingExperiment.js","test_experiment/pretest.js","test_experiment/audio_mapping.js","test_experiment/subtests.js","test_experiment/personal_info.js","test_experiment/TestExperiment.js","serviceWorker.js","index.js"],"names":["LessonType","MUSICAL_PIECES","TONAL_CONTEXT","AUTOMATIC","Chords","BIG_MAJOR","SMALL_MAJOR","SMALL_MINOR","HALF_DIM","Timbres","PIANO","GUITAR","SONG","Variants","StaticImages","Strings","SheetNames","musical_pieces_data","IntroText","className","InfoText","lesson_type","href","imgSrc","name","PretestInfo","audioIdx2File","idx","AudioController","srcs","onDoneLoading","onAudioEnded","this","players","ids2players","players2ids","id","playerIdx","length","p","Audio","addEventListener","e","audioLoaded","push","console","log","loadCount","player","audio_id","play","pause","currentTime","LoadingScreen","ErrorScreen","error","InfoScreen","info","next","disabled","Button","label","onClick","type","ContinueButton","ButtonTable","labels","values","gen_button","btn_idx","randomInt","min","max","Math","floor","random","randomElement","arr","shuffleArray","map","a","sort","b","randomSequence","items","count","ln","i","repeatArray","lesson_data","musical_pieces","tonal_context","automatic","NameOfChord","props","chordName","description","SongWithoutChords","songData","src","alt","LessonPart","part","session","state","trial_idx","done_playing","done_loading","trials_per_part","part_data","ls_prefix","continued","sequence","ls","get","set","that","audioController","d","setState","screen","button","React","Component","InfoBeforeLessonPartA","InfoBeforeLessonPartB","InfoBeforeLessonPartC","LessonBlock","data","steps","INFO_A","PART_A","INFO_B","PART_B","INFO_C","PART_C","DONE","step","nextStep","key","training_data","correction_data","TrainingInfo","InfoBeforeTrainingPartB","InfoBeforeTrainingPartC","SuccessfulIdentification","width","height","FailedIdentification","appendix","shouldShowCorrect","shouldShowButton","correctChord","text","SongWithChords","chord_buttons","chord","ChordSelection","with_song_names","TrainingPart","show_feedback","answer","correction_idxs","corrections_for_part","concat","response_start","Date","fail_show_correct","done_playing_correct_feedback","correct_audio_idx","trial","slice","filter","t","trial_data","chord_name","transposition","nextTrial","processAnswer","correct","td","time","toString","audio_index","chord_number","chord_type","transposition_play_count","get_transposition_play_count","selected_chord_type","response_time","trials","stop","selected_audio_idx","song_data","TrainingBlock","read_url","parse_sheet_list","sheetNames","sheets","forEach","sheet","properties","title","gs","read","conn","sheetName","range","fetch","spreadsheet_id","api_key","write","Array","isArray","url","write_url","headers","method","mode","body","JSON","stringify","list_sheets","then","res","json","SessionEvent","SESSION_START","SESSION_CONTINUED","SESSION_END","parseSessions","sessions","session_event","number","event","writeSessionEvent","on_error","request_data","Object","assign","catch","readLessonType","response","row","parseInt","was_last_session_today","last_session","last_time","setHours","getHours","now","getDate","does_user_sheet_exists","user_id","includes","MAX_NUMBER_OF_SESSIONS","IntroScreen","hidden","document","getElementById","value","FinishScreen","done_saving","session_number","remaining","PretestBlock","practice_trials_count","test_trails_count","button_idxs","practice_sequence","test_sequence","target_btn","selection","TrainingExperiment","INTRO","INFO","PRETEST_INFO","PRETEST","LESSON","TRAINING","FINISH","is_loading_session","did_check_user_registered","max_sessions_reached","session_done_for_today","user_unregistered","did_load_registration_list","did_load_lesson_type","undefined","maybe_start_session","previous_sessions","clear","err","alert","last_session_number","continued_session","sessionEventError","continued_data","continued_step","stepChanged","cant_continue_session","new_step","stepWillChange","sheet_exists","sessionDataLoadError","end_time","start_time","dataSaveError","sessionDataLoaded","session_data","pretest_info","getScreenForStep","PretestTrial","button_labels","trial_chord","ContinueScreen","on_keep_going","keep_going","trials_count","subtest","keepGoing","cont_trial_idx","audio_mapping","test_b_indexing","timbre","variant","test_d_indexing","SubtestInfo","test_num","TestBlock","test_idx","chord_button_labels","show_info","loading","make_test_sequence","test_data","make_subtest_b_seq","make_subtest_d_seq","pick_unique_two","fst_idx","c","trnsp","var1","var2","trnsp1","trnsp2","startTrials","trial_info","cont_sequence","cont_show_info","SubtestsBlock","subtests_count","nextTest","cont_test_order","test_order","cont_test_idx","PersonalInfoScreen","saveData","age","test","genderMaleChecked","checked","genderFemaleChecked","gender","musical_background","big_maj_recognition","small_maj_recognition","small_min_recognition","half_dim_recognition","hwcomputer","hwdisplay","hwmouse","hwheadphones","computer","display","mouse","headphones","htmlFor","maxLength","rows","cols","LoginScreen","TestInfo","TestExperiment","sheet_suffix","LOGIN","SUB_TESTS","PERSONAL_INFO","altered_step","cont_data","cont_button_labels","cont_step","test_info","Boolean","window","location","hostname","match","App","exact","path","ReactDOM","render","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.41395f7d.chunk.js","sourcesContent":["export const LessonType = {\n  MUSICAL_PIECES: 0,\n  TONAL_CONTEXT: 1,\n  AUTOMATIC: 2,\n};\n\nexport const Chords = {\n  BIG_MAJOR: \"' \",\n  SMALL_MAJOR: \"' \",\n  SMALL_MINOR: \" \",\n  HALF_DIM:\" \"\n}\n\nexport const Timbres = {\n  PIANO: 0,\n  GUITAR: 1,\n  SONG: 2,\n}\n\nexport const Variants = {\n  NONE: 0,\n  OPEN: 1,\n  INVERSION: 2,\n  REGISTER: 3,\n}\n\nexport const StaticImages = {\n  happySmiley: \"static_images/happySmiley.jpg\",\n  sadSmiley: \"static_images/sadSmiley.png\",\n}\n\nexport const Strings = {\n  continue_text: \"\",\n  success_identification: \"  \",\n  failure_identification: \"   \",\n  how_it_sounds: \"  \",\n};\n\nexport const SheetNames = {\n  TRAINING_SESSIONS: \"TrainingSessions\",\n  LESSON_TYPES: \"LessonTypes\",\n}\n\n// For MUSICAL_CONTEXT lessons. A mapping of chord name to the image and song name that goes with it.\nexport let musical_pieces_data = {};\nmusical_pieces_data[Chords.BIG_MAJOR] = {\n  imgSrc: \"song_images/song1.png\",\n  name: \"Imagine\",\n};\nmusical_pieces_data[Chords.SMALL_MAJOR] = {\n  imgSrc: \"song_images/song2.png\",\n  name: \" \"\n};\nmusical_pieces_data[Chords.SMALL_MINOR] = {\n  imgSrc: \"song_images/song3.png\",\n  name: \"Rocket man\"\n};\nmusical_pieces_data[Chords.HALF_DIM] = {\n  imgSrc: \"song_images/song4.png\",\n  name: \" \"\n};\n","import React from 'react';\nimport { LessonType } from '../defs.js';\n\nexport function IntroText() {\n  return (\n    <div className = \"IntroText\">\n      <p>\n         35 . \n         .\n           .      . \n       ,   ,     ()   .\n      </p>\n      <p>\n                .       ,      ,       (    .       ).\n      </p>\n      <p>\n                -  ,  ,   .         ,     .\n            .      ,     , , ,     .\n      </p>\n      <p>\n           ,         .\n      </p>\n    </div>);\n}\n\nexport function InfoText({lesson_type}) {\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    return (\n      <div>\n        <p>      (  )     .</p>\n        <p>       .          .</p>\n        <p>      .         .</p>\n        <p>         .</p>\n        <p>   ,      <a href=\"mailto:yaeljm@gmail.com\">yaeljm@gmail.com</a>    0528931467,    .</p>\n        <p>!</p>\n      </div>\n    );\n\n  case LessonType.TONAL_CONTEXT:\n    return (\n      <div>\n        <p>      (  )    :          .</p>\n        <p>       .          .</p>\n        <p>      .         .</p>        \n        <p>         .</p>\n        <p>   ,      <a href=\"mailto:yaeljm@gmail.com\">yaeljm@gmail.com</a>    0528931467,    .</p>\n        <p>!</p>\n      </div>\n    );\n\n  case LessonType.AUTOMATIC:\n    return (\n      <div>\n        <p>      (  )    .</p>\n        <p>       .          .</p>\n        <p>      .         .</p>\n        <p>         .</p>\n        <p>   ,      <a href=\"mailto:yaeljm@gmail.com\">yaeljm@gmail.com</a>    0528931467,    .</p>\n        <p>!</p>\n      </div>\n    );\n  }\n}\n\nexport const PretestInfo = () => {\n  return (\n    <div>\n      <p>    4 .          .</p>\n      <p>        .</p>\n      <p>      .</p>\n    </div>\n  );\n};\n","let audioIdx2File = (idx) => \"audio/\" + idx + \".mp3\";\n\nexport class AudioController {\n  constructor(srcs, onDoneLoading, onAudioEnded) {\n    this.players = [];\n    this.ids2players = {};\n    this.players2ids = {};\n    for (const id of srcs) {\n      const playerIdx = this.players.length;\n\n      if (id in this.ids2players) {\n        continue;\n      }\n\n      this.ids2players[id] = playerIdx;\n      this.players2ids[playerIdx] = id;\n\n      const p = new Audio(audioIdx2File(id));\n      p.addEventListener('canplaythrough', (e => {this.audioLoaded(p)}), false);\n      p.addEventListener('ended', (e => {\n        if (this.onAudioEnded) this.onAudioEnded(id)\n      }), false);\n\n      this.players.push(p);\n    }\n\n    console.log(\"Loading \" + this.players.length + \" audio files\");\n    this.loadCount = 0;\n    this.onDoneLoading = onDoneLoading;\n    this.onAudioEnded = onAudioEnded;\n  }\n\n  audioLoaded(player) {\n    this.loadCount+=1;\n    if (this.loadCount === this.players.length) {\n      if (this.onDoneLoading) this.onDoneLoading();\n    }\n  }\n\n  play(audio_id) {\n    const playerIdx = this.ids2players[audio_id];\n    this.players[playerIdx].play();\n  }\n\n  stop(audio_id) {\n    const playerIdx = this.ids2players[audio_id];\n    this.players[playerIdx].pause();\n    this.players[playerIdx].currentTime = 0;\n  }\n}\n","import React from 'react';\nimport { Strings } from './defs.js';\n\nexport const LoadingScreen = () => {\n  return <div className=\"containter text-center\"><p className=\"lead\">...</p></div>;\n};\n\nexport const ErrorScreen = ({error}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-sm\">\n          <p> :</p>\n          <p className=\"lead center\">{error}</p>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport const InfoScreen = ({info, next}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-md-8 offset-md-2 infotext\">\n          {info}\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col\"></div>\n        <div className=\"col text-center\">\n          <br/>\n          <ContinueButton next={next} disabled={false} />\n        </div>\n        <div className=\"col\"></div>\n      </div>\n    </div>\n  );\n};\n\nexport const Button = ({label, onClick, disabled}) => {\n  return disabled ? \n    <button type=\"button\" className=\"btn btn-primary\" onClick={onClick} disabled>{label}</button> :\n    <button type=\"button\" className=\"btn btn-primary\" onClick={onClick}>{label}</button>;\n};\n\nexport const ContinueButton = ({next, disabled}) => {\n  return <Button label={Strings.continue_text} onClick={next} disabled={disabled}/>;\n};\n\n/* 4 buttons in a square layout with fixation point in the middle. Each button is assigned a value to be passed to \n   the next function when it's clicked. */\nexport const ButtonTable = ({labels, values, disabled, next}) => {\n  const gen_button = (btn_idx) => {\n    if (disabled) \n      return <button className=\"chordBtn\" disabled onClick={(e) => next(values[btn_idx])}>{labels[btn_idx]}</button>;\n    else \n      return <button className=\"chordBtn\" onClick={(e) => next(values[btn_idx])}>{labels[btn_idx]}</button>;\n  };\n\n  return (\n    <table className=\"chordSelection\">\n      <tbody>\n        <tr>\n          <td>{gen_button(0)}</td>\n          <td></td>\n          <td>{gen_button(1)}</td>\n        </tr>\n        <tr>\n          <td></td>\n          <td className=\"plusSign align-middle\">+</td>\n          <td></td>\n        </tr>\n        <tr>\n          <td>{gen_button(2)}</td>\n          <td></td>\n          <td>{gen_button(3)}</td>\n        </tr>\n      </tbody>\n    </table>   \n  );\n};\n","export function repeatArray(arr, count) {     \n  var ln = arr.length;\n  var b = [];\n  for(let i=0; i<count; i++) {      \n    b.push(arr[i%ln]);      \n  }\n      \n  return b;      \n}\n\n/* random int between min and max inclusive. */\nexport const randomInt = (min, max) => \n  Math.floor(Math.random() * (max - min + 1) + min);\n\nexport const randomElement = arr => arr[randomInt(0, arr.length-1)];\n\nexport const shuffleArray = arr => arr\n  .map(a => [Math.random(), a])\n  .sort((a, b) => a[0] - b[0])\n  .map(a => a[1]);\n\nexport const randomSequence = (items, length) => shuffleArray(repeatArray(items, length));\n","import React from 'react';\nimport { musical_pieces_data, LessonType, Chords } from '../defs.js';\nimport { AudioController } from '../audio_controller.js';\nimport { InfoScreen, LoadingScreen, ContinueButton } from '../ui.js';\nimport { randomSequence } from '../randomize.js';\nimport ls from 'local-storage';\n\n// Recordings used in each lesson type and part. i.e. \n// for part 1 and musical_pieces lesson: lesson_data.musical_pieces[1]\nlet lesson_data = {\n  musical_pieces: [\n    [[1, Chords.BIG_MAJOR], [2, Chords.SMALL_MAJOR], [3, Chords.SMALL_MINOR], [4, Chords.HALF_DIM]],\n    [[5, Chords.BIG_MAJOR], [6, Chords.SMALL_MAJOR], [7, Chords.SMALL_MINOR], [8, Chords.HALF_DIM]],\n    [[1009, Chords.BIG_MAJOR], [1013, Chords.SMALL_MAJOR], [1017, Chords.SMALL_MINOR], [1021, Chords.HALF_DIM]],\n  ],\n  tonal_context: [\n    [[25, Chords.BIG_MAJOR], [26, Chords.SMALL_MAJOR], [27, Chords.SMALL_MINOR], [28, Chords.HALF_DIM]],\n    [[29, Chords.BIG_MAJOR], [30, Chords.SMALL_MAJOR], [31, Chords.SMALL_MINOR], [32, Chords.HALF_DIM]],\n    [[33, Chords.BIG_MAJOR], [35, Chords.SMALL_MAJOR], [37, Chords.SMALL_MINOR], [39, Chords.HALF_DIM],\n     [34, Chords.BIG_MAJOR], [36, Chords.SMALL_MAJOR], [38, Chords.SMALL_MINOR], [40, Chords.HALF_DIM]],\n  ],\n  automatic: [\n    [[9, Chords.BIG_MAJOR], [13, Chords.SMALL_MAJOR], [17, Chords.SMALL_MINOR], [21, Chords.HALF_DIM]],\n    [[41, Chords.BIG_MAJOR], [45, Chords.SMALL_MAJOR], [49, Chords.SMALL_MINOR], [53, Chords.HALF_DIM]],\n    [[41, Chords.BIG_MAJOR], [45, Chords.SMALL_MAJOR], [49, Chords.SMALL_MINOR], [53, Chords.HALF_DIM],\n     [9, Chords.BIG_MAJOR], [13, Chords.SMALL_MAJOR], [17, Chords.SMALL_MINOR], [21, Chords.HALF_DIM]],\n  ],\n};\n\n// The UI for AUTOMATIC and TONAL_CONTEXT lesson trials.\nconst NameOfChord = props => {\n  let { chordName, lesson_type } = props;\n  let description = \"\";\n  if (lesson_type === LessonType.TONAL_CONTEXT)\n    description = \"  :\";\n  else if (lesson_type === LessonType.AUTOMATIC)\n    description = \" :\";\n\n  return (\n    <div className = \"row text-center successScreenWrapper\">\n      <div className=\"col-sm-8 offset-sm-2 align-middle\">\n        <span className=\"chordName\">\n          {description}\n        <br />\n        { chordName }\n        </span>\n      </div>\n    </div>\n  );\n};\n\n// The UI for MUSICAL_PIECES lesson trials.\nconst SongWithoutChords = props => {\n  let { chordName } = props;\n  let { songData } = props;\n  return(\n    <div className=\"songDisplayWrapper\">\n      <img className=\"songImage\" src={ songData.imgSrc } alt=\"\"/>\n      <div className=\"row\">\n        <div className=\"col text-center\">\n          <div className=\"songTitle\">\n             :\n            <br/>\n            { songData.name }\n            <br/>\n            <br/>\n             :\n            <br/>\n            { chordName }\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n// This component represents one part of the lesson. There are 3 parts. The only difference \n// between them is the audio sequence. Audio playing code is here.\nclass LessonPart extends React.Component {\n  state = {\n    trial_idx: 0,\n    done_playing: false,\n    done_loading: false,\n  }\n\n  constructor({part, session, next}) {\n    super();\n    this.part = part;\n    this.next = next;\n    this.state.done_loading = false;\n    this.trials_per_part = 16;\n    this.session = session;\n\n    switch (this.session.lesson_type) {\n    case LessonType.MUSICAL_PIECES:\n      this.part_data = lesson_data.musical_pieces[part];\n      break;\n    case LessonType.TONAL_CONTEXT:\n      this.part_data = lesson_data.tonal_context[part];\n      break;\n    case LessonType.AUTOMATIC:\n      this.part_data = lesson_data.automatic[part];\n      break;\n    };\n\n    this.ls_prefix = \"lesson_part\" + part + \"_\";\n    if (session.continued) {\n      this.sequence = ls.get(this.ls_prefix + \"sequence\");\n      const trial_idx = ls.get(this.ls_prefix + \"trial_idx\");\n      if (trial_idx !== null) this.state.trial_idx = trial_idx;\n      session.continued = false;\n    }\n    else {\n      this.sequence = randomSequence(this.part_data, this.trials_per_part);\n      ls.set(this.ls_prefix + \"sequence\", this.sequence);\n      ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx);\n    }\n\n    console.log(\"LESSON PART \" + part + \" sequence:\");\n    console.log(this.sequence);\n\n    const that = this;\n    const doneLoadingAudio = () => {\n      that.setState({done_loading: true});\n      that.audioController.play(this.sequence[that.state.trial_idx][0]);\n    };\n\n    const donePlaying = () => {\n      that.setState({done_playing: true});\n    };\n\n    this.audioController = new AudioController(this.part_data.map(d => d[0]), doneLoadingAudio, donePlaying);\n  }\n\n  render() {\n    const that = this;\n    const nextTrial = () => {\n      const trial_idx = that.state.trial_idx;\n      if (trial_idx < that.trials_per_part - 1) {\n        that.setState({trial_idx: trial_idx+1,\n                       done_playing: false});\n        that.audioController.play(this.sequence[trial_idx+1][0]);\n        ls.set(this.ls_prefix + \"trial_idx\", trial_idx + 1);\n      }\n      else {\n        that.next();\n      }\n    };\n\n    const trialData  = this.sequence[this.state.trial_idx];\n    const chordName = trialData[1];\n    const songData = musical_pieces_data[chordName];\n\n    if (this.state.done_loading) {\n      let screen;\n      if (this.session.lesson_type === LessonType.MUSICAL_PIECES) {\n        screen = <SongWithoutChords chordName={chordName} songData={songData}/>;\n      }\n      else {\n        screen = <NameOfChord chordName={chordName} lesson_type={this.session.lesson_type}/>;\n      }\n      const button = this.state.done_playing ? (\n          <div className=\"row\">\n            <div className=\"col-sm-8 offset-sm-2 text-center\">\n              <br/>\n              <ContinueButton next={nextTrial} />\n            </div>\n          </div>) : null;\n\n      return (\n        <div className=\"container\">\n          {screen}\n          {button}\n        </div>\n      );\n    }\n    else {\n      return <LoadingScreen />;\n    }\n  }\n}\n\nconst InfoBeforeLessonPartA = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = \n      <div>\n        <p>       .   ,     ,   .</p>\n        <p>          ,     .       .</p>\n      </div>;\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info = \n      <div>\n        <p>   .           .    ,     ,   .</p>\n        <p>          ,     .       .</p>\n      </div>;\n    break;\n  case LessonType.AUTOMATIC:\n    info = \n      <div>\n        <p>  . </p>\n        <p>          ,     .       .</p>\n      </div>;\n    break;\n  };\n\n  return <InfoScreen info={info} next={next}/>;\n};\n\nconst InfoBeforeLessonPartB = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = \n      <p>\n           ,      . \n        ,     ,   .\n                ,     .       .\n      </p>;\n    break;\n  case LessonType.TONAL_CONTEXT:\n  case LessonType.AUTOMATIC:\n    info =\n      <p>\n           ,     . \n        ,     ,   .\n                ,     .       .\n      </p>;\n    break;\n  };\n\n  return <InfoScreen info={info} next={next}/>;\n};\n\nconst InfoBeforeLessonPartC = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = <p>       ,         .</p>;\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info = <p>         .</p>;\n    break;\n  case LessonType.AUTOMATIC:\n    info = <p>          -  .</p>;\n    break;\n  };\n\n  return <InfoScreen info={info} next={next}/>;\n};\n\n// The main lesson block component.\nexport class LessonBlock extends React.Component {\n  steps = {\n    INFO_A: 1,\n    PART_A: 2,\n    INFO_B: 3,\n    PART_B: 4, \n    INFO_C: 5,\n    PART_C: 6,\n    DONE: 7,\n  }\n\n  state = {\n    step: 1,\n  }\n\n  nextStep = () => {\n    const { step } = this.state;\n\n    this.setState({\n      step: step + 1\n    });\n    ls.set(\"lesson_block_step\", step + 1);\n\n    if (step + 1 === this.steps.DONE)\n      this.next();\n  }\n\n  state = {\n    step: 1,\n  };\n  \n  constructor({data, session, next}) {\n    super();\n    this.data = data;\n    this.session = session;\n    this.next = next;\n\n    if (session.continued) {\n      this.state.step = ls.get(\"lesson_block_step\", this.state.step);\n    }\n    else {\n      ls.set(\"lesson_block_step\", this.state.step);\n    }\n  }\n  \n  render() {\n    const {step} = this.state;\n    let screen;\n\n    switch(step) {\n    case this.steps.INFO_A:\n      this.session.continued = false;\n      screen = <InfoBeforeLessonPartA lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_A:\n      screen = <LessonPart part={0} session={this.session} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.INFO_B:\n      this.session.continued = false;\n      screen = <InfoBeforeLessonPartB lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_B:\n      screen = <LessonPart part={1} session={this.session} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.INFO_C:\n      this.session.continued = false;\n      screen = <InfoBeforeLessonPartC lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_C:\n      screen = <LessonPart part={2} session={this.session} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.DONE:\n      this.nextStep();\n    }\n\n    return screen;\n  }\n}\n","import React from 'react';\nimport { AudioController } from '../audio_controller.js';\nimport { LessonType, Strings, StaticImages, Chords, Timbres, musical_pieces_data } from '../defs.js';\nimport { InfoScreen, LoadingScreen, ContinueButton, ButtonTable } from '../ui.js';\nimport { randomSequence, shuffleArray } from '../randomize.js';\nimport ls from 'local-storage';\n\n// each trial entry is [audio_idx, chord, transposition, timbre]\nconst training_data = {\n  musical_pieces: [\n    [[1, Chords.BIG_MAJOR, 0, null], [2, Chords.SMALL_MAJOR, 0, null], \n     [3, Chords.SMALL_MINOR, 0, null], [4, Chords.HALF_DIM, 0, null]],\n    [[5, Chords.BIG_MAJOR, 0, null], [6, Chords.SMALL_MAJOR, 0, null], \n     [7, Chords.SMALL_MINOR, 0, null], [8, Chords.HALF_DIM, 0, null]],\n    [ // piano recordings\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [10, Chords.BIG_MAJOR, 1, Timbres.PIANO], \n      [11, Chords.BIG_MAJOR, 2, Timbres.PIANO], [12, Chords.BIG_MAJOR, 3, Timbres.PIANO],\n      [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO], [14, Chords.SMALL_MAJOR, 1, Timbres.PIANO],\n      [15, Chords.SMALL_MAJOR, 2, Timbres.PIANO], [16, Chords.SMALL_MAJOR, 3, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [18, Chords.SMALL_MINOR, 1, Timbres.PIANO], \n      [19, Chords.SMALL_MINOR, 2, Timbres.PIANO], [20, Chords.SMALL_MINOR, 3, Timbres.PIANO],\n      [21, Chords.HALF_DIM, 0, Timbres.PIANO], [22, Chords.HALF_DIM, 1, Timbres.PIANO], \n      [23, Chords.HALF_DIM, 2, Timbres.PIANO], [24, Chords.HALF_DIM, 3, Timbres.PIANO],\n      // guitar recordings\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [42, Chords.BIG_MAJOR, 1, Timbres.GUITAR], \n      [43, Chords.BIG_MAJOR, 2, Timbres.GUITAR], [44, Chords.BIG_MAJOR, 3, Timbres.GUITAR],\n      [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR], [46, Chords.SMALL_MAJOR, 1, Timbres.GUITAR], \n      [47, Chords.SMALL_MAJOR, 2, Timbres.GUITAR], [48, Chords.SMALL_MAJOR, 3, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [50, Chords.SMALL_MINOR, 1, Timbres.GUITAR], \n      [51, Chords.SMALL_MINOR, 2, Timbres.GUITAR], [52, Chords.SMALL_MINOR, 3, Timbres.GUITAR],\n      [53, Chords.HALF_DIM, 0, Timbres.GUITAR], [54, Chords.HALF_DIM, 1, Timbres.GUITAR], \n      [55, Chords.HALF_DIM, 2, Timbres.GUITAR], [56, Chords.HALF_DIM, 3, Timbres.GUITAR],\n    ],\n  ],\n  tonal_context: [\n    [ // piano\n      [25, Chords.BIG_MAJOR, 0, Timbres.PIANO], [26, Chords.SMALL_MAJOR, 0, Timbres.PIANO],\n      [27, Chords.SMALL_MINOR, 0, Timbres.PIANO], [28, Chords.HALF_DIM, 0, Timbres.PIANO],\n      // guitar\n      [29, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [30, Chords.SMALL_MAJOR, 0, Timbres.GUITAR],\n      [31, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [32, Chords.HALF_DIM, 0, Timbres.GUITAR],\n    ],\n    [ // piano\n      [33, Chords.BIG_MAJOR, 0, Timbres.PIANO], [35, Chords.SMALL_MAJOR, 0, Timbres.PIANO],\n      [37, Chords.SMALL_MINOR, 0, Timbres.PIANO], [39, Chords.HALF_DIM, 0, Timbres.PIANO],\n      // guitar\n      [34, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [36, Chords.SMALL_MAJOR, 0, Timbres.GUITAR],\n      [38, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [40, Chords.HALF_DIM, 0, Timbres.GUITAR],\n    ],\n    [ // piano recordings\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [10, Chords.BIG_MAJOR, 1, Timbres.PIANO], \n      [11, Chords.BIG_MAJOR, 2, Timbres.PIANO], [12, Chords.BIG_MAJOR, 3, Timbres.PIANO],\n      [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO], [14, Chords.SMALL_MAJOR, 1, Timbres.PIANO],\n      [15, Chords.SMALL_MAJOR, 2, Timbres.PIANO], [16, Chords.SMALL_MAJOR, 3, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [18, Chords.SMALL_MINOR, 1, Timbres.PIANO], \n      [19, Chords.SMALL_MINOR, 2, Timbres.PIANO], [20, Chords.SMALL_MINOR, 3, Timbres.PIANO],\n      [21, Chords.HALF_DIM, 0, Timbres.PIANO], [22, Chords.HALF_DIM, 1, Timbres.PIANO], \n      [23, Chords.HALF_DIM, 2, Timbres.PIANO], [24, Chords.HALF_DIM, 3, Timbres.PIANO],\n      // guitar recordings\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [42, Chords.BIG_MAJOR, 1, Timbres.GUITAR], \n      [43, Chords.BIG_MAJOR, 2, Timbres.GUITAR], [44, Chords.BIG_MAJOR, 3, Timbres.GUITAR],\n      [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR], [46, Chords.SMALL_MAJOR, 1, Timbres.GUITAR], \n      [47, Chords.SMALL_MAJOR, 2, Timbres.GUITAR], [48, Chords.SMALL_MAJOR, 3, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [50, Chords.SMALL_MINOR, 1, Timbres.GUITAR], \n      [51, Chords.SMALL_MINOR, 2, Timbres.GUITAR], [52, Chords.SMALL_MINOR, 3, Timbres.GUITAR],\n      [53, Chords.HALF_DIM, 0, Timbres.GUITAR], [54, Chords.HALF_DIM, 1, Timbres.GUITAR], \n      [55, Chords.HALF_DIM, 2, Timbres.GUITAR], [56, Chords.HALF_DIM, 3, Timbres.GUITAR],\n    ],\n  ],\n  automatic: [\n    [ // piano\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [21, Chords.HALF_DIM, 0, Timbres.PIANO],\n      // guitar\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [53, Chords.HALF_DIM, 0, Timbres.GUITAR],\n    ],\n    [ // piano\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [21, Chords.HALF_DIM, 0, Timbres.PIANO],\n      // guitar\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [53, Chords.HALF_DIM, 0, Timbres.GUITAR],\n    ],\n    [ // piano recordings\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [10, Chords.BIG_MAJOR, 1, Timbres.PIANO], \n      [11, Chords.BIG_MAJOR, 2, Timbres.PIANO], [12, Chords.BIG_MAJOR, 3, Timbres.PIANO],\n      [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO], [14, Chords.SMALL_MAJOR, 1, Timbres.PIANO],\n      [15, Chords.SMALL_MAJOR, 2, Timbres.PIANO], [16, Chords.SMALL_MAJOR, 3, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [18, Chords.SMALL_MINOR, 1, Timbres.PIANO], \n      [19, Chords.SMALL_MINOR, 2, Timbres.PIANO], [20, Chords.SMALL_MINOR, 3, Timbres.PIANO],\n      [21, Chords.HALF_DIM, 0, Timbres.PIANO], [22, Chords.HALF_DIM, 1, Timbres.PIANO], \n      [23, Chords.HALF_DIM, 2, Timbres.PIANO], [24, Chords.HALF_DIM, 3, Timbres.PIANO],\n      // guitar recordings\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [42, Chords.BIG_MAJOR, 1, Timbres.GUITAR], \n      [43, Chords.BIG_MAJOR, 2, Timbres.GUITAR], [44, Chords.BIG_MAJOR, 3, Timbres.GUITAR],\n      [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR], [46, Chords.SMALL_MAJOR, 1, Timbres.GUITAR], \n      [47, Chords.SMALL_MAJOR, 2, Timbres.GUITAR], [48, Chords.SMALL_MAJOR, 3, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [50, Chords.SMALL_MINOR, 1, Timbres.GUITAR], \n      [51, Chords.SMALL_MINOR, 2, Timbres.GUITAR], [52, Chords.SMALL_MINOR, 3, Timbres.GUITAR],\n      [53, Chords.HALF_DIM, 0, Timbres.GUITAR], [54, Chords.HALF_DIM, 1, Timbres.GUITAR], \n      [55, Chords.HALF_DIM, 2, Timbres.GUITAR], [56, Chords.HALF_DIM, 3, Timbres.GUITAR],\n    ],\n  ],\n};\n\nconst correction_data = {\n  [LessonType.MUSICAL_PIECES]: [\n    {[Chords.BIG_MAJOR]: 9, [Chords.SMALL_MAJOR]: 13, [Chords.SMALL_MINOR]: 17, [Chords.HALF_DIM]: 21 },\n    {[Chords.BIG_MAJOR]: 9, [Chords.SMALL_MAJOR]: 13, [Chords.SMALL_MINOR]: 17, [Chords.HALF_DIM]: 21 },\n    null,\n  ],\n  [LessonType.TONAL_CONTEXT]: [\n    {[Chords.BIG_MAJOR]: 9, [Chords.SMALL_MAJOR]: 13, [Chords.SMALL_MINOR]: 17, [Chords.HALF_DIM]: 21 },\n    {[Chords.BIG_MAJOR]: 9, [Chords.SMALL_MAJOR]: 13, [Chords.SMALL_MINOR]: 17, [Chords.HALF_DIM]: 21 },\n    null,\n  ],\n  [LessonType.AUTOMATIC]: [null, null, null]\n};\n\nconst TrainingInfo = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = (\n      <div>\n      <p>          .   ,      .</p>\n      <p>      ,    .</p>\n      </div>);\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info = (\n      <div>\n        <p>           ,       .</p>\n        <p>      ,    .</p>\n      </div>);\n    break;\n  case LessonType.AUTOMATIC:\n    info = (\n      <div>\n        <p>    ,     ,    .</p>\n      </div>);\n  }\n  return <InfoScreen next={next} info={info}/>;\n};\n\nconst InfoBeforeTrainingPartB = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = (\n      <div>\n        <p>    ,      ,      .</p>\n        <p>      ,    .</p>\n      </div>);\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info = <p>       .       ,    .</p>;\n    break;\n  case LessonType.AUTOMATIC:\n    info = <p>:     ,     ,    .</p>;\n    break;\n  }\n  return <InfoScreen info={info} next={next}/>;\n};\n\nconst InfoBeforeTrainingPartC = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = <p>    ,   ,     ,    .</p>;\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info = <p>    ,   ,     ,    .</p>;\n    break;\n  case LessonType.AUTOMATIC:\n    info = <p>:     ,     ,    .</p>;\n    break;\n  }\n  return <InfoScreen info={info} next={next}/>;\n};\n\nconst SuccessfulIdentification = props => {\n  const { next } = props;\n  return (\n    <div className=\"row successScreenWrapper\">\n      <div className=\"col-sm-8 offset-sm-2 text-center\">\n        <span className=\"songTitle\"> { Strings.success_identification } &nbsp;</span>\n        <img src= { StaticImages.happySmiley } width=\"150px\" height=\"150px\" alt=\"\"/>\n        <br/>\n        <br/>\n        <ContinueButton next={next} />\n      </div>\n    </div>\n  );\n};\n\nconst FailedIdentification = props => {\n  const { shouldShowCorrect, shouldShowButton, correctChord, lesson_type, part, next} = props;\n\n  let appendix;\n\n  if (shouldShowCorrect === true){\n    const button = shouldShowButton ? <ContinueButton next={next} /> : null;\n    let text;\n    if (part === 2 || lesson_type === LessonType.AUTOMATIC) text = \"    \";\n    else if (lesson_type === LessonType.MUSICAL_PIECES) text = \"   \";\n    else text = \"   \";\n    \n    appendix = \n      <div>\n        <span className=\"songTitle\">{ text } </span>\n        <span className=\"songTitle\">{ correctChord }</span>\n        <br/>\n        <span className=\"songTitle\">{ Strings.how_it_sounds }</span>\n        <br/>\n        <br/>\n        {button}\n      </div>;\n  } else appendix = null;\n\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-sm-9 offset-sm-1 text-center\">\n            <span className=\"songTitle\"> { Strings.failure_identification } &nbsp;</span>\n            <br/>\n            <span className=\"songTitle\">{ Strings.how_it_sounds }</span>\n            { appendix }\n        </div>\n        <div className=\"col-sm-2\">\n          <img src= { StaticImages.sadSmiley } width=\"150px\" height=\"150px\" alt=\"\" className=\"sadSmiley\"/>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst SongWithChords = props => {\n  const { songData, chord_buttons, disabled, next } = props;\n\n  const gen_button = (chord, i) => {\n    if (disabled) \n      return <td key={i}><button className=\"chordBtn\" disabled key={i} onClick={(e) => next(chord)}>{chord}</button></td>;\n    else \n      return <td key={i}><button className=\"chordBtn\" key={i} onClick={(e) => next(chord)}>{chord}</button></td>;\n  };\n\n  return (\n    <div className=\"songDisplayWrapper\">\n      <img className=\"songImage\" src={ songData.imgSrc } alt=\"\"/>\n      <div className=\"row\">\n        <div className=\"col text-center songTitle\">\n           :\n          <br/>\n          { songData.name }\n          <br/>\n          <br/>\n           :\n        </div>\n\n      </div>\n      <div className=\"row chordsTable text-center\">\n        <div className=\"col text-center chords\">\n          <table className=\"chordsTable text-center\">\n            <tbody>\n              <tr>\n                {chord_buttons.map((chord, i) => gen_button(chord, i))}\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst ChordSelection = ({chord_buttons, disabled, with_song_names, next}) => {\n  const labels = chord_buttons.map(chord => with_song_names ? \n                                   <p>{chord} <br/> {musical_pieces_data[chord].name}</p> : \n                                   <p>{chord}</p>);\n\n  return <ButtonTable labels={labels} values={chord_buttons} disabled={disabled} next={next} />;\n};\n\nclass TrainingPart extends React.Component {\n  state = {\n    trial_idx: 0,\n    done_loading: false,\n    done_playing: false,\n    show_feedback: false,\n    answer: null,\n  };\n\n  trials_per_part = 32;\n\n  constructor({part, session, chord_buttons, next, data}) {\n    super();\n    this.part = part;\n    this.session = session;\n    this.chord_buttons = chord_buttons;\n    this.next = next;\n    this.data = data;\n\n    switch (session.lesson_type) {\n    case LessonType.MUSICAL_PIECES:\n      this.part_data = training_data.musical_pieces[part];\n      break;\n    case LessonType.TONAL_CONTEXT:\n      this.part_data = training_data.tonal_context[part];\n      break;\n    case LessonType.AUTOMATIC:\n      this.part_data = training_data.automatic[part];\n      break;\n    };\n\n    this.ls_prefix = \"training_part\" + part + \"_\";\n    if (session.continued) {\n      this.sequence = ls.get(this.ls_prefix + \"sequence\");\n      const trial_idx = ls.get(this.ls_prefix + \"trial_idx\");\n      if (trial_idx !== null) this.state.trial_idx = trial_idx;\n      session.continued = false; // we only need to restore session once!\n    }\n    else {\n      this.sequence = randomSequence(this.part_data, this.trials_per_part);\n      ls.set(this.ls_prefix + \"sequence\", this.sequence);\n      ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx);\n    }\n    console.log(\"TRAINING PART \" + part + \" sequence:\");\n    console.log(this.sequence);\n\n    const that = this;\n    const doneLoadingAudio = () => {\n      that.setState({done_loading: true});\n      that.audioController.play(that.sequence[that.state.trial_idx][0]);\n      that.response_start = new Date();\n    };\n\n    const donePlaying = () => {\n      that.setState({done_playing: true});\n      \n      // this part runs when we give feedback for an incorrect answer.\n      if (this.state.show_feedback) {\n        if (!this.state.fail_show_correct) {\n          // play the correct answer audio idx\n          this.audioController.play(this.state.correct_audio_idx);\n          this.setState({fail_show_correct: true});\n        } else {\n          // done playing feedback, show continue button.\n          this.setState({done_playing_correct_feedback: true});\n        }\n      }\n    };\n\n    let correction_idxs = [];\n    const corrections_for_part = correction_data[this.session.lesson_type][this.part];\n    if (corrections_for_part !== null) {\n      for (const chord in corrections_for_part)\n        correction_idxs.push(corrections_for_part[chord]);\n    }\n\n    console.log(\"audioidxs\");\n    console.log(correction_idxs);\n    this.audioController = new AudioController(correction_idxs.concat(this.part_data.map(d => d[0])), doneLoadingAudio, donePlaying);\n  }\n\n  /* calculate the transposition count since the beginning of training (currently of part). */\n  get_transposition_play_count() { \n    const idx = this.state.trial_idx;\n    const trial = this.sequence[idx];\n    const count_in_part = this.sequence.slice(0, idx)\n      .filter(t => t[1] === trial[1] && t[2] === trial[2]).length + 1;\n    return count_in_part;\n  }\n\n  render() {\n    const that = this;\n    const trial_data = this.sequence[this.state.trial_idx];\n    const chord_name = trial_data[1];\n    const transposition = trial_data[2];\n\n    const nextTrial = () => {\n      const trial_idx = that.state.trial_idx;\n      if (trial_idx < that.trials_per_part - 1) {\n        that.setState({trial_idx: trial_idx + 1,\n                       done_playing: false,\n                       show_feedback: false});\n        that.audioController.play(this.sequence[trial_idx+1][0]);\n        that.response_start = new Date(); // RT measurement\n      }\n      else {\n        that.next();\n      }\n    };\n\n    const processAnswer = (answer) => {\n      const correct = answer === chord_name;\n      // save trial data\n      const td = {\n        time: new Date().toString(),\n        audio_index: trial_data[0],\n        chord_number: that.trials_per_part * this.part + this.state.trial_idx + 1,\n        chord_type: chord_name,\n        transposition: transposition + 1,\n        transposition_play_count: that.get_transposition_play_count(),\n        selected_chord_type: answer,\n        correct: correct,\n        response_time: new Date() - that.response_start,\n      };\n      that.data.trials.push(td);\n      ls.set(\"data\", that.data);\n      if (this.state.trial_idx+1 < this.trials_per_part)\n        ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx+1);\n\n      // stop playback\n      that.audioController.stop(trial_data[0]);\n\n      // continue to show answer feedback\n      if (!correct) {\n        // start playing the chosen chord and then the right chord.\n        // [idx, chord, trnsp, timbre]\n        console.log(correction_data);\n        const corrections_for_part = correction_data[this.session.lesson_type][this.part];\n        const selected_audio_idx = corrections_for_part !== null ?\n              corrections_for_part[answer] :\n              that.part_data.filter(d => d[1] === answer && d[2] === transposition && d[3] === trial_data[3])[0][0];\n\n        const correct_audio_idx = corrections_for_part !== null ?\n              corrections_for_part[trial_data[1]] :\n              trial_data[0];\n        console.log(\"correct_audio_idx: \" + correct_audio_idx);\n\n        this.setState({show_feedback: true,\n                       correct: correct,\n                       fail_show_correct: false,\n                       done_playing_correct_feedback: false,\n                       correct_audio_idx: correct_audio_idx});\n        that.audioController.play(selected_audio_idx);\n      }\n      else {        \n        that.setState({show_feedback: true,\n                       correct: correct});\n      }\n    };\n    \n    if (!this.state.done_loading) \n      return <LoadingScreen />;\n\n    if (!this.state.show_feedback) {\n      let screen;\n      if (this.part < 2 && this.session.lesson_type === LessonType.MUSICAL_PIECES) {\n        const song_data = musical_pieces_data[chord_name];\n        screen = <SongWithChords songData={song_data} chord_buttons={this.chord_buttons} next={processAnswer}/>;\n      }\n      else {\n        screen = <ChordSelection chord_buttons={this.chord_buttons} next={processAnswer}/>;\n      }\n      \n      return (\n        <div className=\"container\">\n          {screen}\n        </div>\n      );\n    }\n    else { // show feedback screen\n      if (this.state.correct) {\n        return <SuccessfulIdentification next={nextTrial}/>;\n      } else {\n        this.nextTrial = nextTrial;\n        return <FailedIdentification shouldShowCorrect={this.state.fail_show_correct} shouldShowButton={this.state.done_playing_correct_feedback} correctChord={chord_name} lesson_type={this.session.lesson_type} next={nextTrial} part={this.part}/>;\n      }\n    }\n  }\n};\n\nexport class TrainingBlock extends React.Component {\n  steps = {\n    INFO_A: 1,\n    PART_A: 2,\n    INFO_B: 3,\n    PART_B: 4,\n    INFO_C: 5,\n    PART_C: 6,\n    DONE: 7,\n  }\n\n  state = {\n    step: 1,\n  }\n\n  chord_buttons = shuffleArray([Chords.BIG_MAJOR, Chords.SMALL_MAJOR, Chords.SMALL_MINOR, Chords.HALF_DIM]);\n\n  nextStep = () => {\n    const { step } = this.state;\n    \n    this.setState({\n      step: step + 1\n    });\n    ls.set(\"training_block_step\", step + 1);\n\n    if (step + 1 === this.steps.DONE)\n      this.next();\n  }\n\n  constructor({data, session, next}) {\n    super();\n    this.data = data;\n    this.session = session;\n    this.next = next;\n\n    if (session.continued) {\n      this.chord_buttons = ls.get(\"training_block_chord_buttons\");      \n      this.state.step = ls.get(\"training_block_step\");\n    }\n    else {\n      ls.set(\"training_block_chord_buttons\", this.chord_buttons);\n      ls.set(\"training_block_step\", this.state.step);\n    }\n  }\n\n  render() {\n    const { step } = this.state;\n    let screen;\n    switch (step) {\n    case this.steps.INFO_A:\n      this.session.continued = false;\n      screen = <TrainingInfo lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_A:\n      screen = <TrainingPart part={0} session={this.session} next={this.nextStep} key={step} chord_buttons={this.chord_buttons} data={this.data} />;\n      break;\n    case this.steps.INFO_B:\n      this.session.continued = false;\n      screen = <InfoBeforeTrainingPartB lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_B:\n      screen = <TrainingPart part={1} session={this.session} next={this.nextStep} key={step} chord_buttons={this.chord_buttons} data={this.data} />;\n      break;\n    case this.steps.INFO_C:\n      this.session.continued = false;\n      screen = <InfoBeforeTrainingPartC lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_C:\n      screen = <TrainingPart part={2} session={this.session} next={this.nextStep} key={step} chord_buttons={this.chord_buttons} data={this.data} />;\n      break;\n    case this.steps.DONE:\n      screen = null;\n      break;\n    };\n\n    return screen;\n  }\n}\n","/* functions for reading and writing to a google spreadsheet.\n   \n */\n\nconst read_url = \"https://sheets.googleapis.com/v4/spreadsheets/\";\n\n// https://stackoverflow.com/questions/1714786/query-string-encoding-of-a-javascript-object\nconst serialize = function(obj, prefix) {\n  var str = [],\n    p;\n  for (p in obj) {\n    if (obj.hasOwnProperty(p)) {\n      var k = prefix ? prefix + \"[\" + p + \"]\" : p,\n        v = obj[p];\n      str.push((v !== null && typeof v === \"object\") ?\n        serialize(v, k) :\n        encodeURIComponent(k) + \"=\" + encodeURIComponent(v));\n    }\n  }\n  console.log(\"serialize: \" + str.join(\"&\"));\n  return str.join(\"&\");\n}\n\nconst parse_sheet_list = (data) => {\n  let sheetNames = [];\n  data.sheets.forEach(sheet => {\n    sheetNames.push(sheet.properties.title);\n  });\n  return sheetNames;\n};\n\nconst gs = {\n  read: function(conn, sheetName, range) {\n    return fetch(read_url + \n                 conn.spreadsheet_id + \n                 \"/values/\" + \n                 sheetName + \n                 \"!\" + range + \n                 \"?key=\" + conn.api_key);\n  },\n\n  write: function(conn, sheetName, data) {\n    if (!Array.isArray(data))\n        data = [data];\n\n    let url = conn.write_url + \"?sheet_name=\" + sheetName;\n    return fetch(url,\n                 {\n                   headers: {\n                     'Accept': 'application/json',\n                     'Content-Type': 'application/json'\n                   },\n                   method: \"POST\",\n                   mode: 'no-cors',\n                   body: JSON.stringify(data),\n                 });\n  },\n\n  list_sheets: function(conn) {\n    return fetch(read_url + conn.spreadsheet_id + \"?key=\" + conn.api_key)\n      .then(res => res.json())\n      .then(parse_sheet_list);\n  },\n};\n\nexport default gs;\n","import gs from './spreadsheet_io.js';\nimport { SheetNames } from './defs.js';\nimport ls from 'local-storage';\n\nconst FIRST_HOUR_OF_DAY = 3; // day starts at 3 am.\n\nexport const SessionEvent = {\n  SESSION_START: \"SESSION_START\",\n  SESSION_CONTINUED: \"SESSION_CONTINUED\",\n  SESSION_END: \"SESSION_END\",\n};\n\n// parse session json data from sheets api into an array of session objects.\nexport const parseSessions = (data) => {\n  let sessions = [];\n  data.values.forEach(session_event => {\n    let session = {\n      id: session_event[0],\n      number: session_event[1],\n      event: session_event[2],\n      lesson_type: session_event[3],\n      time: session_event[4],\n    };\n    sessions.push(session);\n  });\n  return sessions;\n};\n\nexport const writeSessionEvent = (conn, session, event, on_error) => {\n  let request_data = Object.assign({event: event,\n                                    time: new Date().toString()},\n                                    session);\n  ls.set('session', session);\n  gs.write(conn, SheetNames.TRAINING_SESSIONS, request_data)\n    .catch(on_error);\n\n};\n\nexport const readSessionData = (conn) => {\n  return gs.read(conn, SheetNames.TRAINING_SESSIONS, \"A2:E10000\")\n    .then(response => response.json())\n    .then(parseSessions);\n  \n};\n\nexport const readLessonType = (conn, id) => {\n  const findLessonType = (data) => {\n    let lesson_type = -1;\n    data.values.forEach(row => {\n      if (row[0] === id)\n        lesson_type = parseInt(row[1]);\n    });    \n    return lesson_type;\n  }\n\n  return gs.read(conn, SheetNames.LESSON_TYPES, \"A2:B10000\")\n    .then(response => response.json())\n    .then(findLessonType)\n};\n\n// Return true if the last session was today. Day starts at FIRST_HOUR_OF_DAY\nexport const was_last_session_today = (last_session) => {\n  let last_time = new Date(last_session.time);\n  last_time.setHours(last_time.getHours() - FIRST_HOUR_OF_DAY);\n  let now = new Date();\n  now.setHours(now.getHours() - FIRST_HOUR_OF_DAY);\n  return now.getDate() === last_time.getDate();\n};\n\nexport const does_user_sheet_exists = (conn, user_id) => {\n  return gs.list_sheets(conn)\n    .then(sheets => sheets.includes(user_id));\n};\n","import React from 'react';\nimport '../Experiment.css';\nimport './TrainingExperiment.css';\nimport { IntroText, InfoText, PretestInfo } from './info.js';\nimport { LessonBlock } from './lesson_block.js';\nimport { TrainingBlock } from './training_block.js';\nimport { InfoScreen, LoadingScreen, ErrorScreen, ContinueButton, ButtonTable } from '../ui.js';\nimport { does_user_sheet_exists, was_last_session_today, SessionEvent, writeSessionEvent, readSessionData, readLessonType } from '../sessions.js';\nimport { randomSequence } from '../randomize.js';\nimport gs from '../spreadsheet_io.js';\nimport ls from 'local-storage';\n\nconst MAX_NUMBER_OF_SESSIONS = 5;\n\n// 1st screen.\nconst IntroScreen = ({next, data}) => {\n  function handleContinue() {\n    data.id = document.getElementById('id_input').value;\n    next();\n  }\n\n  return ( // the hidden p tag is there to balance the \" marks\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-md-8 offset-md-2 infotext\">\n          <IntroText />\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col\"></div>\n        <div className=\"col text-center\">\n          <br/>\n          <label>\": <input type=\"text\" id=\"id_input\"/><br/></label>\n          <p hidden>\"</p>\n          <br/>\n          <ContinueButton next={handleContinue} disabled={false} />\n        </div>\n        <div className=\"col\"></div>\n      </div>\n    </div>\n  );\n};\n\nconst FinishScreen = ({done_saving, session_number}) => {\n  const remaining = MAX_NUMBER_OF_SESSIONS - session_number;\n  return (\n    <div className=\"container\">\n      <div className=\"col-md-8 offset-md-2\">\n        <p>  {session_number} .   {remaining} .</p>\n        <p>{done_saving ? \"  !\" : \"   ...\"}</p>\n      </div>\n    </div>\n  );\n};\n\nclass PretestBlock extends React.Component {\n  state = {\n    trial_idx: 0,\n  };\n\n  practice_trials_count = 8;\n  test_trails_count = 20;\n  button_idxs = [0, 1, 2, 3];\n\n  constructor({session, next, data}) {\n    super();\n    this.next = next;\n    this.data = data;\n    this.session = session;\n\n    this.ls_prefix = \"pretest_\";\n    if (session.continued) {\n      this.sequence = ls.get(this.ls_prefix + \"sequence\");\n      const trial_idx = ls.get(this.ls_prefix + \"trial_idx\");\n      if (trial_idx !== null) this.state.trial_idx = trial_idx;\n      session.continued = false;\n    }\n    else {\n      const practice_sequence = randomSequence(this.button_idxs, this.practice_trials_count);\n      const test_sequence = randomSequence(this.button_idxs, this.test_trails_count);\n      this.sequence = practice_sequence.concat(test_sequence);\n      ls.set(this.ls_prefix + \"sequence\", this.sequence);\n      ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx);\n    }\n\n    console.log(\"Pretest sequence:\");\n    console.log(this.sequence);\n    this.response_start = new Date();\n  }\n\n  render() {\n    const that = this;\n    const target_btn = this.sequence[this.state.trial_idx];\n\n    const nextTrial = (selection) => {\n      if (this.state.trial_idx+1 > this.practice_trials_count) {\n        // save trial data\n        const correct = selection === target_btn;\n        const td = {\n          time: new Date().toString(),\n          correct: correct,\n          response_time: new Date() - that.response_start,\n          session_number: 0,\n        };\n        that.data.trials.push(td);\n        ls.set(\"data\", that.data);\n      }\n\n      if (this.state.trial_idx < that.practice_trials_count + that.test_trails_count - 1) {\n        that.setState({trial_idx: this.state.trial_idx + 1});\n        that.response_start = new Date();\n        ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx+1);\n      }\n      else {\n        that.next();\n      }\n    };\n    let labels = [null, null, null, null];\n    labels[target_btn] = <div className=\"pretestCircle\"></div>;\n    return (\n      <div className=\"container\">\n        <ButtonTable labels={labels} values={this.button_idxs} next={nextTrial} key={this.state.trial_idx}/>\n      </div>\n    );\n  }\n};\n\nclass TrainingExperiment extends React.Component {\n  conn = { // read/write connection details for google spreadsheet.\n    spreadsheet_id: '1D2s3D13ldvchzueCFWTkvH8kzhNBEMZzizPnjGQnhMY',\n    api_key: 'AIzaSyDHFHbGy_GhEt1Q4FW61YYEX2jk3hZcSoQ',\n    write_url: 'https://script.google.com/macros/s/AKfycbxv6Uc9VsHlKI6SMe6YmH-MELryrJYvYg-uQnGFhyMF2X7zyC-O/exec',\n  }\n\n  steps = {\n    INTRO: 1,\n    INFO: 2, \n    PRETEST_INFO: 3,\n    PRETEST: 4, \n    LESSON: 5,\n    TRAINING: 6,\n    FINISH: 7\n  }\n\n  state = {\n    step: 1,\n    is_loading_session: true, // true until session data is received.\n    did_check_user_registered: false, // false until sheet list is received.\n    done_saving: false, // false until the data is saved to the spreadsheet.\n    max_sessions_reached: false,\n    session_done_for_today: false,\n    user_unregistered: true,\n    did_load_registration_list: false,\n    did_load_lesson_type: false,\n  };\n\n  data = {\n    id: undefined,\n    trials: [],\n  };\n\n  maybe_start_session = () => {\n    // Check previous sessions data. Start a new session accordingly\n    // or enforce session limits.\n    let session = {id: this.data.id};\n    const previous_sessions = this.sessions.filter(e => e.id === session.id);\n    if (previous_sessions.length === 0) {\n      // First session\n      ls.clear();\n      session.number = 1;\n      this.setState({did_load_lesson_type: false});\n      readLessonType(this.conn, session.id)\n        .then(lesson_type => {\n          if (lesson_type === -1)\n            this.setState({session: session, \n                           user_unregistered: true,\n                           did_load_lesson_type: true});\n          else {\n            session.lesson_type = lesson_type;\n            writeSessionEvent(this.conn, session, \n                              SessionEvent.SESSION_START);\n            \n            this.setState({session: session,\n                           did_load_lesson_type: true});\n          }\n\n        })\n        .catch(err => { alert(\"Error while reading lessons: \" + err); });\n    }\n    else {\n      // Not first session\n      const last_session = previous_sessions[previous_sessions.length-1];\n      const last_session_number = parseInt(last_session.number);\n      \n      session.lesson_type = parseInt(last_session.lesson_type);\n      if (last_session.event !== SessionEvent.SESSION_END) {\n        // The last session for this subject id isn't finished.\n        if (was_last_session_today(last_session)) {\n          // Same day. Try to continue the last session.\n          session.number = last_session_number;\n          // Retreive session and data from local storage.\n          console.log(\"Loading session data from local storage.\");\n          const continued_session = ls.get('session');\n          if (continued_session && continued_session.id === session.id) {\n            writeSessionEvent(this.conn, session, \n                              SessionEvent.SESSION_CONTINUED, this.sessionEventError);\n            session = continued_session;\n            const continued_data = ls.get('data');\n            if (continued_data) {\n              console.log(\"Loading experiment data from local storage.\");\n              this.data = continued_data;\n            }\n            \n            const continued_step = ls.get('step');\n            \n            session.continued = true;\n            this.setState({step: continued_step || this.steps.INFO,\n                           session: session});\n            this.stepChanged(continued_step);\n          } \n          else {\n            // Can't continue session. Redo the session (this shouldn't actually happen)\n            ls.clear();\n            session.number = last_session_number;\n            writeSessionEvent(this.conn, session, \n                                SessionEvent.SESSION_START);\n            this.setState({session: session});\n          }\n        }\n        else {\n          // A new day.\n          ls.clear();\n          this.setState({cant_continue_session: true,\n                         session: session});\n        }\n      }\n      else {\n        // The last session was finished. \n        ls.clear();\n        if (last_session_number >= MAX_NUMBER_OF_SESSIONS) {\n          // enforce the session limit.\n          this.setState({max_sessions_reached: true,\n                         session: session});\n        }\n        else {\n          if (!was_last_session_today(last_session)) {\n            // Start a new session\n            session.number = last_session_number + 1;\n            writeSessionEvent(this.conn, session, \n                              SessionEvent.SESSION_START);\n            this.setState({session: session});\n          }\n          else {\n            // No more sessions for today.\n            this.setState({session_done_for_today: true,\n                           session: session});\n          }\n        }\n      }\n    }\n  }\n\n  nextStep = () => {\n    const { step } = this.state;\n    let new_step;\n\n    // jump over pretest after the 1st session.\n    if (this.state.session && this.state.session.number && \n        this.state.session.number !== 1 && (step + 1 === this.steps.PRETEST_INFO || step + 1 === this.steps.PRETEST)) \n      new_step = this.steps.LESSON;\n    else \n      new_step = step + 1;\n\n    if (step > 1) // otherwise the key will be overwritten before loading.\n      ls.set('step', new_step);\n    this.stepWillChange(step, new_step);\n    this.setState({\n      step: new_step\n    });\n    this.stepChanged(new_step);\n  }\n\n  stepWillChange = (step, new_step) => {\n    if (step === this.steps.INTRO) {\n      does_user_sheet_exists(this.conn, this.data.id)\n        .then((sheet_exists) => { \n          this.setState({did_load_registration_list: true});\n          if (sheet_exists) {\n            this.setState({user_unregistered: false});\n            this.maybe_start_session(); \n          }\n          else this.setState({user_unregistered: true, session: {}});\n        }).catch(this.sessionDataLoadError);\n    }\n  } \n\n  stepChanged = (step) => {   \n    if (step === this.steps.FINISH) {\n      // end of session. \n      this.data.end_time = new Date().toString();\n\n      // write data\n      console.log(\"Saving data...\");\n      console.log(this.data.trials);\n\n      this.data.trials.forEach(t => { \n        t.id = this.data.id;\n        if (t.session_number === undefined)\n          t.session_number = this.state.session.number;\n        t.start_time = this.data.start_time;\n        t.end_time = this.data.end_time;\n      });\n\n      let that = this;\n      gs.write(this.conn, this.data.id, this.data.trials)\n        .then(res => { that.setState({done_saving: true});\n                       ls.clear(); })\n        .catch(this.dataSaveError);\n\n      // write session ended event\n      writeSessionEvent(this.conn, this.state.session, \n                        SessionEvent.SESSION_END, this.sessionEventError);\n      // TODO: need to make sure both writes finished before setting done_saving: true!\n\n      // clear session from local storage. TODO: also do this only after both saves are done.\n\n    }\n  }\n\n  dataSaveError = (response) => {\n    alert(\"Error while saving data: \" + response);\n  }\n\n  sessionEventError = (response) => { // TODO\n    alert(\"Error while writing session event.\");\n  }\n\n  sessionDataLoaded = (session_data) => {\n    this.setState({ is_loading_session: false });\n    this.sessions = session_data;\n  }\n\n  sessionDataLoadError = (response) => { // TODO\n    // ask to refresh the page, try again... contact info?\n    alert(\"Session data load error: \" + response);\n  }\n\n  componentDidMount() {\n    // read session data\n    var that = this;\n    \n    readSessionData(this.conn)\n      .then(that.sessionDataLoaded)\n      .catch(that.sessionDataLoadError);\n\n    this.data.start_time = new Date().toString();\n  }\n\n  getScreenForStep(step) {\n    let screen;\n    switch(step) {\n      case this.steps.INTRO:\n        screen = <IntroScreen data={this.data} next={this.nextStep} />;\n        break;\n      case this.steps.INFO:\n        this.state.session.continued = false;\n        const info = <InfoText lesson_type={this.state.session.lesson_type} />;\n        screen = <InfoScreen info={info} next={this.nextStep}/>;\n        break;\n      case this.steps.PRETEST_INFO:\n        this.state.session.continued = false;\n        const pretest_info = <PretestInfo />;\n        screen = <InfoScreen info={pretest_info} next={this.nextStep} />;\n        break;\n      case this.steps.PRETEST:\n        screen = <PretestBlock data={this.data} next={this.nextStep} session={this.state.session} />;\n        break;\n      case this.steps.LESSON:\n        screen = <LessonBlock data={this.data} next={this.nextStep} session={this.state.session} />;\n        break;\n      case this.steps.TRAINING:\n        screen = <TrainingBlock data={this.data} next={this.nextStep} session={this.state.session} />;\n        break;\n      case this.steps.FINISH:\n        screen = <FinishScreen done_saving={this.state.done_saving} session_number={this.state.session.number} />;\n    }\n    \n    return screen;\n  } \n\n  render() {\n    const {step} = this.state;\n\n    let screen;\n\n    if (this.state.is_loading_session || !this.state.did_load_lesson_type)\n      screen = <LoadingScreen />;\n    if (this.state.step === 2) {\n      // After entering ID on the intro screen we check the session data before continuing.\n      if (!this.state.did_load_registration_list || !this.state.session) \n        screen = <LoadingScreen />;\n      else {\n        if (this.state.max_sessions_reached)\n          screen = <ErrorScreen error=\"    .\" />;\n        else if (this.state.session_done_for_today)\n          screen = <ErrorScreen error=\"      .    .\" />;\n        else if (this.state.did_load_registration_list && this.state.user_unregistered)\n          screen = <ErrorScreen error=\"    !       .\" />;\n        else if (this.state.cant_continue_session) \n          screen = <ErrorScreen error=\"    .    .     .\" />;\n        else screen = this.getScreenForStep(step);\n      }\n    }\n    else screen = this.getScreenForStep(step);\n\n    return screen;\n  }\n}\n\nexport default TrainingExperiment;\n","import React from 'react';\nimport { Button, ContinueButton, ButtonTable } from '../ui.js';\nimport ls from 'local-storage';\nimport { randomSequence } from '../randomize.js';\n\nconst PretestTrial = ({button_labels, next, trial_idx, trial_chord}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"overlay-box\"><p>{trial_chord}</p></div>\n      <div className=\"row\">\n        <ButtonTable labels={button_labels} values={button_labels} next={next} key={trial_idx} />\n      </div>\n    </div>    \n\n  );\n};\n\nconst ContinueScreen = ({next, on_keep_going}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col text-center\">\n          <p>    ?</p>\n        </div>\n      </div>\n      <br/>\n      <div className=\"row\">\n        <div className=\"col-sm-2 offset-sm-4 text-center\">\n          <Button label=\"\" onClick={on_keep_going}/>\n        </div>      \n        <div className=\"col-sm-2 text-center\">\n          <Button label=\"\" onClick={next}/>\n        </div>\n      </div>            \n    </div>\n  );\n};\n\nexport class PretestBlock extends React.Component {\n  state = {\n    trial_idx: 0,\n    keep_going: false,\n  }\n\n  trials_count = 14;\n\n  ls_prefix = \"test_pretest_\";\n\n  constructor({data, next, button_labels}) {\n    super();\n    this.data = data;\n    this.next = next;\n    this.button_labels = button_labels;\n    \n    const cont_trial_idx = ls.get(this.ls_prefix + \"trial_idx\");\n    if (cont_trial_idx !== null) {      \n      console.log(\"loading sequence from local storage\");\n      this.sequence = ls.get(this.ls_prefix + \"sequence\");\n      this.state.trial_idx = cont_trial_idx;\n    }\n    else {\n      this.sequence = randomSequence(button_labels, this.trials_count);\n      ls.set(this.ls_prefix + \"sequence\", this.sequence);\n      ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx);      \n    }\n    console.log(\"sequence:\");\n    console.log(this.sequence);\n  }\n\n  nextTrial = (answer) => {\n    const { trial_idx } = this.state;\n\n    this.data.trials.push({\n      time: new Date().toString(),\n      subtest: 0,\n      chord_type: this.sequence[trial_idx % this.trials_count],\n      selected_chord_type: answer,\n      correct: answer === this.sequence[trial_idx % this.trials_count],\n      response_time: new Date() - this.response_start\n    });\n    ls.set(\"test_data\", this.data);\n\n    this.setState({trial_idx: trial_idx + 1,\n                   keep_going: false});\n    ls.set(this.ls_prefix + \"trial_idx\", trial_idx + 1);\n    this.response_start = new Date();\n  }\n\n  keepGoing = () => {\n    this.sequence = randomSequence(this.button_labels, this.trials_count);\n    ls.set(this.ls_prefix + \"sequence\", this.sequence);      \n    console.log(\"sequence:\");\n    console.log(this.sequence);\n    this.setState({keep_going: true});\n    this.response_start = new Date();\n  };\n\n  componentDidMount() {\n    this.response_start = new Date();\n  }\n  \n  render() {\n    const { trial_idx } = this.state;\n    if (trial_idx > 0 && this.state.keep_going === false && ((trial_idx) % this.trials_count === 0)) {\n      return <ContinueScreen next={this.next} on_keep_going={this.keepGoing} />;\n    }\n    else {\n      return <PretestTrial button_labels={this.button_labels} next={this.nextTrial} trial_idx={this.state.trial_idx} trial_chord={this.sequence[this.state.trial_idx % this.trials_count]}/>;\n    }\n  }\n}\n\n","import { Chords, Timbres, Variants } from '../defs.js';\n\n// subtest number -> [[audio_idx, chord, transposition, timbre, variant], ...]\nexport const audio_mapping = [\n  // Subtest A\n  [[297, Chords.BIG_MAJOR, 0, Timbres.PIANO, 0], [298, Chords.BIG_MAJOR, 1, Timbres.PIANO, 0],\n   [299, Chords.BIG_MAJOR, 2, Timbres.PIANO, 0], [300, Chords.BIG_MAJOR, 3, Timbres.PIANO, 0],\n   [301, Chords.SMALL_MAJOR, 0, Timbres.PIANO, 0], [302, Chords.SMALL_MAJOR, 1, Timbres.PIANO, 0],\n   [303, Chords.SMALL_MAJOR, 2, Timbres.PIANO, 0], [304, Chords.SMALL_MAJOR, 3, Timbres.PIANO, 0],\n   [305, Chords.SMALL_MINOR, 0, Timbres.PIANO, 0], [306, Chords.SMALL_MINOR, 1, Timbres.PIANO, 0],\n   [307, Chords.SMALL_MINOR, 2, Timbres.PIANO, 0], [308, Chords.SMALL_MINOR, 3, Timbres.PIANO, 0],\n   [309, Chords.HALF_DIM, 0, Timbres.PIANO, 0], [310, Chords.HALF_DIM, 1, Timbres.PIANO, 0],\n   [311, Chords.HALF_DIM, 2, Timbres.PIANO, 0], [312, Chords.HALF_DIM, 3, Timbres.PIANO, 0],\n\n   [313, Chords.BIG_MAJOR, 0, Timbres.GUITAR, 0], [314, Chords.BIG_MAJOR, 1, Timbres.GUITAR, 0],\n   [315, Chords.BIG_MAJOR, 2, Timbres.GUITAR, 0], [316, Chords.BIG_MAJOR, 3, Timbres.GUITAR, 0],\n   [317, Chords.SMALL_MAJOR, 0, Timbres.GUITAR, 0], [318, Chords.SMALL_MAJOR, 1, Timbres.GUITAR, 0],\n   [319, Chords.SMALL_MAJOR, 2, Timbres.GUITAR, 0], [320, Chords.SMALL_MAJOR, 3, Timbres.GUITAR, 0],\n   [321, Chords.SMALL_MINOR, 0, Timbres.GUITAR, 0], [322, Chords.SMALL_MINOR, 1, Timbres.GUITAR, 0],\n   [323, Chords.SMALL_MINOR, 2, Timbres.GUITAR, 0], [324, Chords.SMALL_MINOR, 3, Timbres.GUITAR, 0],\n   [325, Chords.HALF_DIM, 0, Timbres.GUITAR, 0], [326, Chords.HALF_DIM, 1, Timbres.GUITAR, 0],\n   [327, Chords.HALF_DIM, 2, Timbres.GUITAR, 0], [328, Chords.HALF_DIM, 3, Timbres.GUITAR, 0],   \n  ],\n\n  // Subtest B\n  [[57, Chords.BIG_MAJOR, 0, Timbres.PIANO, Variants.OPEN], [58, Chords.BIG_MAJOR, 1, Timbres.PIANO, Variants.OPEN],\n   [59, Chords.BIG_MAJOR, 2, Timbres.PIANO, Variants.OPEN], [60, Chords.BIG_MAJOR, 3, Timbres.PIANO, Variants.OPEN],\n   [61, Chords.BIG_MAJOR, 0, Timbres.PIANO, Variants.INVERSION], [62, Chords.BIG_MAJOR, 1, Timbres.PIANO, Variants.INVERSION],\n   [63, Chords.BIG_MAJOR, 2, Timbres.PIANO, Variants.INVERSION], [64, Chords.BIG_MAJOR, 3, Timbres.PIANO, Variants.INVERSION],\n   [65, Chords.BIG_MAJOR, 0, Timbres.PIANO, Variants.REGISTER], [66, Chords.BIG_MAJOR, 1, Timbres.PIANO, Variants.REGISTER],\n   [67, Chords.BIG_MAJOR, 2, Timbres.PIANO, Variants.REGISTER], [68, Chords.BIG_MAJOR, 3, Timbres.PIANO, Variants.REGISTER],\n\n   [69, Chords.BIG_MAJOR, 0, Timbres.GUITAR, Variants.OPEN], [70, Chords.BIG_MAJOR, 1, Timbres.GUITAR, Variants.OPEN],\n   [71, Chords.BIG_MAJOR, 2, Timbres.GUITAR, Variants.OPEN], [72, Chords.BIG_MAJOR, 3, Timbres.GUITAR, Variants.OPEN],\n   [73, Chords.BIG_MAJOR, 0, Timbres.GUITAR, Variants.INVERSION], [74, Chords.BIG_MAJOR, 1, Timbres.GUITAR, Variants.INVERSION],\n   [75, Chords.BIG_MAJOR, 2, Timbres.GUITAR, Variants.INVERSION], [76, Chords.BIG_MAJOR, 3, Timbres.GUITAR, Variants.INVERSION],\n   [77, Chords.BIG_MAJOR, 0, Timbres.GUITAR, Variants.REGISTER], [78, Chords.BIG_MAJOR, 1, Timbres.GUITAR, Variants.REGISTER],\n   [79, Chords.BIG_MAJOR, 2, Timbres.GUITAR, Variants.REGISTER], [80, Chords.BIG_MAJOR, 3, Timbres.GUITAR, Variants.REGISTER],\n\n   [81, Chords.SMALL_MAJOR, 0, Timbres.PIANO, Variants.OPEN], [82, Chords.SMALL_MAJOR, 1, Timbres.PIANO, Variants.OPEN],\n   [83, Chords.SMALL_MAJOR, 2, Timbres.PIANO, Variants.OPEN], [84, Chords.SMALL_MAJOR, 3, Timbres.PIANO, Variants.OPEN],\n   [85, Chords.SMALL_MAJOR, 0, Timbres.PIANO, Variants.INVERSION], [86, Chords.SMALL_MAJOR, 1, Timbres.PIANO, Variants.INVERSION],\n   [87, Chords.SMALL_MAJOR, 2, Timbres.PIANO, Variants.INVERSION], [88, Chords.SMALL_MAJOR, 3, Timbres.PIANO, Variants.INVERSION],\n   [89, Chords.SMALL_MAJOR, 0, Timbres.PIANO, Variants.REGISTER], [90, Chords.SMALL_MAJOR, 1, Timbres.PIANO, Variants.REGISTER],\n   [91, Chords.SMALL_MAJOR, 2, Timbres.PIANO, Variants.REGISTER], [92, Chords.SMALL_MAJOR, 3, Timbres.PIANO, Variants.REGISTER],\n\n   [93, Chords.SMALL_MAJOR, 0, Timbres.GUITAR, Variants.OPEN], [94, Chords.SMALL_MAJOR, 1, Timbres.GUITAR, Variants.OPEN],\n   [95, Chords.SMALL_MAJOR, 2, Timbres.GUITAR, Variants.OPEN], [96, Chords.SMALL_MAJOR, 3, Timbres.GUITAR, Variants.OPEN],\n   [97, Chords.SMALL_MAJOR, 0, Timbres.GUITAR, Variants.INVERSION], [98, Chords.SMALL_MAJOR, 1, Timbres.GUITAR, Variants.INVERSION],\n   [99, Chords.SMALL_MAJOR, 2, Timbres.GUITAR, Variants.INVERSION], [100, Chords.SMALL_MAJOR, 3, Timbres.GUITAR, Variants.INVERSION],\n   [101, Chords.SMALL_MAJOR, 0, Timbres.GUITAR, Variants.REGISTER], [102, Chords.SMALL_MAJOR, 1, Timbres.GUITAR, Variants.REGISTER],\n   [103, Chords.SMALL_MAJOR, 2, Timbres.GUITAR, Variants.REGISTER], [104, Chords.SMALL_MAJOR, 3, Timbres.GUITAR, Variants.REGISTER],\n\n   [105, Chords.SMALL_MINOR, 0, Timbres.PIANO, Variants.OPEN], [106, Chords.SMALL_MINOR, 1, Timbres.PIANO, Variants.OPEN],\n   [107, Chords.SMALL_MINOR, 2, Timbres.PIANO, Variants.OPEN], [108, Chords.SMALL_MINOR, 3, Timbres.PIANO, Variants.OPEN],\n   [109, Chords.SMALL_MINOR, 0, Timbres.PIANO, Variants.INVERSION], [110, Chords.SMALL_MINOR, 1, Timbres.PIANO, Variants.INVERSION],\n   [111, Chords.SMALL_MINOR, 2, Timbres.PIANO, Variants.INVERSION], [112, Chords.SMALL_MINOR, 3, Timbres.PIANO, Variants.INVERSION],\n   [113, Chords.SMALL_MINOR, 0, Timbres.PIANO, Variants.REGISTER], [114, Chords.SMALL_MINOR, 1, Timbres.PIANO, Variants.REGISTER],\n   [115, Chords.SMALL_MINOR, 2, Timbres.PIANO, Variants.REGISTER], [116, Chords.SMALL_MINOR, 3, Timbres.PIANO, Variants.REGISTER],\n\n   [117, Chords.SMALL_MINOR, 0, Timbres.GUITAR, Variants.OPEN], [118, Chords.SMALL_MINOR, 1, Timbres.GUITAR, Variants.OPEN],\n   [119, Chords.SMALL_MINOR, 2, Timbres.GUITAR, Variants.OPEN], [120, Chords.SMALL_MINOR, 3, Timbres.GUITAR, Variants.OPEN],\n   [121, Chords.SMALL_MINOR, 0, Timbres.GUITAR, Variants.INVERSION], [122, Chords.SMALL_MINOR, 1, Timbres.GUITAR, Variants.INVERSION],\n   [123, Chords.SMALL_MINOR, 2, Timbres.GUITAR, Variants.INVERSION], [124, Chords.SMALL_MINOR, 3, Timbres.GUITAR, Variants.INVERSION],\n   [125, Chords.SMALL_MINOR, 0, Timbres.GUITAR, Variants.REGISTER], [126, Chords.SMALL_MINOR, 1, Timbres.GUITAR, Variants.REGISTER],\n   [127, Chords.SMALL_MINOR, 2, Timbres.GUITAR, Variants.REGISTER], [128, Chords.SMALL_MINOR, 3, Timbres.GUITAR, Variants.REGISTER],\n\n   [129, Chords.HALF_DIM, 0, Timbres.PIANO, Variants.OPEN], [130, Chords.HALF_DIM, 1, Timbres.PIANO, Variants.OPEN],\n   [131, Chords.HALF_DIM, 2, Timbres.PIANO, Variants.OPEN], [132, Chords.HALF_DIM, 3, Timbres.PIANO, Variants.OPEN],\n   [133, Chords.HALF_DIM, 0, Timbres.PIANO, Variants.INVERSION], [134, Chords.HALF_DIM, 1, Timbres.PIANO, Variants.INVERSION],\n   [135, Chords.HALF_DIM, 2, Timbres.PIANO, Variants.INVERSION], [136, Chords.HALF_DIM, 3, Timbres.PIANO, Variants.INVERSION],\n   [137, Chords.HALF_DIM, 0, Timbres.PIANO, Variants.REGISTER], [138, Chords.HALF_DIM, 1, Timbres.PIANO, Variants.REGISTER],\n   [139, Chords.HALF_DIM, 2, Timbres.PIANO, Variants.REGISTER], [140, Chords.HALF_DIM, 3, Timbres.PIANO, Variants.REGISTER],\n\n   [141, Chords.HALF_DIM, 0, Timbres.GUITAR, Variants.OPEN], [142, Chords.HALF_DIM, 1, Timbres.GUITAR, Variants.OPEN],\n   [143, Chords.HALF_DIM, 2, Timbres.GUITAR, Variants.OPEN], [144, Chords.HALF_DIM, 3, Timbres.GUITAR, Variants.OPEN],\n   [145, Chords.HALF_DIM, 0, Timbres.GUITAR, Variants.INVERSION], [146, Chords.HALF_DIM, 1, Timbres.GUITAR, Variants.INVERSION],\n   [147, Chords.HALF_DIM, 2, Timbres.GUITAR, Variants.INVERSION], [148, Chords.HALF_DIM, 3, Timbres.GUITAR, Variants.INVERSION],\n   [149, Chords.HALF_DIM, 0, Timbres.GUITAR, Variants.REGISTER], [150, Chords.HALF_DIM, 1, Timbres.GUITAR, Variants.REGISTER],\n   [151, Chords.HALF_DIM, 2, Timbres.GUITAR, Variants.REGISTER], [152, Chords.HALF_DIM, 3, Timbres.GUITAR, Variants.REGISTER],\n\n  ],\n  // Subtest C 153-168\n  [[153, Chords.BIG_MAJOR, 0, Timbres.SONG, 0], [154, Chords.SMALL_MAJOR, 0, Timbres.SONG, 0],\n   [155, Chords.SMALL_MINOR, 0, Timbres.SONG, 0], [156, Chords.HALF_DIM, 0, Timbres.SONG, 0],\n   [157, Chords.BIG_MAJOR, 1, Timbres.SONG, 0], [158, Chords.BIG_MAJOR, 2, Timbres.SONG, 0],\n   [159, Chords.BIG_MAJOR, 3, Timbres.SONG, 0], [160, Chords.SMALL_MAJOR, 1, Timbres.SONG, 0],\n   [161, Chords.SMALL_MAJOR, 2, Timbres.SONG, 0], [162, Chords.SMALL_MAJOR, 3, Timbres.SONG, 0],\n   [163, Chords.SMALL_MINOR, 1, Timbres.SONG, 0], [164, Chords.SMALL_MINOR, 2, Timbres.SONG, 0],\n   [165, Chords.SMALL_MINOR, 3, Timbres.SONG, 0], [166, Chords.HALF_DIM, 1, Timbres.SONG, 0],\n   [167, Chords.HALF_DIM, 3, Timbres.SONG, 0], [168, Chords.HALF_DIM, 2, Timbres.SONG, 0],\n  ],\n  // Subtest D\n  [[169, Chords.BIG_MAJOR, 0, Timbres.PIANO, 0], [170, Chords.BIG_MAJOR, 1, Timbres.PIANO, 0],\n   [171, Chords.BIG_MAJOR, 2, Timbres.PIANO, 0], [172, Chords.BIG_MAJOR, 3, Timbres.PIANO, 0],\n   [173, Chords.BIG_MAJOR, 0, Timbres.PIANO, 0], [174, Chords.BIG_MAJOR, 1, Timbres.PIANO, 0],\n   [175, Chords.BIG_MAJOR, 2, Timbres.PIANO, 0], [176, Chords.BIG_MAJOR, 3, Timbres.PIANO, 0],\n   [177, Chords.BIG_MAJOR, 0, Timbres.PIANO, 0], [178, Chords.BIG_MAJOR, 1, Timbres.PIANO, 0],\n   [179, Chords.BIG_MAJOR, 2, Timbres.PIANO, 0], [180, Chords.BIG_MAJOR, 3, Timbres.PIANO, 0],\n   [181, Chords.BIG_MAJOR, 0, Timbres.PIANO, 0], [182, Chords.BIG_MAJOR, 1, Timbres.PIANO, 0],\n   [183, Chords.BIG_MAJOR, 2, Timbres.PIANO, 0], [184, Chords.BIG_MAJOR, 3, Timbres.PIANO, 0],\n\n   [185, Chords.SMALL_MAJOR, 0, Timbres.PIANO, 0], [186, Chords.SMALL_MAJOR, 1, Timbres.PIANO, 0],\n   [187, Chords.SMALL_MAJOR, 2, Timbres.PIANO, 0], [188, Chords.SMALL_MAJOR, 3, Timbres.PIANO, 0],\n   [189, Chords.SMALL_MAJOR, 0, Timbres.PIANO, 0], [190, Chords.SMALL_MAJOR, 1, Timbres.PIANO, 0],\n   [191, Chords.SMALL_MAJOR, 2, Timbres.PIANO, 0], [192, Chords.SMALL_MAJOR, 3, Timbres.PIANO, 0],\n   [193, Chords.SMALL_MAJOR, 0, Timbres.PIANO, 0], [194, Chords.SMALL_MAJOR, 1, Timbres.PIANO, 0],\n   [195, Chords.SMALL_MAJOR, 2, Timbres.PIANO, 0], [196, Chords.SMALL_MAJOR, 3, Timbres.PIANO, 0],\n   [197, Chords.SMALL_MAJOR, 0, Timbres.PIANO, 0], [198, Chords.SMALL_MAJOR, 1, Timbres.PIANO, 0],\n   [199, Chords.SMALL_MAJOR, 2, Timbres.PIANO, 0], [200, Chords.SMALL_MAJOR, 3, Timbres.PIANO, 0],\n\n   [201, Chords.SMALL_MINOR, 0, Timbres.PIANO, 0], [202, Chords.SMALL_MINOR, 1, Timbres.PIANO, 0],\n   [203, Chords.SMALL_MINOR, 2, Timbres.PIANO, 0], [204, Chords.SMALL_MINOR, 3, Timbres.PIANO, 0],\n   [205, Chords.SMALL_MINOR, 0, Timbres.PIANO, 0], [206, Chords.SMALL_MINOR, 1, Timbres.PIANO, 0],\n   [207, Chords.SMALL_MINOR, 2, Timbres.PIANO, 0], [208, Chords.SMALL_MINOR, 3, Timbres.PIANO, 0],\n   [209, Chords.SMALL_MINOR, 0, Timbres.PIANO, 0], [210, Chords.SMALL_MINOR, 1, Timbres.PIANO, 0],\n   [211, Chords.SMALL_MINOR, 2, Timbres.PIANO, 0], [212, Chords.SMALL_MINOR, 3, Timbres.PIANO, 0],\n   [213, Chords.SMALL_MINOR, 0, Timbres.PIANO, 0], [214, Chords.SMALL_MINOR, 1, Timbres.PIANO, 0],\n   [215, Chords.SMALL_MINOR, 2, Timbres.PIANO, 0], [216, Chords.SMALL_MINOR, 3, Timbres.PIANO, 0],\n\n   [217, Chords.HALF_DIM, 0, Timbres.PIANO, 0], [218, Chords.HALF_DIM, 1, Timbres.PIANO, 0],\n   [219, Chords.HALF_DIM, 2, Timbres.PIANO, 0], [220, Chords.HALF_DIM, 3, Timbres.PIANO, 0],\n   [221, Chords.HALF_DIM, 0, Timbres.PIANO, 0], [222, Chords.HALF_DIM, 1, Timbres.PIANO, 0],\n   [223, Chords.HALF_DIM, 2, Timbres.PIANO, 0], [224, Chords.HALF_DIM, 3, Timbres.PIANO, 0],\n   [225, Chords.HALF_DIM, 0, Timbres.PIANO, 0], [226, Chords.HALF_DIM, 1, Timbres.PIANO, 0],\n   [227, Chords.HALF_DIM, 2, Timbres.PIANO, 0], [228, Chords.HALF_DIM, 3, Timbres.PIANO, 0],\n   [229, Chords.HALF_DIM, 0, Timbres.PIANO, 0], [230, Chords.HALF_DIM, 1, Timbres.PIANO, 0],\n   [231, Chords.HALF_DIM, 2, Timbres.PIANO, 0], [232, Chords.HALF_DIM, 3, Timbres.PIANO, 0],\n\n   // guitar\n   [233, Chords.BIG_MAJOR, 0, Timbres.GUITAR, 0], [234, Chords.BIG_MAJOR, 1, Timbres.GUITAR, 0],\n   [235, Chords.BIG_MAJOR, 2, Timbres.GUITAR, 0], [236, Chords.BIG_MAJOR, 3, Timbres.GUITAR, 0],\n   [237, Chords.BIG_MAJOR, 0, Timbres.GUITAR, 0], [238, Chords.BIG_MAJOR, 1, Timbres.GUITAR, 0],\n   [239, Chords.BIG_MAJOR, 2, Timbres.GUITAR, 0], [240, Chords.BIG_MAJOR, 3, Timbres.GUITAR, 0],\n   [241, Chords.BIG_MAJOR, 0, Timbres.GUITAR, 0], [242, Chords.BIG_MAJOR, 1, Timbres.GUITAR, 0],\n   [243, Chords.BIG_MAJOR, 2, Timbres.GUITAR, 0], [244, Chords.BIG_MAJOR, 3, Timbres.GUITAR, 0],\n   [245, Chords.BIG_MAJOR, 0, Timbres.GUITAR, 0], [246, Chords.BIG_MAJOR, 1, Timbres.GUITAR, 0],\n   [247, Chords.BIG_MAJOR, 2, Timbres.GUITAR, 0], [248, Chords.BIG_MAJOR, 3, Timbres.GUITAR, 0],\n\n   [249, Chords.SMALL_MAJOR, 0, Timbres.GUITAR, 0], [250, Chords.SMALL_MAJOR, 1, Timbres.GUITAR, 0],\n   [251, Chords.SMALL_MAJOR, 2, Timbres.GUITAR, 0], [252, Chords.SMALL_MAJOR, 3, Timbres.GUITAR, 0],\n   [253, Chords.SMALL_MAJOR, 0, Timbres.GUITAR, 0], [254, Chords.SMALL_MAJOR, 1, Timbres.GUITAR, 0],\n   [255, Chords.SMALL_MAJOR, 2, Timbres.GUITAR, 0], [256, Chords.SMALL_MAJOR, 3, Timbres.GUITAR, 0],\n   [257, Chords.SMALL_MAJOR, 0, Timbres.GUITAR, 0], [258, Chords.SMALL_MAJOR, 1, Timbres.GUITAR, 0],\n   [259, Chords.SMALL_MAJOR, 2, Timbres.GUITAR, 0], [260, Chords.SMALL_MAJOR, 3, Timbres.GUITAR, 0],\n   [261, Chords.SMALL_MAJOR, 0, Timbres.GUITAR, 0], [262, Chords.SMALL_MAJOR, 1, Timbres.GUITAR, 0],\n   [263, Chords.SMALL_MAJOR, 2, Timbres.GUITAR, 0], [264, Chords.SMALL_MAJOR, 3, Timbres.GUITAR, 0],\n\n   [265, Chords.SMALL_MINOR, 0, Timbres.GUITAR, 0], [266, Chords.SMALL_MINOR, 1, Timbres.GUITAR, 0],\n   [267, Chords.SMALL_MINOR, 2, Timbres.GUITAR, 0], [268, Chords.SMALL_MINOR, 3, Timbres.GUITAR, 0],\n   [269, Chords.SMALL_MINOR, 0, Timbres.GUITAR, 0], [270, Chords.SMALL_MINOR, 1, Timbres.GUITAR, 0],\n   [271, Chords.SMALL_MINOR, 2, Timbres.GUITAR, 0], [272, Chords.SMALL_MINOR, 3, Timbres.GUITAR, 0],\n   [273, Chords.SMALL_MINOR, 0, Timbres.GUITAR, 0], [274, Chords.SMALL_MINOR, 1, Timbres.GUITAR, 0],\n   [275, Chords.SMALL_MINOR, 2, Timbres.GUITAR, 0], [276, Chords.SMALL_MINOR, 3, Timbres.GUITAR, 0],\n   [277, Chords.SMALL_MINOR, 0, Timbres.GUITAR, 0], [278, Chords.SMALL_MINOR, 1, Timbres.GUITAR, 0],\n   [279, Chords.SMALL_MINOR, 2, Timbres.GUITAR, 0], [280, Chords.SMALL_MINOR, 3, Timbres.GUITAR, 0],\n\n   [281, Chords.HALF_DIM, 0, Timbres.GUITAR, 0], [282, Chords.HALF_DIM, 1, Timbres.GUITAR, 0],\n   [283, Chords.HALF_DIM, 2, Timbres.GUITAR, 0], [284, Chords.HALF_DIM, 3, Timbres.GUITAR, 0],\n   [285, Chords.HALF_DIM, 0, Timbres.GUITAR, 0], [286, Chords.HALF_DIM, 1, Timbres.GUITAR, 0],\n   [287, Chords.HALF_DIM, 2, Timbres.GUITAR, 0], [288, Chords.HALF_DIM, 3, Timbres.GUITAR, 0],\n   [289, Chords.HALF_DIM, 0, Timbres.GUITAR, 0], [290, Chords.HALF_DIM, 1, Timbres.GUITAR, 0],\n   [291, Chords.HALF_DIM, 2, Timbres.GUITAR, 0], [292, Chords.HALF_DIM, 3, Timbres.GUITAR, 0],\n   [293, Chords.HALF_DIM, 0, Timbres.GUITAR, 0], [294, Chords.HALF_DIM, 1, Timbres.GUITAR, 0],\n   [295, Chords.HALF_DIM, 2, Timbres.GUITAR, 0], [296, Chords.HALF_DIM, 3, Timbres.GUITAR, 0],\n  ],\n];\n\nexport const test_b_indexing = (chord, transposition, timbre, variant) => {\n  /*\n    BIG_MAJOR>>\n      PIANO:   0-11\n      GUITAR: 12-23\n    SMALL_MAJOR>>\n      PIANO:  24\n      GUITAR: 36\n    SMALL_MINOR>>\n      PIANO:  48\n      GUITAR: 60\n    HALF_DIM>>\n      PIANO:  72\n      GUITAR: 84-95\n  */\n\n  let idx = 0;\n  if (timbre === Timbres.PIANO) idx += 0;\n  else if (timbre === Timbres.GUITAR) idx += 12;\n\n  switch (chord) {\n    case Chords.BIG_MAJOR: idx += 0; break;\n    case Chords.SMALL_MAJOR: idx += 24; break;\n    case Chords.SMALL_MINOR: idx += 48; break;\n    case Chords.HALF_DIM: idx += 72; break;\n  }\n\n  idx += (variant-1)*4 + transposition;\n  return idx;\n}\n\nexport const test_d_indexing = (chord, transposition, timbre, type) => {\n  /*\n  PIANO>\n    BIG_MAJOR:    0-15\n    SMALL_MAJOR: 16-31\n    SMALL_MINOR: 32-47\n    HALF_DIM:    48-63\n  GUITAR>\n    BIG_MAJOR:   64-79\n    SMALL_MAJOR: 80-95\n    SMALL_MINOR: 96-111\n    HALF_DIM:   112-127  \n  */\n\n  let idx = 0;\n  if (timbre === Timbres.PIANO) idx += 0;\n  else if (timbre === Timbres.GUITAR) idx += 64;\n\n  switch (chord) {\n    case Chords.BIG_MAJOR: idx += 0; break;\n    case Chords.SMALL_MAJOR: idx += 16; break;\n    case Chords.SMALL_MINOR: idx += 32; break;\n    case Chords.HALF_DIM: idx += 48; break;\n  }\n  return idx += type*4 + transposition;\n}\n","import React from 'react';\nimport { LoadingScreen, ButtonTable, ContinueButton, InfoScreen } from '../ui.js';\nimport { Chords, Timbres, Variants } from '../defs.js';\nimport { audio_mapping, test_d_indexing, test_b_indexing } from './audio_mapping.js';\nimport ls from 'local-storage';\nimport { randomInt, randomElement, shuffleArray, randomSequence } from '../randomize.js';\nimport { AudioController } from '../audio_controller.js';\n\nconst SubtestInfo = ({test_num, next}) => {\n  let info;\n  switch (test_num) {\n  case 0:\n  case 1:\n    info = (\n      <div>\n        <p>    .     ,    .</p>\n      </div>\n    );\n    break;\n  case 2:\n    info = (\n      <div>\n        <p>       .         .      .         </p>\n      </div>\n    );\n    break;\n  case 3:\n    info = (\n      <div>\n        <p>     (  )     .        ,      .</p>\n      </div>\n    );\n    break;\n  }\n  return <InfoScreen info={info} next={next} />;\n};\n\nclass TestBlock extends React.Component {\n  state = {\n    trial_idx: 0,\n    show_info: true,\n    loading: true,\n  }\n\n  constructor({test_num, test_idx, chord_button_labels, next, data}) {\n    super();\n    this.test_num = test_num;\n    this.test_idx = test_idx;\n    this.chord_button_labels = chord_button_labels;\n    this.next = next;\n    this.data = data;\n    this.ls_prefix = \"test_subtests_testblock\" + test_num + \"_\";\n\n    this.test_data = audio_mapping[test_num];\n\n    const cont_sequence = ls.get(this.ls_prefix + \"sequence\");\n    if (cont_sequence !== null) {\n      this.sequence = cont_sequence;\n\n      const cont_trial_idx = ls.get(this.ls_prefix + \"trial_idx\");\n      if (cont_trial_idx !== null)\n        this.state.trial_idx = cont_trial_idx;\n\n      const cont_show_info = ls.get(this.ls_prefix + \"show_info\");\n      if (cont_show_info !== null)\n        this.state.show_info = cont_show_info;\n    }\n    else {       \n      this.sequence = this.make_test_sequence(test_num);\n      ls.set(this.ls_prefix + \"sequence\", this.sequence);\n      ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx);\n      ls.set(this.ls_prefix + \"show_info\", this.state.show_info);\n    }\n\n    const that = this;\n    const doneLoadingAudio = () => {\n      that.setState({loading: false});\n      \n    };\n\n    const donePlaying = () => {\n    };\n\n    this.audioController = new AudioController(this.sequence.map(d => d[0]), doneLoadingAudio, donePlaying);\n\n    console.log(\"Starting subtest \" + this.test_num + \". sequence:\");\n    console.log(this.sequence);\n\n    if (!this.state.show_info) {\n      this.audioController.play(this.sequence[this.state.trial_idx][0]);\n      this.response_start = new Date();\n    }\n  }\n\n  make_test_sequence = (test_num) => {\n    switch (test_num) {\n    case 0:\n      return shuffleArray(this.test_data);      \n    case 1:      \n      return this.make_subtest_b_seq();\n    case 2:\n      return randomSequence(this.test_data, 32);\n    case 3:       \n      return this.make_subtest_d_seq();\n    default:\n      return null;\n    }\n  }\n  \n  pick_unique_two = arr => {\n    const fst_idx = randomInt(0, arr.length-1);\n    const fst = arr[fst_idx]\n    const snd = randomElement(arr.slice(0, fst_idx).concat(arr.slice(fst_idx+1, arr.length)));\n    return [fst, snd];\n  }\n\n  make_subtest_b_seq = () => {\n    let sequence = [];\n    for (let c in Chords) {\n      for (let trnsp = 0; trnsp < 4; trnsp++) {\n        const [var1, var2] = this.pick_unique_two([1,2,3]);\n        sequence.push(this.test_data[test_b_indexing(Chords[c], trnsp, randomInt(0, 1), var1)]);\n        sequence.push(this.test_data[test_b_indexing(Chords[c], trnsp, randomInt(0, 1), var2)]);        \n      }\n    }\n    return shuffleArray(sequence);\n  }\n\n  make_subtest_d_seq = () => {\n    let sequence = [];\n    for (let c in Chords) {\n      for (let type=0; type<4; type++) {\n        const [trnsp1, trnsp2] = this.pick_unique_two([0,1,2,3]);\n        sequence.push(this.test_data[test_d_indexing(Chords[c], trnsp1, Timbres.PIANO, type)]);\n        sequence.push(this.test_data[test_d_indexing(Chords[c], trnsp2, Timbres.GUITAR, type)]);                                     \n      }\n    }\n    return shuffleArray(sequence);\n  }\n  \n  get_transposition_play_count = () => { \n    const idx = this.state.trial_idx;\n    const trial = this.sequence[idx];\n    return this.sequence.slice(0, idx)\n      .filter(t => t[1] === trial[1] && t[2] === trial[2]).length + 1;\n  }\n\n  startTrials = () => {\n    this.setState({show_info: false});\n    ls.set(this.ls_prefix + \"show_info\", false);\n\n    this.audioController.play(this.sequence[this.state.trial_idx][0]);\n    this.response_start = new Date();\n  }\n\n  nextTrial = (answer) => {\n    const { trial_idx } = this.state;\n\n    // collect data\n    const trial_info = this.sequence[trial_idx];\n    const td = {\n      time: new Date().toString(),\n      subtest: this.test_num + 1,\n      variant: trial_info[4],\n      audio_index: trial_info[0],\n      chord_number: 32 * this.test_idx + this.state.trial_idx + 1,\n      chord_type: trial_info[1],\n      transposition: trial_info[2] + 1,\n      transposition_play_count: this.get_transposition_play_count(),\n      selected_chord_type: answer,\n      correct: answer === trial_info[1],\n      response_time: new Date() - this.response_start,\n    };\n\n    this.data.trials.push(td);\n    ls.set(\"test_data\", this.data);\n    \n    console.log(\"answer is: \" + answer);\n\n    this.audioController.stop(this.sequence[trial_idx][0]);\n\n    if (trial_idx + 1 >= this.sequence.length) {\n      this.next();\n    }\n    else {\n      this.setState({trial_idx: trial_idx + 1});      \n      ls.set(this.ls_prefix + \"trial_idx\", trial_idx + 1);\n\n      this.audioController.play(this.sequence[trial_idx+1][0]);\n      this.response_start = new Date();\n    }\n  }\n\n  render() {\n    const { trial_idx, show_info, loading } = this.state;\n    if (loading)\n      return <LoadingScreen />;\n    else if (show_info) {\n      return <SubtestInfo test_num={this.test_num} next={this.startTrials} />;\n    }\n    else {\n      return (\n        <div className=\"container\">\n          <ButtonTable labels={this.chord_button_labels} values={this.chord_button_labels} next={this.nextTrial} key={trial_idx} />\n        </div>\n      );\n    }\n  }\n}\n\nexport class SubtestsBlock extends React.Component {\n  ls_prefix = \"test_subtests_\";\n\n  subtests_count = 4;\n\n  state = {\n    test_idx: 0,\n  }\n\n  nextTest = () => {\n    const { test_idx } = this.state;\n    if (test_idx + 1 >= this.subtests_count) \n      this.next();\n    else {\n      this.setState({ test_idx: test_idx + 1 });\n      ls.set(this.ls_prefix + \"test_idx\", test_idx + 1);\n    }\n  }\n\n  constructor({data, next, button_labels}) {\n    super();\n    this.data = data;\n    this.next = next;\n    this.chord_button_labels = button_labels;\n\n    const cont_test_order = ls.get(this.ls_prefix + \"test_order\");\n    if (cont_test_order !== null) {\n      this.test_order = cont_test_order;\n      \n      const cont_test_idx = ls.get(this.ls_prefix + \"test_idx\");\n      if (cont_test_idx) this.state.test_idx = cont_test_idx;\n    }\n    else {\n      this.test_order = shuffleArray([0, 1, 2, 3]);\n\n      ls.set(this.ls_prefix + \"test_order\", this.test_order);\n      ls.set(this.ls_prefix + \"test_idx\", this.state.test_idx);\n    }\n\n    console.log(\"Test order: \" + this.test_order);    \n  }\n\n  render() {\n    const { test_idx } = this.state;\n    const test_num = this.test_order[test_idx];\n    \n    return <TestBlock test_num={test_num} test_idx={test_idx}\n                      chord_button_labels={this.chord_button_labels} \n                      next={this.nextTest} \n                      data={this.data}\n                      key={test_num} />;\n  }\n}\n","import React from 'react';\nimport { ContinueButton } from '../ui.js';\nimport ls from 'local-storage';\n\nexport class PersonalInfoScreen extends React.Component {\n  constructor({data, next}) {\n    super();\n    this.data = data;\n    this.next = next;\n  }\n\n  saveData = () => {\n    const age = document.getElementById('age').value;\n    if (!/^(0|[1-9]\\d*)$/.test(age)) {\n      alert(\"    .\");\n      return;\n    }\n\n    const genderMaleChecked = document.getElementById('male').checked;\n    const genderFemaleChecked = document.getElementById('female').checked;\n    if (!genderMaleChecked && !genderFemaleChecked) {\n      alert(\"  .\");\n      return;\n    }\n    const gender = genderMaleChecked ? 2 : 1;\n\n    const musical_background = document.getElementById('musical_background').value;\n\n    const big_maj_recognition = document.getElementById('big_maj_recognition').value;\n    const small_maj_recognition = document.getElementById('small_maj_recognition').value;\n    const small_min_recognition = document.getElementById('small_min_recognition').value;\n    const half_dim_recognition = document.getElementById('half_dim_recognition').value;\n    const hwcomputer = document.getElementById('hwcomputer').value;\n    const hwdisplay = document.getElementById('hwdisplay').value;\n    const hwmouse = document.getElementById('hwmouse').value;\n    const hwheadphones = document.getElementById('hwheadphones').value;\n    if (big_maj_recognition.length===0 || small_maj_recognition.length===0 ||\n        small_min_recognition.length===0 || half_dim_recognition.length===0 ||\n        hwcomputer.length===0 || hwdisplay.length===0 || \n        hwmouse.length===0 || hwheadphones.length===0) {\n      alert(\"    .\");\n      return;\n    }\n    this.data.trials.push({\n      time: new Date().toString(),\n      subtest: 5,\n      age: age,\n      gender: gender,\n      musical_background: musical_background,\n      big_maj_recognition: big_maj_recognition,\n      small_maj_recognition: small_maj_recognition,\n      small_min_recognition: small_min_recognition,\n      half_dim_recognition: half_dim_recognition,\n      computer: hwcomputer,\n      display: hwdisplay,\n      mouse: hwmouse,\n      headphones: hwheadphones,\n    });\n    ls.set(\"test_data\", this.data);\n    this.next();\n  }\n\n  render() { \n    return (\n      <div className=\"container\">\n        <div className=\"row\">\n          <div className=\"col-sm-8 offset-sm-2 personal-info-form\">\n            <p>  :</p>\n            <label htmlFor=\"age\">:</label>\n            <input type=\"text\" id=\"age\" name=\"age\" maxLength=\"2\"/>\n            <br/>\n            <label htmlFor=\"gender\">:</label>\n            <label htmlFor=\"male\"></label>\n            <input type=\"radio\" id=\"male\" name=\"gender\" value=\"male\"/>\n            <label htmlFor=\"female\"></label>\n            <input type=\"radio\" id=\"female\" name=\"gender\" value=\"female\"/>\n            <br/>\n            <label htmlFor=\"musical_background\">  :</label>\n            <select id=\"musical_background\" name=\"musical_background\">\n              <option value=\"1\"></option>\n              <option value=\"2\">  </option>\n              <option value=\"3\">  </option>\n            </select>\n            <br/>\n            <label htmlFor=\"big_maj_recognition\">      \"' \"?</label>\n            <textarea id=\"big_maj_recognition\" rows=\"2\" cols=\"50\"/>\n            <label htmlFor=\"small_maj_recognition\">      \"' \"?</label>\n            <textarea id=\"small_maj_recognition\" rows=\"2\" cols=\"50\"/>\n            <label htmlFor=\"small_min_recognition\">      \" \"?</label>\n            <textarea id=\"small_min_recognition\" rows=\"2\" cols=\"50\"/>\n            <label htmlFor=\"half_dim_recognition\">      \" \"?</label>\n            <textarea id=\"half_dim_recognition\" rows=\"2\" cols=\"50\"/>            \n            <p>         .         .</p>\n            <label htmlFor=\"hwcomputer\">:</label><br/>\n            <textarea id=\"hwcomputer\" rows=\"2\" cols=\"50\"/><br/>\n            <label htmlFor=\"display\"> :</label><br/>\n            <textarea id=\"hwdisplay\" rows=\"2\" cols=\"50\"/><br/>\n            <label htmlFor=\"hwmouse\">:</label><br/>\n            <textarea id=\"hwmouse\" rows=\"2\" cols=\"50\"/><br/>\n            <label htmlFor=\"hwheadphones\">:</label><br/>\n            <textarea id=\"hwheadphones\" rows=\"2\" cols=\"50\"/><br/>\n\n          </div>\n        </div>\n        <div className=\"row\">\n          <div className=\"col-sm-8 offset-sm-2 text-center\">\n            <ContinueButton next={this.saveData} />\n          </div>\n        </div>\n        <div className=\"row\">&nbsp;</div>\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport '../Experiment.css';\nimport './TestExperiment.css';\nimport { InfoScreen, ContinueButton, ErrorScreen, LoadingScreen } from '../ui.js';\nimport { Chords } from '../defs.js';\nimport { PretestBlock } from './pretest.js';\nimport { SubtestsBlock } from './subtests.js';\nimport { PersonalInfoScreen } from './personal_info.js';\nimport ls from 'local-storage';\nimport { does_user_sheet_exists } from '../sessions.js';\nimport gs from '../spreadsheet_io.js';\nimport { shuffleArray } from '../randomize.js';\n\nconst LoginScreen = ({next, data}) => {\n  const handleContinue = () => {\n    data.id = document.getElementById('id_input').value;\n    next();\n  };\n\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-md-8 offset-md-2 infotext\">\n          <p>   -30 .</p>\n          <p>   .</p>\n          <p>   .      .</p>\n          <p> ,   ,     ()   .</p>\n          <p>   ,       ,   \"\".</p>          \n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col\"></div>\n        <div className=\"col text-center\">\n          <br/>\n          <label>\": <input type=\"text\" id=\"id_input\"/><br/></label>\n          <p hidden>\"</p>\n          <br/>\n          <ContinueButton next={handleContinue} disabled={false} />            \n        </div>\n        <div className=\"col\"></div>\n      </div>      \n    </div>\n  );\n};\n\nconst FinishScreen = ({data, done_saving}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"col-md-8 offset-md-2 finish-screen text-center\">\n        <h1> !</h1>\n        <p>{done_saving ? \"  !\" : \"   ...\"}</p>\n      </div>\n    </div>\n  );\n};\n\nconst TestInfo = () => {\n  return (\n    <div>\n      <p>      : ' , ' ,  ,  .</p>\n      <p>,     :      ,         .</p>\n      <p>    ,   .</p>\n      <p>         .             .        .</p>\n      <p>        .</p>\n      <p>!</p>\n    </div>\n  );\n};\n\nclass TestExperiment extends React.Component {\n  conn = { // read/write connection details for google spreadsheet.\n    spreadsheet_id: '1D2s3D13ldvchzueCFWTkvH8kzhNBEMZzizPnjGQnhMY',\n    api_key: 'AIzaSyDHFHbGy_GhEt1Q4FW61YYEX2jk3hZcSoQ',\n    write_url: 'https://script.google.com/macros/s/AKfycbxv6Uc9VsHlKI6SMe6YmH-MELryrJYvYg-uQnGFhyMF2X7zyC-O/exec',\n  }\n\n  ls_prefix = \"test_\";\n  sheet_suffix = \"-test\";\n\n  steps = {\n    LOGIN: 1,\n    INFO: 2,\n    PRETEST: 3,\n    SUB_TESTS: 4,\n    PERSONAL_INFO: 5,\n    FINISH: 6,\n  }\n\n  state = {\n    step: 1,\n    error: null,\n    loading: false,\n  }\n\n  data = {\n    id: undefined,\n    trials: [],\n  }\n\n  chord_button_labels = shuffleArray([Chords.BIG_MAJOR, Chords.SMALL_MAJOR, Chords.SMALL_MINOR, Chords.HALF_DIM]);\n\n  nextStep = () => {\n    const { step } = this.state;\n    const new_step = step + 1;\n\n    if (step > 1)\n      ls.set(this.ls_prefix + \"step\", new_step);\n\n    const altered_step = this.stepWillChange(step, new_step);\n    this.setState({step: altered_step || new_step});\n    this.stepChanged(altered_step || new_step);\n  }\n\n  stepWillChange = (step, new_step) => {\n    if (step === this.steps.LOGIN) {\n      this.setState({loading: true});\n      does_user_sheet_exists(this.conn, this.data.id + this.sheet_suffix)\n        .then(sheet_exists => {\n          if (sheet_exists) {\n            this.setState({loading:false});\n            ls.set(this.ls_prefix + \"data\", this.data);\n          }\n          else {\n            this.setState({error: \"    \" + this.data.id + \"   .\",\n                           loading: false});\n          }\n\n        })\n        .catch(err => {\n          this.setState({error: \"  .      . \" + err});\n        });\n\n      // try to recover from local storage\n      const cont_data = ls.get(this.ls_prefix + \"data\");\n      if (cont_data && cont_data.id === this.data.id) {\n        console.log(\"Loading from local storage...\");\n        \n        this.data = cont_data;\n        \n        const cont_button_labels = ls.get(this.ls_prefix + \"chord_button_labels\");\n        if (cont_button_labels)\n          this.chord_button_labels = cont_button_labels;\n\n        const cont_step = ls.get(this.ls_prefix + \"step\");\n        if (cont_step) \n          return cont_step;\n      }\n      else {\n        console.log(\"clearing local storage\");\n        ls.clear();\n        ls.set(this.ls_prefix + \"chord_button_labels\", this.chord_button_labels);\n      }\n    }\n  }\n\n  stepChanged = (step) => {\n    if (step === this.steps.FINISH) {\n      this.data.end_time = new Date().toString();\n      console.log(\"Saving data...\");\n      console.log(this.data.trials);\n\n      this.data.trials.forEach(t => {\n        t.id = this.data.id;\n        t.start_time = this.data.start_time;\n        t.end_time = this.data.end_time;\n      });\n      \n      const that = this;\n      gs.write(this.conn, \"\" + this.data.id + this.sheet_suffix, this.data.trials)\n        .then(res => { \n          that.setState({done_saving: true});\n          ls.clear(); \n        })\n        .catch(this.dataSaveError);\n    }\n  }\n\n  dataSaveError(response) {\n    alert(\"Error while saving data: \" + response);\n  }\n\n  componentDidMount() {\n    this.data.start_time = new Date().toString();\n  }\n\n  render() {\n    const {step} = this.state;\n    console.log(\"rendering step \" + step);\n\n    if (this.state.error) {\n      return <ErrorScreen error={this.state.error} />;\n    } \n    else if (this.state.loading) {\n      return <LoadingScreen />;\n    } \n    else {\n      switch(step) {\n      case this.steps.LOGIN: \n        return <LoginScreen next={this.nextStep} data={this.data} />;\n      case this.steps.INFO:\n        const test_info = <TestInfo />;\n        return <InfoScreen info={test_info} next={this.nextStep} />;\n      case this.steps.PRETEST:\n        return <PretestBlock next={this.nextStep} button_labels={this.chord_button_labels} data={this.data} />;\n      case this.steps.SUB_TESTS:\n        return <SubtestsBlock next={this.nextStep} data={this.data} button_labels={this.chord_button_labels} />;\n      case this.steps.PERSONAL_INFO:\n        return <PersonalInfoScreen next={this.nextStep} data={this.data} />;\n      case this.steps.FINISH:\n        return <FinishScreen done_saving={this.state.done_saving} />;\n      default:\n        return <div>???</div>;\n      }\n    }\n  }\n}\n\nexport default TestExperiment;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport TrainingExperiment from './training_experiment/TrainingExperiment.js';\nimport TestExperiment from './test_experiment/TestExperiment.js';\nimport * as serviceWorker from './serviceWorker';\nimport { Switch, HashRouter, Route } from \"react-router-dom\";\n\nclass App extends React.Component {\n  render() {\n    return (\n      <HashRouter>\n        <Switch>\n          <Route exact path=\"/\"><TrainingExperiment/></Route>\n          <Route path=\"/test\"><TestExperiment/></Route>\n          <Route>  !</Route>\n        </Switch>\n      </HashRouter>\n    );\n  }\n}\n\nReactDOM.render(<App/>, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}