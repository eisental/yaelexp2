{"version":3,"sources":["defs.js","training_experiment/info.js","audio_controller.js","ui.js","randomize.js","training_experiment/lesson_block.js","training_experiment/training_block.js","spreadsheet_io.js","sessions.js","training_experiment/TrainingExperiment.js","test_experiment/pretest.js","test_experiment/subtests.js","test_experiment/personal_info.js","test_experiment/TestExperiment.js","serviceWorker.js","index.js"],"names":["LessonType","MUSICAL_PIECES","TONAL_CONTEXT","AUTOMATIC","Chords","BIG_MAJOR","SMALL_MAJOR","SMALL_MINOR","HALF_DIM","Timbres","StaticImages","Strings","SheetNames","musical_pieces_data","IntroText","className","InfoText","lesson_type","href","imgSrc","name","PretestInfo","audioIdx2File","idx","AudioController","srcs","onDoneLoading","onAudioEnded","this","players","ids2players","players2ids","id","playerIdx","length","p","Audio","addEventListener","e","audioLoaded","push","loadCount","player","audio_id","play","pause","currentTime","LoadingScreen","ErrorScreen","error","InfoScreen","info","next","disabled","Button","label","onClick","type","ContinueButton","ButtonTable","labels","values","gen_button","btn_idx","shuffleArray","arr","map","a","Math","random","sort","b","randomSequence","items","count","ln","i","repeatArray","lesson_data","musical_pieces","tonal_context","automatic","NameOfChord","props","chordName","description","SongWithoutChords","songData","src","alt","LessonPart","part","session","state","trial_idx","done_playing","done_loading","trials_per_part","part_data","ls_prefix","continued","sequence","ls","get","set","console","log","that","audioController","d","setState","screen","button","React","Component","InfoBeforeLessonPartA","InfoBeforeLessonPartB","InfoBeforeLessonPartC","LessonBlock","data","steps","INFO_A","PART_A","INFO_B","PART_B","INFO_C","PART_C","DONE","step","nextStep","key","training_data","correction_data","TrainingInfo","InfoBeforeTrainingPartB","InfoBeforeTrainingPartC","SuccessfulIdentification","width","height","FailedIdentification","appendix","shouldShowCorrect","shouldShowButton","correctChord","text","SongWithChords","chord_buttons","chord","ChordSelection","with_song_names","TrainingPart","show_feedback","answer","correction_idxs","corrections_for_part","concat","response_start","Date","fail_show_correct","done_playing_correct_feedback","correct_audio_idx","trial","slice","filter","t","trial_data","chord_name","transposition","nextTrial","processAnswer","correct","td","time","toString","audio_index","chord_number","chord_type","transposition_play_count","get_transposition_play_count","selected_chord_type","response_time","trials","stop","selected_audio_idx","song_data","TrainingBlock","read_url","parse_sheet_list","sheetNames","sheets","forEach","sheet","properties","title","gs","read","conn","sheetName","range","fetch","spreadsheet_id","api_key","write","Array","isArray","url","write_url","headers","method","mode","body","JSON","stringify","list_sheets","then","res","json","SessionEvent","SESSION_START","SESSION_CONTINUED","SESSION_END","parseSessions","sessions","session_event","number","event","writeSessionEvent","on_error","request_data","Object","assign","catch","readLessonType","response","row","parseInt","was_last_session_today","last_session","last_time","setHours","getHours","now","getDate","does_user_sheet_exists","user_id","includes","MAX_NUMBER_OF_SESSIONS","IntroScreen","hidden","document","getElementById","value","FinishScreen","done_saving","session_number","remaining","PretestBlock","practice_trials_count","test_trails_count","button_idxs","practice_sequence","test_sequence","target_btn","selection","TrainingExperiment","INTRO","INFO","PRETEST_INFO","PRETEST","LESSON","TRAINING","FINISH","is_loading_session","did_check_user_registered","max_sessions_reached","session_done_for_today","user_unregistered","did_load_registration_list","did_load_lesson_type","undefined","maybe_start_session","previous_sessions","clear","err","alert","last_session_number","continued_session","sessionEventError","continued_data","continued_step","stepChanged","new_step","stepWillChange","sheet_exists","sessionDataLoadError","end_time","start_time","dataSaveError","sessionDataLoaded","session_data","pretest_info","getScreenForStep","PretestTrial","button_labels","trial_chord","ContinueScreen","on_keep_going","keep_going","trials_count","keepGoing","cont_trial_idx","SubtestsBlock","PersonalInfoScreen","saveData","age","test","genderMaleChecked","checked","genderFemaleChecked","gender","musical_background","big_maj_recognition","small_maj_recognition","small_min_recognition","half_dim_recognition","htmlFor","maxlength","rows","cols","LoginScreen","TestInfo","TestExperiment","sheet_suffix","LOGIN","SUB_TESTS","PERSONAL_INFO","loading","chord_button_labels","altered_step","cont_step","cont_data","test_info","Boolean","window","location","hostname","match","App","exact","path","ReactDOM","render","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.8575e719.chunk.js","sourcesContent":["export const LessonType = {\n  MUSICAL_PIECES: 0,\n  TONAL_CONTEXT: 1,\n  AUTOMATIC: 2,\n};\n\nexport const Chords = {\n  BIG_MAJOR: \"מז'ור גדול\",\n  SMALL_MAJOR: \"מז'ור קטן\",\n  SMALL_MINOR: \"מינור קטן\",\n  HALF_DIM:\"חצי מוקטן\"\n}\n\nexport const Timbres = {\n  PIANO: 0,\n  GUITAR: 1,\n}\n\nexport const StaticImages = {\n  happySmiley: \"static_images/happySmiley.jpg\",\n  sadSmiley: \"static_images/sadSmiley.png\",\n}\n\nexport const Strings = {\n  continue_text: \"המשך\",\n  success_identification: \"בחרת באקורד הנכון\",\n  failure_identification: \"בחרת באקורד הלא נכון\",\n  how_it_sounds: \"כך הוא נשמע\",\n};\n\nexport const SheetNames = {\n  TRAINING_SESSIONS: \"TrainingSessions\",\n  LESSON_TYPES: \"LessonTypes\",\n}\n\n// For MUSICAL_CONTEXT lessons. A mapping of chord name to the image and song name that goes with it.\nexport let musical_pieces_data = {};\nmusical_pieces_data[Chords.BIG_MAJOR] = {\n  imgSrc: \"song_images/song1.png\",\n  name: \"Imagine\",\n};\nmusical_pieces_data[Chords.SMALL_MAJOR] = {\n  imgSrc: \"song_images/song2.png\",\n  name: \"הליכה לקיסריה\"\n};\nmusical_pieces_data[Chords.SMALL_MINOR] = {\n  imgSrc: \"song_images/song3.png\",\n  name: \"Rocket man\"\n};\nmusical_pieces_data[Chords.HALF_DIM] = {\n  imgSrc: \"song_images/song4.png\",\n  name: \"ברית עולם\"\n};\n","import React from 'react';\nimport { LessonType } from '../defs.js';\n\nexport function IntroText() {\n  return (\n    <div className = \"IntroText\">\n      <p>\n      לפניכם שיעור של 35 דקות. \n      לא ניתן לצאת במהלכו.\n      העבודה על הניסוי מחייבת חיבור אינטרנטי. עבודה ללא חיבור אינטרנטי תיפסל מהניסוי. \n      כמו כן, אנא הצטיידו באוזניות, לאחר שווידאתם עם הנסיינית (יעל) שהן איכותיות מספיק.\n      </p>\n      <p>\n      עליכם להפעיל את התוכנה פעם אחת בכל יום במשך חמישה ימים. לא תוכלו להפעילה יותר מפעם אחת ביום, אך עליכם לדאוג להפעילה בכל יום, ולסיים בכל הפעלה את ההדגמות והתרגילים (נתוני ההפעלה וההשתתפות יישלחו לנסיינית. התשלום על הניסוי מותנה בהקפדה על התנאים).\n      את התוכנה יש להפעיל בכל חמשת הפעמים באמצעות אותה חומרה - אותו מחשב, אותו מסך, ואותו עכבר מחשב. במסגרת המבחן ביום השישי תתבקשו לפרט באיזו חומרה השתמשתם, אז אנא הקפידו על כך.\n      התחלת התוכנה מותנית בקביעת פגישה עם הנסיינית ליום השביעי. מי שטרם קבע פגישה, לא יכול להתחיל את העבודה בתוכנה.\n      </p>\n      <p>\n      אם ברצונכם להפעיל את התוכנה כעת, הכניסו את מספר תעודת הזהות שלכם ולחצו על המשך.\n      </p>\n    </div>);\n}\n\nexport function InfoText({lesson_type}) {\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    return (\n      <div>\n        <p>בניסוי זה תלמדו לזהות אקורדים מרובעים (בעלי ארבעה צלילים) משמיעה באמצעות קישורם לשירים ישראליים מוכרים.</p>\n        <p>לתוכנה שני חלקים – חלק השיעור וחלק התרגול. בחלק התרגול עליכם להקיש על האקורד המזוהה באמצעות עכבר המחשב.</p>\n        <p>אנא חברו אוזניות וסדרו עוצמה נוחה להאזנה. את עוצמת השמע אין לשנות תוך כדי הפעלת התוכנה.</p>\n        <p>אנא קראו את הכיתוב המופיע על המסך לאורך כל השיעור.</p>\n        <p>לכל שאלה או בעיה, אנא שלחו הודעה כתובה למייל <a href=\"mailto:yaeljm@gmail.com\">yaeljm@gmail.com</a> או למספר הטלפון 0528931467, ותקבלו מענה בזריזות האפשרית.</p>\n        <p>בהצלחה!</p>\n      </div>\n    );\n\n  case LessonType.TONAL_CONTEXT:\n    return (\n      <div>\n        <p>בניסוי זה תלמדו לזהות אקורדים מרובעים (בעלי ארבעה צלילים) משמיעה באמצעות הקשר טונאלי: תחושת המתח או הפתרון הנובעת משמיעת אקורד בתוך משפט מוזיקלי.</p>\n        <p>לתוכנה שני חלקים – חלק השיעור וחלק התרגול. בחלק התרגול עליכם להקיש על האקורד המזוהה באמצעות עכבר המחשב.</p>\n        <p>אנא חברו אוזניות וסדרו עוצמה נוחה להאזנה. את עוצמת השמע אין לשנות תוך כדי הפעלת התוכנה.</p>        \n        <p>אנא קראו את הכיתוב המופיע על המסך לאורך כל השיעור.</p>\n        <p>לכל שאלה או בעיה, אנא שלחו הודעה כתובה למייל <a href=\"mailto:yaeljm@gmail.com\">yaeljm@gmail.com</a> או למספר הטלפון 0528931467, ותקבלו מענה בזריזות האפשרית.</p>\n        <p>בהצלחה!</p>\n      </div>\n    );\n\n  case LessonType.AUTOMATIC:\n    return (\n      <div>\n        <p>בניסוי זה תלמדו לזהות אקורדים מרובעים (בעלי ארבעה צלילים) משמיעה באמצעות זיהוי אוטומטי.</p>\n        <p>לתוכנה שני חלקים – חלק השיעור וחלק התרגול. בחלק התרגול עליכם להקיש על האקורד המזוהה באמצעות עכבר המחשב.</p>\n        <p>אנא חברו אוזניות וסדרו עוצמה נוחה להאזנה. את עוצמת השמע אין לשנות תוך כדי הפעלת התוכנה.</p>\n        <p>אנא קראו את הכיתוב המופיע על המסך לאורך כל השיעור.</p>\n        <p>לכל שאלה או בעיה, אנא שלחו הודעה כתובה למייל <a href=\"mailto:yaeljm@gmail.com\">yaeljm@gmail.com</a> או למספר הטלפון 0528931467, ותקבלו מענה בזריזות האפשרית.</p>\n        <p>בהצלחה!</p>\n      </div>\n    );\n  }\n}\n\nexport const PretestInfo = () => {\n  return (\n    <div>\n      <p>מיד יעלו על המסך 4 מלבנים. בכל פעם יסומן מלבן אחר על ידי עיגול שחור במרכזו.</p>\n      <p>עליכם ללחוץ במהירות האפשרית על המלבן המסומן עם עיגול.</p>\n      <p>חלק זה בודק את מהירות התגובה שלכם.</p>\n    </div>\n  );\n};\n","let audioIdx2File = (idx) => \"audio/\" + idx + \".mp3\";\n\nexport class AudioController {\n  constructor(srcs, onDoneLoading, onAudioEnded) {\n    this.srcs = srcs;\n    this.players = [];\n    this.ids2players = {};\n    this.players2ids = {};\n    for (const id of this.srcs) {\n      const playerIdx = this.players.length;\n      this.ids2players[id] = playerIdx;\n      this.players2ids[playerIdx] = id;\n\n      const p = new Audio(audioIdx2File(id));\n      p.addEventListener('canplaythrough', (e => {this.audioLoaded(p)}), false);\n      p.addEventListener('ended', (e => {\n        if (this.onAudioEnded) this.onAudioEnded(id)\n      }), false);\n\n      this.players.push(p);\n    }\n\n    this.loadCount = 0;\n    this.onDoneLoading = onDoneLoading;\n    this.onAudioEnded = onAudioEnded;\n  }\n\n  audioLoaded(player) {\n    this.loadCount+=1;\n    if (this.loadCount === this.players.length) {\n      if (this.onDoneLoading) this.onDoneLoading();\n    }\n  }\n\n  play(audio_id) {\n    const playerIdx = this.ids2players[audio_id];\n    this.players[playerIdx].play();\n  }\n\n  stop(audio_id) {\n    const playerIdx = this.ids2players[audio_id];\n    this.players[playerIdx].pause();\n    this.players[playerIdx].currentTime = 0;\n  }\n}\n","import React from 'react';\nimport { Strings } from './defs.js';\n\nexport const LoadingScreen = () => {\n  return <div className=\"containter text-center\"><p className=\"lead\">טוען...</p></div>;\n};\n\nexport const ErrorScreen = ({error}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-sm\">\n          <p>התרחשה שגיאה:</p>\n          <p className=\"lead center\">{error}</p>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport const InfoScreen = ({info, next}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-md-8 offset-md-2 infotext\">\n          {info}\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col\"></div>\n        <div className=\"col text-center\">\n          <br/>\n          <ContinueButton next={next} disabled={false} />\n        </div>\n        <div className=\"col\"></div>\n      </div>\n    </div>\n  );\n};\n\nexport const Button = ({label, onClick, disabled}) => {\n  return disabled ? \n    <button type=\"button\" className=\"btn btn-primary\" onClick={onClick} disabled>{label}</button> :\n    <button type=\"button\" className=\"btn btn-primary\" onClick={onClick}>{label}</button>;\n};\n\nexport const ContinueButton = ({next, disabled}) => {\n  return <Button label={Strings.continue_text} onClick={next} disabled={disabled}/>;\n};\n\n/* 4 buttons in a square layout with fixation point in the middle. Each button is assigned a value to be passed to \n   the next function when it's clicked. */\nexport const ButtonTable = ({labels, values, disabled, next}) => {\n  const gen_button = (btn_idx) => {\n    if (disabled) \n      return <button className=\"chordBtn\" disabled onClick={(e) => next(values[btn_idx])}>{labels[btn_idx]}</button>;\n    else \n      return <button className=\"chordBtn\" onClick={(e) => next(values[btn_idx])}>{labels[btn_idx]}</button>;\n  };\n\n  return (\n    <table className=\"chordSelection\">\n      <tbody>\n        <tr>\n          <td>{gen_button(0)}</td>\n          <td></td>\n          <td>{gen_button(1)}</td>\n        </tr>\n        <tr>\n          <td></td>\n          <td className=\"plusSign align-middle\">+</td>\n          <td></td>\n        </tr>\n        <tr>\n          <td>{gen_button(2)}</td>\n          <td></td>\n          <td>{gen_button(3)}</td>\n        </tr>\n      </tbody>\n    </table>   \n  );\n};\n","export function repeatArray(arr, count) {     \n  var ln = arr.length;\n  var b = [];\n  for(let i=0; i<count; i++) {      \n    b.push(arr[i%ln]);      \n  }\n      \n  return b;      \n}\n\nexport const shuffleArray = arr => arr\n  .map(a => [Math.random(), a])\n  .sort((a, b) => a[0] - b[0])\n  .map(a => a[1]);\n\nexport const randomSequence = (items, length) => shuffleArray(repeatArray(items, length));\n","import React from 'react';\nimport { musical_pieces_data, LessonType, Chords } from '../defs.js';\nimport { AudioController } from '../audio_controller.js';\nimport { InfoScreen, LoadingScreen, ContinueButton } from '../ui.js';\nimport { randomSequence } from '../randomize.js';\nimport ls from 'local-storage';\n\n// Recordings used in each lesson type and part. i.e. \n// for part 1 and musical_pieces lesson: lesson_data.musical_pieces[1]\nlet lesson_data = {\n  musical_pieces: [\n    [[1, Chords.BIG_MAJOR], [2, Chords.SMALL_MAJOR], [3, Chords.SMALL_MINOR], [4, Chords.HALF_DIM]],\n    [[5, Chords.BIG_MAJOR], [6, Chords.SMALL_MAJOR], [7, Chords.SMALL_MINOR], [8, Chords.HALF_DIM]],\n    [[1009, Chords.BIG_MAJOR], [1013, Chords.SMALL_MAJOR], [1017, Chords.SMALL_MINOR], [1021, Chords.HALF_DIM]],\n  ],\n  tonal_context: [\n    [[25, Chords.BIG_MAJOR], [26, Chords.SMALL_MAJOR], [27, Chords.SMALL_MINOR], [28, Chords.HALF_DIM]],\n    [[29, Chords.BIG_MAJOR], [30, Chords.SMALL_MAJOR], [31, Chords.SMALL_MINOR], [32, Chords.HALF_DIM]],\n    [[33, Chords.BIG_MAJOR], [35, Chords.SMALL_MAJOR], [37, Chords.SMALL_MINOR], [39, Chords.HALF_DIM],\n     [34, Chords.BIG_MAJOR], [36, Chords.SMALL_MAJOR], [38, Chords.SMALL_MINOR], [40, Chords.HALF_DIM]],\n  ],\n  automatic: [\n    [[9, Chords.BIG_MAJOR], [13, Chords.SMALL_MAJOR], [17, Chords.SMALL_MINOR], [21, Chords.HALF_DIM]],\n    [[41, Chords.BIG_MAJOR], [45, Chords.SMALL_MAJOR], [49, Chords.SMALL_MINOR], [53, Chords.HALF_DIM]],\n    [[41, Chords.BIG_MAJOR], [45, Chords.SMALL_MAJOR], [49, Chords.SMALL_MINOR], [53, Chords.HALF_DIM],\n     [9, Chords.BIG_MAJOR], [13, Chords.SMALL_MAJOR], [17, Chords.SMALL_MINOR], [21, Chords.HALF_DIM]],\n  ],\n};\n\n// The UI for AUTOMATIC and TONAL_CONTEXT lesson trials.\nconst NameOfChord = props => {\n  let { chordName, lesson_type } = props;\n  let description = \"\";\n  if (lesson_type === LessonType.TONAL_CONTEXT)\n    description = \"שם האקורד הראשון:\";\n  else if (lesson_type === LessonType.AUTOMATIC)\n    description = \"שם האקורד:\";\n\n  return (\n    <div className = \"row text-center successScreenWrapper\">\n      <div className=\"col-sm-8 offset-sm-2 align-middle\">\n        <span className=\"chordName\">\n          {description}\n        <br />\n        { chordName }\n        </span>\n      </div>\n    </div>\n  );\n};\n\n// The UI for MUSICAL_PIECES lesson trials.\nconst SongWithoutChords = props => {\n  let { chordName } = props;\n  let { songData } = props;\n  return(\n    <div className=\"songDisplayWrapper\">\n      <img className=\"songImage\" src={ songData.imgSrc } alt=\"\"/>\n      <div className=\"row\">\n        <div className=\"col text-center\">\n          <div className=\"songTitle\">\n            שם השיר:\n            <br/>\n            { songData.name }\n            <br/>\n            <br/>\n            שם האקורד:\n            <br/>\n            { chordName }\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n// This component represents one part of the lesson. There are 3 parts. The only difference \n// between them is the audio sequence. Audio playing code is here.\nclass LessonPart extends React.Component {\n  state = {\n    trial_idx: 0,\n    done_playing: false,\n    done_loading: false,\n  }\n\n  constructor({part, session, next}) {\n    super();\n    this.part = part;\n    this.next = next;\n    this.state.done_loading = false;\n    this.trials_per_part = 16;\n    this.session = session;\n\n    switch (this.session.lesson_type) {\n    case LessonType.MUSICAL_PIECES:\n      this.part_data = lesson_data.musical_pieces[part];\n      break;\n    case LessonType.TONAL_CONTEXT:\n      this.part_data = lesson_data.tonal_context[part];\n      break;\n    case LessonType.AUTOMATIC:\n      this.part_data = lesson_data.automatic[part];\n      break;\n    };\n\n    this.ls_prefix = \"lesson_part\" + part + \"_\";\n    if (session.continued) {\n      this.sequence = ls.get(this.ls_prefix + \"sequence\");\n      const trial_idx = ls.get(this.ls_prefix + \"trial_idx\");\n      if (trial_idx !== null) this.state.trial_idx = trial_idx;\n      session.continued = false;\n    }\n    else {\n      this.sequence = randomSequence(this.part_data, this.trials_per_part);\n      ls.set(this.ls_prefix + \"sequence\", this.sequence);\n      ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx);\n    }\n\n    console.log(\"LESSON PART \" + part + \" sequence:\");\n    console.log(this.sequence);\n\n    const that = this;\n    const doneLoadingAudio = () => {\n      that.setState({done_loading: true});\n      that.audioController.play(this.sequence[that.state.trial_idx][0]);\n    };\n\n    const donePlaying = () => {\n      that.setState({done_playing: true});\n    };\n\n    this.audioController = new AudioController(this.part_data.map(d => d[0]), doneLoadingAudio, donePlaying);\n  }\n\n  render() {\n    const that = this;\n    const nextTrial = () => {\n      const trial_idx = that.state.trial_idx;\n      if (trial_idx < that.trials_per_part - 1) {\n        that.setState({trial_idx: trial_idx+1,\n                       done_playing: false});\n        that.audioController.play(this.sequence[trial_idx+1][0]);\n        ls.set(this.ls_prefix + \"trial_idx\", trial_idx + 1);\n      }\n      else {\n        that.next();\n      }\n    };\n\n    const trialData  = this.sequence[this.state.trial_idx];\n    const chordName = trialData[1];\n    const songData = musical_pieces_data[chordName];\n\n    if (this.state.done_loading) {\n      let screen;\n      if (this.session.lesson_type === LessonType.MUSICAL_PIECES) {\n        screen = <SongWithoutChords chordName={chordName} songData={songData}/>;\n      }\n      else {\n        screen = <NameOfChord chordName={chordName} lesson_type={this.session.lesson_type}/>;\n      }\n      const button = this.state.done_playing ? (\n          <div className=\"row\">\n            <div className=\"col-sm-8 offset-sm-2 text-center\">\n              <br/>\n              <ContinueButton next={nextTrial} />\n            </div>\n          </div>) : null;\n\n      return (\n        <div className=\"container\">\n          {screen}\n          {button}\n        </div>\n      );\n    }\n    else {\n      return <LoadingScreen />;\n    }\n  }\n}\n\nconst InfoBeforeLessonPartA = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = \n      <div>\n        <p>מיד תשמעו קטעים קצרים מתוך שירים ישראליים מוכרים. בכל קטע שתשמעו, האקורד הראשון יהיה האקורד המשמעותי, אליו עליכם להתייחס.</p>\n        <p>שימו לב כי הקטעים חוזרים על עצמם מספר רב של פעמים, בכדי לאפשר לכם למידה מעמיקה. נסו להאזין היטב בכל אחת מן ההשמעות.</p>\n      </div>;\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info = \n      <div>\n        <p>מיד תשמעו צמדי אקורדים. לפני כל צמד אקורדים תשמעו מבוא טונאלי – סולם עולה ויורד. בכל צמד אקורדים שתשמעו, האקורד הראשון יהיה האקורד המשמעותי, אליו עליכם להתייחס.</p>\n        <p>שימו לב כי הקטעים חוזרים על עצמם מספר רב של פעמים, בכדי לאפשר לכם למידה מעמיקה. נסו להאזין היטב בכל אחת מן ההשמעות.</p>\n      </div>;\n    break;\n  case LessonType.AUTOMATIC:\n    info = \n      <div>\n        <p>מיד תישמעו אקורדים. </p>\n        <p>שימו לב כי האקורדים חוזרים על עצמם מספר רב של פעמים, בכדי לאפשר לכם למידה מעמיקה. נסו להאזין היטב בכל אחת מן ההשמעות.</p>\n      </div>;\n    break;\n  };\n\n  return <InfoScreen info={info} next={next}/>;\n};\n\nconst InfoBeforeLessonPartB = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = \n      <p>\n      מיד תשמעו קטעים זהים לקטעים ששמעתם, אך הפעם בביצוע של חליל ופסנתר. \n      בכל קטע שתשמעו, האקורד הראשון יהיה האקורד המשמעותי, אליו עליכם להתייחס.\n      שימו לב כי הקטעים חוזרים על עצמם מספר רב של פעמים, בכדי לאפשר לכם למידה מעמיקה. נסו להאזין היטב בכל אחת מן ההשמעות.\n      </p>;\n    break;\n  case LessonType.TONAL_CONTEXT:\n  case LessonType.AUTOMATIC:\n    info =\n      <p>\n      מיד תשמעו אקורדים זהים לאקורדים ששמעתם, אך הפעם בביצוע של גיטרה. \n      בכל קטע שתשמעו, האקורד הראשון יהיה האקורד המשמעותי, אליו עליכם להתייחס.\n      שימו לב כי הקטעים חוזרים על עצמם מספר רב של פעמים, בכדי לאפשר לכם למידה מעמיקה. נסו להאזין היטב בכל אחת מן ההשמעות.\n      </p>;\n    break;\n  };\n\n  return <InfoScreen info={info} next={next}/>;\n};\n\nconst InfoBeforeLessonPartC = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = <p>בחלק זה תשמעו את האקורדים המלווים את השיר, ועליכם לשיר או לזמזם את המנגינה של השיר הכתוב.</p>;\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info = <p>בחלק זה תשמעו את הסולם העולה והיורד ואחריו אקורד בודד.</p>;\n    break;\n  case LessonType.AUTOMATIC:\n    info = <p>בחלק זה תשמעו אקורדים בודדים משני הסוגים ששמעתם קודם לכן - בפסנתר ובגיטרה.</p>;\n    break;\n  };\n\n  return <InfoScreen info={info} next={next}/>;\n};\n\n// The main lesson block component.\nexport class LessonBlock extends React.Component {\n  steps = {\n    INFO_A: 1,\n    PART_A: 2,\n    INFO_B: 3,\n    PART_B: 4, \n    INFO_C: 5,\n    PART_C: 6,\n    DONE: 7,\n  }\n\n  state = {\n    step: 1,\n  }\n\n  nextStep = () => {\n    const { step } = this.state;\n\n    this.setState({\n      step: step + 1\n    });\n    ls.set(\"lesson_block_step\", step + 1);\n\n    if (step + 1 === this.steps.DONE)\n      this.next();\n  }\n\n  state = {\n    step: 1,\n  };\n  \n  constructor({data, session, next}) {\n    super();\n    this.data = data;\n    this.session = session;\n    this.next = next;\n\n    if (session.continued) {\n      this.state.step = ls.get(\"lesson_block_step\", this.state.step);\n    }\n    else {\n      ls.set(\"lesson_block_step\", this.state.step);\n    }\n  }\n  \n  render() {\n    const {step} = this.state;\n    let screen;\n\n    switch(step) {\n    case this.steps.INFO_A:\n      this.session.continued = false;\n      screen = <InfoBeforeLessonPartA lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_A:\n      screen = <LessonPart part={0} session={this.session} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.INFO_B:\n      this.session.continued = false;\n      screen = <InfoBeforeLessonPartB lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_B:\n      screen = <LessonPart part={1} session={this.session} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.INFO_C:\n      this.session.continued = false;\n      screen = <InfoBeforeLessonPartC lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_C:\n      screen = <LessonPart part={2} session={this.session} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.DONE:\n      this.nextStep();\n    }\n\n    return screen;\n  }\n}\n","import React from 'react';\nimport { AudioController } from '../audio_controller.js';\nimport { LessonType, Strings, StaticImages, Chords, Timbres, musical_pieces_data } from '../defs.js';\nimport { InfoScreen, LoadingScreen, ContinueButton, ButtonTable } from '../ui.js';\nimport { randomSequence, shuffleArray } from '../randomize.js';\nimport ls from 'local-storage';\n\n// each trial entry is [audio_idx, chord, transposition, timbre]\nconst training_data = {\n  musical_pieces: [\n    [[1, Chords.BIG_MAJOR, 0, null], [2, Chords.SMALL_MAJOR, 0, null], \n     [3, Chords.SMALL_MINOR, 0, null], [4, Chords.HALF_DIM, 0, null]],\n    [[5, Chords.BIG_MAJOR, 0, null], [6, Chords.SMALL_MAJOR, 0, null], \n     [7, Chords.SMALL_MINOR, 0, null], [8, Chords.HALF_DIM, 0, null]],\n    [ // piano recordings\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [10, Chords.BIG_MAJOR, 1, Timbres.PIANO], \n      [11, Chords.BIG_MAJOR, 2, Timbres.PIANO], [12, Chords.BIG_MAJOR, 3, Timbres.PIANO],\n      [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO], [14, Chords.SMALL_MAJOR, 1, Timbres.PIANO],\n      [15, Chords.SMALL_MAJOR, 2, Timbres.PIANO], [16, Chords.SMALL_MAJOR, 3, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [18, Chords.SMALL_MINOR, 1, Timbres.PIANO], \n      [19, Chords.SMALL_MINOR, 2, Timbres.PIANO], [20, Chords.SMALL_MINOR, 3, Timbres.PIANO],\n      [21, Chords.HALF_DIM, 0, Timbres.PIANO], [22, Chords.HALF_DIM, 1, Timbres.PIANO], \n      [23, Chords.HALF_DIM, 2, Timbres.PIANO], [24, Chords.HALF_DIM, 3, Timbres.PIANO],\n      // guitar recordings\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [42, Chords.BIG_MAJOR, 1, Timbres.GUITAR], \n      [43, Chords.BIG_MAJOR, 2, Timbres.GUITAR], [44, Chords.BIG_MAJOR, 3, Timbres.GUITAR],\n      [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR], [46, Chords.SMALL_MAJOR, 1, Timbres.GUITAR], \n      [47, Chords.SMALL_MAJOR, 2, Timbres.GUITAR], [48, Chords.SMALL_MAJOR, 3, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [50, Chords.SMALL_MINOR, 1, Timbres.GUITAR], \n      [51, Chords.SMALL_MINOR, 2, Timbres.GUITAR], [52, Chords.SMALL_MINOR, 3, Timbres.GUITAR],\n      [53, Chords.HALF_DIM, 0, Timbres.GUITAR], [54, Chords.HALF_DIM, 1, Timbres.GUITAR], \n      [55, Chords.HALF_DIM, 2, Timbres.GUITAR], [56, Chords.HALF_DIM, 3, Timbres.GUITAR],\n    ],\n  ],\n  tonal_context: [\n    [ // piano\n      [25, Chords.BIG_MAJOR, 0, Timbres.PIANO], [26, Chords.SMALL_MAJOR, 0, Timbres.PIANO],\n      [27, Chords.SMALL_MINOR, 0, Timbres.PIANO], [28, Chords.HALF_DIM, 0, Timbres.PIANO],\n      // guitar\n      [29, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [30, Chords.SMALL_MAJOR, 0, Timbres.GUITAR],\n      [31, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [32, Chords.HALF_DIM, 0, Timbres.GUITAR],\n    ],\n    [ // piano\n      [33, Chords.BIG_MAJOR, 0, Timbres.PIANO], [35, Chords.SMALL_MAJOR, 0, Timbres.PIANO],\n      [37, Chords.SMALL_MINOR, 0, Timbres.PIANO], [39, Chords.HALF_DIM, 0, Timbres.PIANO],\n      // guitar\n      [34, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [36, Chords.SMALL_MAJOR, 0, Timbres.GUITAR],\n      [38, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [40, Chords.HALF_DIM, 0, Timbres.GUITAR],\n    ],\n    [ // piano recordings\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [10, Chords.BIG_MAJOR, 1, Timbres.PIANO], \n      [11, Chords.BIG_MAJOR, 2, Timbres.PIANO], [12, Chords.BIG_MAJOR, 3, Timbres.PIANO],\n      [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO], [14, Chords.SMALL_MAJOR, 1, Timbres.PIANO],\n      [15, Chords.SMALL_MAJOR, 2, Timbres.PIANO], [16, Chords.SMALL_MAJOR, 3, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [18, Chords.SMALL_MINOR, 1, Timbres.PIANO], \n      [19, Chords.SMALL_MINOR, 2, Timbres.PIANO], [20, Chords.SMALL_MINOR, 3, Timbres.PIANO],\n      [21, Chords.HALF_DIM, 0, Timbres.PIANO], [22, Chords.HALF_DIM, 1, Timbres.PIANO], \n      [23, Chords.HALF_DIM, 2, Timbres.PIANO], [24, Chords.HALF_DIM, 3, Timbres.PIANO],\n      // guitar recordings\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [42, Chords.BIG_MAJOR, 1, Timbres.GUITAR], \n      [43, Chords.BIG_MAJOR, 2, Timbres.GUITAR], [44, Chords.BIG_MAJOR, 3, Timbres.GUITAR],\n      [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR], [46, Chords.SMALL_MAJOR, 1, Timbres.GUITAR], \n      [47, Chords.SMALL_MAJOR, 2, Timbres.GUITAR], [48, Chords.SMALL_MAJOR, 3, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [50, Chords.SMALL_MINOR, 1, Timbres.GUITAR], \n      [51, Chords.SMALL_MINOR, 2, Timbres.GUITAR], [52, Chords.SMALL_MINOR, 3, Timbres.GUITAR],\n      [53, Chords.HALF_DIM, 0, Timbres.GUITAR], [54, Chords.HALF_DIM, 1, Timbres.GUITAR], \n      [55, Chords.HALF_DIM, 2, Timbres.GUITAR], [56, Chords.HALF_DIM, 3, Timbres.GUITAR],\n    ],\n  ],\n  automatic: [\n    [ // piano\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [21, Chords.HALF_DIM, 0, Timbres.PIANO],\n      // guitar\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [53, Chords.HALF_DIM, 0, Timbres.GUITAR],\n    ],\n    [ // piano\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [21, Chords.HALF_DIM, 0, Timbres.PIANO],\n      // guitar\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [53, Chords.HALF_DIM, 0, Timbres.GUITAR],\n    ],\n    [ // piano recordings\n      [9, Chords.BIG_MAJOR, 0, Timbres.PIANO], [10, Chords.BIG_MAJOR, 1, Timbres.PIANO], \n      [11, Chords.BIG_MAJOR, 2, Timbres.PIANO], [12, Chords.BIG_MAJOR, 3, Timbres.PIANO],\n      [13, Chords.SMALL_MAJOR, 0, Timbres.PIANO], [14, Chords.SMALL_MAJOR, 1, Timbres.PIANO],\n      [15, Chords.SMALL_MAJOR, 2, Timbres.PIANO], [16, Chords.SMALL_MAJOR, 3, Timbres.PIANO],\n      [17, Chords.SMALL_MINOR, 0, Timbres.PIANO], [18, Chords.SMALL_MINOR, 1, Timbres.PIANO], \n      [19, Chords.SMALL_MINOR, 2, Timbres.PIANO], [20, Chords.SMALL_MINOR, 3, Timbres.PIANO],\n      [21, Chords.HALF_DIM, 0, Timbres.PIANO], [22, Chords.HALF_DIM, 1, Timbres.PIANO], \n      [23, Chords.HALF_DIM, 2, Timbres.PIANO], [24, Chords.HALF_DIM, 3, Timbres.PIANO],\n      // guitar recordings\n      [41, Chords.BIG_MAJOR, 0, Timbres.GUITAR], [42, Chords.BIG_MAJOR, 1, Timbres.GUITAR], \n      [43, Chords.BIG_MAJOR, 2, Timbres.GUITAR], [44, Chords.BIG_MAJOR, 3, Timbres.GUITAR],\n      [45, Chords.SMALL_MAJOR, 0, Timbres.GUITAR], [46, Chords.SMALL_MAJOR, 1, Timbres.GUITAR], \n      [47, Chords.SMALL_MAJOR, 2, Timbres.GUITAR], [48, Chords.SMALL_MAJOR, 3, Timbres.GUITAR],\n      [49, Chords.SMALL_MINOR, 0, Timbres.GUITAR], [50, Chords.SMALL_MINOR, 1, Timbres.GUITAR], \n      [51, Chords.SMALL_MINOR, 2, Timbres.GUITAR], [52, Chords.SMALL_MINOR, 3, Timbres.GUITAR],\n      [53, Chords.HALF_DIM, 0, Timbres.GUITAR], [54, Chords.HALF_DIM, 1, Timbres.GUITAR], \n      [55, Chords.HALF_DIM, 2, Timbres.GUITAR], [56, Chords.HALF_DIM, 3, Timbres.GUITAR],\n    ],\n  ],\n};\n\nconst correction_data = {\n  [LessonType.MUSICAL_PIECES]: [\n    {[Chords.BIG_MAJOR]: 9, [Chords.SMALL_MAJOR]: 13, [Chords.SMALL_MINOR]: 17, [Chords.HALF_DIM]: 21 },\n    {[Chords.BIG_MAJOR]: 9, [Chords.SMALL_MAJOR]: 13, [Chords.SMALL_MINOR]: 17, [Chords.HALF_DIM]: 21 },\n    null,\n  ],\n  [LessonType.TONAL_CONTEXT]: [\n    {[Chords.BIG_MAJOR]: 9, [Chords.SMALL_MAJOR]: 13, [Chords.SMALL_MINOR]: 17, [Chords.HALF_DIM]: 21 },\n    {[Chords.BIG_MAJOR]: 9, [Chords.SMALL_MAJOR]: 13, [Chords.SMALL_MINOR]: 17, [Chords.HALF_DIM]: 21 },\n    null,\n  ],\n  [LessonType.AUTOMATIC]: [null, null, null]\n};\n\nconst TrainingInfo = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = (\n      <div>\n      <p>בחלק זה תשמעו קטעים מוזיקליים ותצטרכו לזהות את האקורד הראשון שלהם. בדומה לחלק הקודם, האקורד יושמע גם אחרי הקטע המוזיקלי.</p>\n      <p>עליכם לזהות את סוג האקורד במהירות האפשרית, וללחוץ עליו באמצעות העכבר.</p>\n      </div>);\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info = (\n      <div>\n        <p>בחלק זה תשמעו צמדים מוזיקליים לאחר מבוא טונאלי של סולם עולה ויורד, ותצטרכו לזהות את האקורד הראשון בכל צמד. האקורד אותו תצטרכו לזהות יושמע שוב לאחר שמיעת צמד האקורדים.</p>\n        <p>עליכם לזהות את סוג האקורד במהירות האפשרית, וללחוץ עליו באמצעות העכבר.</p>\n      </div>);\n    break;\n  case LessonType.AUTOMATIC:\n    info = (\n      <div>\n        <p>בחלק זה תשמעו אקורדים בודדים, ותצטרכו לזהות אותם במהירות האפשרית, וללחוץ על סוג האקורד.</p>\n      </div>);\n  }\n  return <InfoScreen next={next} info={info}/>;\n};\n\nconst InfoBeforeTrainingPartB = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = (\n      <div>\n        <p>בחלק זה תשמעו קטעים זהים, אך הפעם בביצוע של חליל ופסנתר, ותצטרכו לזהות את האקורד המושמע בליווי.</p>\n        <p>עליכם לזהות את סוג האקורד במהירות האפשרית, וללחוץ עליו באמצעות העכבר.</p>\n      </div>);\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info = <p>בחלק זה תשמעו מבוא טונאלי ואחריו אקורד בודד. תצטרכו לזהות את האקורד הבודד במהירות האפשרית, וללחוץ על סוג האקורד.</p>;\n    break;\n  case LessonType.AUTOMATIC:\n    info = <p>תזכורת: בחלק זה תשמעו אקורדים בודדים, ותצטרכו לזהות אותם במהירות האפשרית, וללחוץ על סוג האקורד.</p>;\n    break;\n  }\n  return <InfoScreen info={info} next={next}/>;\n};\n\nconst InfoBeforeTrainingPartC = props => {\n  let { lesson_type, next } = props;\n  let info;\n  switch (lesson_type) {\n  case LessonType.MUSICAL_PIECES:\n    info = <p>בחלק זה תשמעו אקורדים בודדים, ללא הקטע המוזיקלי, ותצטרכו לזהות אותם במהירות האפשרית, וללחוץ על סוג האקורד.</p>;\n    break;\n  case LessonType.TONAL_CONTEXT:\n    info = <p>בחלק זה תשמעו אקורדים בודדים, ללא הקטע המוזיקלי, ותצטרכו לזהות אותם במהירות האפשרית, וללחוץ על סוג האקורד.</p>;\n    break;\n  case LessonType.AUTOMATIC:\n    info = <p>תזכורת: בחלק זה תשמעו אקורדים בודדים, ותצטרכו לזהות אותם במהירות האפשרית, וללחוץ על סוג האקורד.</p>;\n    break;\n  }\n  return <InfoScreen info={info} next={next}/>;\n};\n\nconst SuccessfulIdentification = props => {\n  const { next } = props;\n  return (\n    <div className=\"row successScreenWrapper\">\n      <div className=\"col-sm-8 offset-sm-2 text-center\">\n        <span className=\"songTitle\"> { Strings.success_identification } &nbsp;</span>\n        <img src= { StaticImages.happySmiley } width=\"150px\" height=\"150px\" alt=\"\"/>\n        <br/>\n        <br/>\n        <ContinueButton next={next} />\n      </div>\n    </div>\n  );\n};\n\nconst FailedIdentification = props => {\n  const { shouldShowCorrect, shouldShowButton, correctChord, lesson_type, part, next} = props;\n\n  let appendix;\n\n  if (shouldShowCorrect === true){\n    const button = shouldShowButton ? <ContinueButton next={next} /> : null;\n    let text;\n    if (part === 2 || lesson_type === LessonType.AUTOMATIC) text = \"האקורד שהושמע הוא אקורד \";\n    else if (lesson_type === LessonType.MUSICAL_PIECES) text = \"בשיר יש אקורד \";\n    else text = \"בהקלטה יש אקורד \";\n    \n    appendix = \n      <div>\n        <span className=\"songTitle\">{ text } </span>\n        <span className=\"songTitle\">{ correctChord }</span>\n        <br/>\n        <span className=\"songTitle\">{ Strings.how_it_sounds }</span>\n        <br/>\n        <br/>\n        {button}\n      </div>;\n  } else appendix = null;\n\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-sm-9 offset-sm-1 text-center\">\n            <span className=\"songTitle\"> { Strings.failure_identification } &nbsp;</span>\n            <br/>\n            <span className=\"songTitle\">{ Strings.how_it_sounds }</span>\n            { appendix }\n        </div>\n        <div className=\"col-sm-2\">\n          <img src= { StaticImages.sadSmiley } width=\"150px\" height=\"150px\" alt=\"\" className=\"sadSmiley\"/>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst SongWithChords = props => {\n  const { songData, chord_buttons, disabled, next } = props;\n\n  const gen_button = (chord, i) => {\n    if (disabled) \n      return <td key={i}><button className=\"chordBtn\" disabled key={i} onClick={(e) => next(chord)}>{chord}</button></td>;\n    else \n      return <td key={i}><button className=\"chordBtn\" key={i} onClick={(e) => next(chord)}>{chord}</button></td>;\n  };\n\n  return (\n    <div className=\"songDisplayWrapper\">\n      <img className=\"songImage\" src={ songData.imgSrc } alt=\"\"/>\n      <div className=\"row\">\n        <div className=\"col text-center songTitle\">\n          שם השיר:\n          <br/>\n          { songData.name }\n          <br/>\n          <br/>\n          שם האקורד:\n        </div>\n\n      </div>\n      <div className=\"row chordsTable text-center\">\n        <div className=\"col text-center chords\">\n          <table className=\"chordsTable text-center\">\n            <tbody>\n              <tr>\n                {chord_buttons.map((chord, i) => gen_button(chord, i))}\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst ChordSelection = ({chord_buttons, disabled, with_song_names, next}) => {\n  const labels = chord_buttons.map(chord => with_song_names ? \n                                   <p>{chord} <br/> {musical_pieces_data[chord].name}</p> : \n                                   <p>{chord}</p>);\n\n  return <ButtonTable labels={labels} values={chord_buttons} disabled={disabled} next={next} />;\n};\n\nclass TrainingPart extends React.Component {\n  state = {\n    trial_idx: 0,\n    done_loading: false,\n    done_playing: false,\n    show_feedback: false,\n    answer: null,\n  };\n\n  trials_per_part = 32;\n\n  constructor({part, session, chord_buttons, next, data}) {\n    super();\n    this.part = part;\n    this.session = session;\n    this.chord_buttons = chord_buttons;\n    this.next = next;\n    this.data = data;\n\n    switch (session.lesson_type) {\n    case LessonType.MUSICAL_PIECES:\n      this.part_data = training_data.musical_pieces[part];\n      break;\n    case LessonType.TONAL_CONTEXT:\n      this.part_data = training_data.tonal_context[part];\n      break;\n    case LessonType.AUTOMATIC:\n      this.part_data = training_data.automatic[part];\n      break;\n    };\n\n    this.ls_prefix = \"training_part\" + part + \"_\";\n    if (session.continued) {\n      this.sequence = ls.get(this.ls_prefix + \"sequence\");\n      const trial_idx = ls.get(this.ls_prefix + \"trial_idx\");\n      if (trial_idx !== null) this.state.trial_idx = trial_idx;\n      session.continued = false; // we only need to restore session once!\n    }\n    else {\n      this.sequence = randomSequence(this.part_data, this.trials_per_part);\n      ls.set(this.ls_prefix + \"sequence\", this.sequence);\n      ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx);\n    }\n    console.log(\"TRAINING PART \" + part + \" sequence:\");\n    console.log(this.sequence);\n\n    const that = this;\n    const doneLoadingAudio = () => {\n      that.setState({done_loading: true});\n      that.audioController.play(that.sequence[that.state.trial_idx][0]);\n      that.response_start = new Date();\n    };\n\n    const donePlaying = () => {\n      that.setState({done_playing: true});\n      \n      // this part runs when we give feedback for an incorrect answer.\n      if (this.state.show_feedback) {\n        if (!this.state.fail_show_correct) {\n          // play the correct answer audio idx\n          this.audioController.play(this.state.correct_audio_idx);\n          this.setState({fail_show_correct: true});\n        } else {\n          // done playing feedback, show continue button.\n          this.setState({done_playing_correct_feedback: true});\n        }\n      }\n    };\n\n    let correction_idxs = [];\n    const corrections_for_part = correction_data[this.session.lesson_type][this.part];\n    if (corrections_for_part !== null) {\n      for (const chord in corrections_for_part)\n        correction_idxs.push(corrections_for_part[chord]);\n    }\n\n    console.log(\"audioidxs\");\n    console.log(correction_idxs);\n    this.audioController = new AudioController(correction_idxs.concat(this.part_data.map(d => d[0])), doneLoadingAudio, donePlaying);\n  }\n\n  /* calculate the transposition count since the beginning of training (currently of part). */\n  get_transposition_play_count() { \n    const idx = this.state.trial_idx;\n    const trial = this.sequence[idx];\n    const count_in_part = this.sequence.slice(0, idx)\n      .filter(t => t[1] === trial[1] && t[2] === trial[2]).length + 1;\n    return count_in_part;\n  }\n\n  render() {\n    const that = this;\n    const trial_data = this.sequence[this.state.trial_idx];\n    const chord_name = trial_data[1];\n    const transposition = trial_data[2];\n\n    const nextTrial = () => {\n      const trial_idx = that.state.trial_idx;\n      if (trial_idx < that.trials_per_part - 1) {\n        that.setState({trial_idx: trial_idx + 1,\n                       done_playing: false,\n                       show_feedback: false});\n        that.audioController.play(this.sequence[trial_idx+1][0]);\n        that.response_start = new Date(); // RT measurement\n      }\n      else {\n        that.next();\n      }\n    };\n\n    const processAnswer = (answer) => {\n      const correct = answer === chord_name;\n      // save trial data\n      const td = {\n        time: new Date().toString(),\n        audio_index: trial_data[0],\n        chord_number: that.trials_per_part * this.part + this.state.trial_idx + 1,\n        chord_type: chord_name,\n        transposition: transposition + 1,\n        transposition_play_count: that.get_transposition_play_count(),\n        selected_chord_type: answer,\n        correct: correct,\n        response_time: new Date() - that.response_start,\n      };\n      that.data.trials.push(td);\n      ls.set(\"data\", that.data);\n      if (this.state.trial_idx+1 < this.trials_per_part)\n        ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx+1);\n\n      // stop playback\n      that.audioController.stop(trial_data[0]);\n\n      // continue to show answer feedback\n      if (!correct) {\n        // start playing the chosen chord and then the right chord.\n        // [idx, chord, trnsp, timbre]\n        console.log(correction_data);\n        const corrections_for_part = correction_data[this.session.lesson_type][this.part];\n        const selected_audio_idx = corrections_for_part !== null ?\n              corrections_for_part[answer] :\n              that.part_data.filter(d => d[1] === answer && d[2] === transposition && d[3] === trial_data[3])[0][0];\n\n        const correct_audio_idx = corrections_for_part !== null ?\n              corrections_for_part[trial_data[1]] :\n              trial_data[0];\n        console.log(\"correct_audio_idx: \" + correct_audio_idx);\n\n        this.setState({show_feedback: true,\n                       correct: correct,\n                       fail_show_correct: false,\n                       done_playing_correct_feedback: false,\n                       correct_audio_idx: correct_audio_idx});\n        that.audioController.play(selected_audio_idx);\n      }\n      else {        \n        that.setState({show_feedback: true,\n                       correct: correct});\n      }\n    };\n    \n    if (!this.state.done_loading) \n      return <LoadingScreen />;\n\n    if (!this.state.show_feedback) {\n      let screen;\n      if (this.part < 2 && this.session.lesson_type === LessonType.MUSICAL_PIECES) {\n        const song_data = musical_pieces_data[chord_name];\n        screen = <SongWithChords songData={song_data} chord_buttons={this.chord_buttons} next={processAnswer}/>;\n      }\n      else {\n        screen = <ChordSelection chord_buttons={this.chord_buttons} next={processAnswer}/>;\n      }\n      \n      return (\n        <div className=\"container\">\n          {screen}\n        </div>\n      );\n    }\n    else { // show feedback screen\n      if (this.state.correct) {\n        return <SuccessfulIdentification next={nextTrial}/>;\n      } else {\n        this.nextTrial = nextTrial;\n        return <FailedIdentification shouldShowCorrect={this.state.fail_show_correct} shouldShowButton={this.state.done_playing_correct_feedback} correctChord={chord_name} lesson_type={this.session.lesson_type} next={nextTrial} part={this.part}/>;\n      }\n    }\n  }\n};\n\nexport class TrainingBlock extends React.Component {\n  steps = {\n    INFO_A: 1,\n    PART_A: 2,\n    INFO_B: 3,\n    PART_B: 4,\n    INFO_C: 5,\n    PART_C: 6,\n    DONE: 7,\n  }\n\n  state = {\n    step: 1,\n  }\n\n  chord_buttons = shuffleArray([Chords.BIG_MAJOR, Chords.SMALL_MAJOR, Chords.SMALL_MINOR, Chords.HALF_DIM]);\n\n  nextStep = () => {\n    const { step } = this.state;\n    \n    this.setState({\n      step: step + 1\n    });\n    ls.set(\"training_block_step\", step + 1);\n\n    if (step + 1 === this.steps.DONE)\n      this.next();\n  }\n\n  constructor({data, session, next}) {\n    super();\n    this.data = data;\n    this.session = session;\n    this.next = next;\n\n    if (session.continued) {\n      this.chord_buttons = ls.get(\"training_block_chord_buttons\");      \n      this.state.step = ls.get(\"training_block_step\");\n    }\n    else {\n      ls.set(\"training_block_chord_buttons\", this.chord_buttons);\n      ls.set(\"training_block_step\", this.state.step);\n    }\n  }\n\n  render() {\n    const { step } = this.state;\n    let screen;\n    switch (step) {\n    case this.steps.INFO_A:\n      this.session.continued = false;\n      screen = <TrainingInfo lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_A:\n      screen = <TrainingPart part={0} session={this.session} next={this.nextStep} key={step} chord_buttons={this.chord_buttons} data={this.data} />;\n      break;\n    case this.steps.INFO_B:\n      this.session.continued = false;\n      screen = <InfoBeforeTrainingPartB lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_B:\n      screen = <TrainingPart part={1} session={this.session} next={this.nextStep} key={step} chord_buttons={this.chord_buttons} data={this.data} />;\n      break;\n    case this.steps.INFO_C:\n      this.session.continued = false;\n      screen = <InfoBeforeTrainingPartC lesson_type={this.session.lesson_type} next={this.nextStep} key={step} />;\n      break;\n    case this.steps.PART_C:\n      screen = <TrainingPart part={2} session={this.session} next={this.nextStep} key={step} chord_buttons={this.chord_buttons} data={this.data} />;\n      break;\n    case this.steps.DONE:\n      screen = null;\n      break;\n    };\n\n    return screen;\n  }\n}\n","/* functions for reading and writing to a google spreadsheet.\n   \n */\n\nconst read_url = \"https://sheets.googleapis.com/v4/spreadsheets/\";\n\n// https://stackoverflow.com/questions/1714786/query-string-encoding-of-a-javascript-object\nconst serialize = function(obj, prefix) {\n  var str = [],\n    p;\n  for (p in obj) {\n    if (obj.hasOwnProperty(p)) {\n      var k = prefix ? prefix + \"[\" + p + \"]\" : p,\n        v = obj[p];\n      str.push((v !== null && typeof v === \"object\") ?\n        serialize(v, k) :\n        encodeURIComponent(k) + \"=\" + encodeURIComponent(v));\n    }\n  }\n  console.log(\"serialize: \" + str.join(\"&\"));\n  return str.join(\"&\");\n}\n\nconst parse_sheet_list = (data) => {\n  let sheetNames = [];\n  data.sheets.forEach(sheet => {\n    sheetNames.push(sheet.properties.title);\n  });\n  return sheetNames;\n};\n\nconst gs = {\n  read: function(conn, sheetName, range) {\n    return fetch(read_url + \n                 conn.spreadsheet_id + \n                 \"/values/\" + \n                 sheetName + \n                 \"!\" + range + \n                 \"?key=\" + conn.api_key);\n  },\n\n  write: function(conn, sheetName, data) {\n    if (!Array.isArray(data))\n        data = [data];\n\n    let url = conn.write_url + \"?sheet_name=\" + sheetName;\n    return fetch(url,\n                 {\n                   headers: {\n                     'Accept': 'application/json',\n                     'Content-Type': 'application/json'\n                   },\n                   method: \"POST\",\n                   mode: 'no-cors',\n                   body: JSON.stringify(data),\n                 });\n  },\n\n  list_sheets: function(conn) {\n    return fetch(read_url + conn.spreadsheet_id + \"?key=\" + conn.api_key)\n      .then(res => res.json())\n      .then(parse_sheet_list);\n  },\n};\n\nexport default gs;\n","import gs from './spreadsheet_io.js';\nimport { SheetNames } from './defs.js';\nimport ls from 'local-storage';\n\nconst FIRST_HOUR_OF_DAY = 3; // day starts at 3 am.\n\nexport const SessionEvent = {\n  SESSION_START: \"SESSION_START\",\n  SESSION_CONTINUED: \"SESSION_CONTINUED\",\n  SESSION_END: \"SESSION_END\",\n};\n\n// parse session json data from sheets api into an array of session objects.\nexport const parseSessions = (data) => {\n  let sessions = [];\n  data.values.forEach(session_event => {\n    let session = {\n      id: session_event[0],\n      number: session_event[1],\n      event: session_event[2],\n      lesson_type: session_event[3],\n      time: session_event[4],\n    };\n    sessions.push(session);\n  });\n  return sessions;\n};\n\nexport const writeSessionEvent = (conn, session, event, on_error) => {\n  let request_data = Object.assign({event: event,\n                                    time: new Date().toString()},\n                                    session);\n  ls.set('session', session);\n  gs.write(conn, SheetNames.TRAINING_SESSIONS, request_data)\n    .catch(on_error);\n\n};\n\nexport const readSessionData = (conn) => {\n  return gs.read(conn, SheetNames.TRAINING_SESSIONS, \"A2:E10000\")\n    .then(response => response.json())\n    .then(parseSessions);\n  \n};\n\nexport const readLessonType = (conn, id) => {\n  const findLessonType = (data) => {\n    let lesson_type = -1;\n    data.values.forEach(row => {\n      if (row[0] === id)\n        lesson_type = parseInt(row[1]);\n    });    \n    return lesson_type;\n  }\n\n  return gs.read(conn, SheetNames.LESSON_TYPES, \"A2:B10000\")\n    .then(response => response.json())\n    .then(findLessonType)\n};\n\n// Return true if the last session was today. Day starts at FIRST_HOUR_OF_DAY\nexport const was_last_session_today = (last_session) => {\n  let last_time = new Date(last_session.time);\n  last_time.setHours(last_time.getHours() - FIRST_HOUR_OF_DAY);\n  let now = new Date();\n  now.setHours(now.getHours() - FIRST_HOUR_OF_DAY);\n  return now.getDate() === last_time.getDate();\n};\n\nexport const does_user_sheet_exists = (conn, user_id) => {\n  return gs.list_sheets(conn)\n    .then(sheets => sheets.includes(user_id));\n};\n","import React from 'react';\nimport '../Experiment.css';\nimport './TrainingExperiment.css';\nimport { IntroText, InfoText, PretestInfo } from './info.js';\nimport { LessonBlock } from './lesson_block.js';\nimport { TrainingBlock } from './training_block.js';\nimport { InfoScreen, LoadingScreen, ErrorScreen, ContinueButton, ButtonTable } from '../ui.js';\nimport { does_user_sheet_exists, was_last_session_today, SessionEvent, writeSessionEvent, readSessionData, readLessonType } from '../sessions.js';\nimport { randomSequence } from '../randomize.js';\nimport gs from '../spreadsheet_io.js';\nimport ls from 'local-storage';\n\nconst MAX_NUMBER_OF_SESSIONS = 5;\n\n// 1st screen.\nconst IntroScreen = ({next, data}) => {\n  function handleContinue() {\n    data.id = document.getElementById('id_input').value;\n    next();\n  }\n\n  return ( // the hidden p tag is there to balance the \" marks\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-md-8 offset-md-2 infotext\">\n          <IntroText />\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col\"></div>\n        <div className=\"col text-center\">\n          <br/>\n          <label>ת\"ז: <input type=\"text\" id=\"id_input\"/><br/></label>\n          <p hidden>\"</p>\n          <br/>\n          <ContinueButton next={handleContinue} disabled={false} />\n        </div>\n        <div className=\"col\"></div>\n      </div>\n    </div>\n  );\n};\n\nconst FinishScreen = ({done_saving, session_number}) => {\n  const remaining = MAX_NUMBER_OF_SESSIONS - session_number;\n  return (\n    <div className=\"container\">\n      <div className=\"col-md-8 offset-md-2\">\n        <p>הפעלה מספר {session_number} הסתיימה. נותרו עוד {remaining} הפעלות.</p>\n        <p>{done_saving ? \"הנתונים נשמרו בהצלחה!\" : \"אנא המתן לשמירת הנתונים...\"}</p>\n      </div>\n    </div>\n  );\n};\n\nclass PretestBlock extends React.Component {\n  state = {\n    trial_idx: 0,\n  };\n\n  practice_trials_count = 8;\n  test_trails_count = 20;\n  button_idxs = [0, 1, 2, 3];\n\n  constructor({session, next, data}) {\n    super();\n    this.next = next;\n    this.data = data;\n    this.session = session;\n\n    this.ls_prefix = \"pretest_\";\n    if (session.continued) {\n      this.sequence = ls.get(this.ls_prefix + \"sequence\");\n      const trial_idx = ls.get(this.ls_prefix + \"trial_idx\");\n      if (trial_idx !== null) this.state.trial_idx = trial_idx;\n      session.continued = false;\n    }\n    else {\n      const practice_sequence = randomSequence(this.button_idxs, this.practice_trials_count);\n      const test_sequence = randomSequence(this.button_idxs, this.test_trails_count);\n      this.sequence = practice_sequence.concat(test_sequence);\n      ls.set(this.ls_prefix + \"sequence\", this.sequence);\n      ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx);\n    }\n\n    console.log(\"Pretest sequence:\");\n    console.log(this.sequence);\n    this.response_start = new Date();\n  }\n\n  render() {\n    const that = this;\n    const target_btn = this.sequence[this.state.trial_idx];\n\n    const nextTrial = (selection) => {\n      if (this.state.trial_idx+1 > this.practice_trials_count) {\n        // save trial data\n        const correct = selection === target_btn;\n        const td = {\n          time: new Date().toString(),\n          correct: correct,\n          response_time: new Date() - that.response_start,\n          session_number: 0,\n        };\n        that.data.trials.push(td);\n        ls.set(\"data\", that.data);\n      }\n\n      if (this.state.trial_idx < that.practice_trials_count + that.test_trails_count - 1) {\n        that.setState({trial_idx: this.state.trial_idx + 1});\n        that.response_start = new Date();\n        ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx+1);\n      }\n      else {\n        that.next();\n      }\n    };\n    let labels = [null, null, null, null];\n    labels[target_btn] = <div className=\"pretestCircle\"></div>;\n    return (\n      <div className=\"container\">\n        <ButtonTable labels={labels} values={this.button_idxs} next={nextTrial} key={this.state.trial_idx}/>\n      </div>\n    );\n  }\n};\n\nclass TrainingExperiment extends React.Component {\n  conn = { // read/write connection details for google spreadsheet.\n    spreadsheet_id: '1D2s3D13ldvchzueCFWTkvH8kzhNBEMZzizPnjGQnhMY',\n    api_key: 'AIzaSyDHFHbGy_GhEt1Q4FW61YYEX2jk3hZcSoQ',\n    write_url: 'https://script.google.com/macros/s/AKfycbxv6Uc9VsHlKI6SMe6YmH-MELryrJYvYg-uQnGFhyMF2X7zyC-O/exec',\n  }\n\n  steps = {\n    INTRO: 1,\n    INFO: 2, \n    PRETEST_INFO: 3,\n    PRETEST: 4,\n    LESSON: 5,\n    TRAINING: 6,\n    FINISH: 7\n  }\n\n  state = {\n    step: 1,\n    is_loading_session: true, // true until session data is received.\n    did_check_user_registered: false, // false until sheet list is received.\n    done_saving: false, // false until the data is saved to the spreadsheet.\n    max_sessions_reached: false,\n    session_done_for_today: false,\n    user_unregistered: true,\n    did_load_registration_list: false,\n    did_load_lesson_type: false,\n  };\n\n  data = {\n    id: undefined,\n    trials: [],\n  };\n\n  maybe_start_session = () => {\n    // Check previous sessions data. Start a new session accordingly\n    // or enforce session limits.\n    let session = {id: this.data.id};\n    const previous_sessions = this.sessions.filter(e => e.id === session.id);\n    if (previous_sessions.length === 0) {\n      // First session\n      ls.clear();\n      session.number = 1;\n      this.setState({did_load_lesson_type: false});\n      readLessonType(this.conn, session.id)\n        .then(lesson_type => {\n          if (lesson_type === -1)\n            this.setState({session: session, \n                           user_unregistered: true,\n                           did_load_lesson_type: true});\n          else {\n            session.lesson_type = lesson_type;\n            writeSessionEvent(this.conn, session, \n                              SessionEvent.SESSION_START);\n            \n            this.setState({session: session,\n                           did_load_lesson_type: true});\n          }\n\n        })\n        .catch(err => { alert(\"Error while reading lessons: \" + err); });\n    }\n    else {\n      // Not first session\n      const last_session = previous_sessions[previous_sessions.length-1];\n      const last_session_number = parseInt(last_session.number);\n      \n      session.lesson_type = parseInt(last_session.lesson_type);\n      if (last_session.event !== SessionEvent.SESSION_END) {\n        // The last session for this subject id isn't finished.\n        if (was_last_session_today(last_session)) {\n          // Same day. Try to continue the last session.\n          session.number = last_session_number;\n          // Retreive session and data from local storage.\n          console.log(\"Loading session data from local storage.\");\n          const continued_session = ls.get('session');\n          if (continued_session && continued_session.id === session.id) {\n            writeSessionEvent(this.conn, session, \n                              SessionEvent.SESSION_CONTINUED, this.sessionEventError);\n            session = continued_session;\n            const continued_data = ls.get('data');\n            if (continued_data) {\n              console.log(\"Loading experiment data from local storage.\");\n              this.data = continued_data;\n            }\n            \n            const continued_step = ls.get('step');\n            \n            session.continued = true;\n            this.setState({step: continued_step || this.steps.INFO,\n                           session: session});\n            this.stepChanged(continued_step);\n          } \n          else {\n            // Can't continue session. Start a new one if possible. \n            ls.clear();\n            if (last_session_number >= MAX_NUMBER_OF_SESSIONS) {\n              // enforce the session limit.\n              this.setState({max_sessions_reached: true,\n                             session: session});\n            } \n            else {\n              // Continue to next session. \n              // TODO: should this automatically add another lesson? or just use the same session number?\n              session.number = last_session_number + 1;\n              writeSessionEvent(this.conn, session, \n                                SessionEvent.SESSION_START);\n            this.setState({session: session});\n            }            \n          }\n        }\n        else {\n          // A new day. TODO: what happens when max session reached on unfinished session?\n          ls.clear();\n          if (last_session_number >= MAX_NUMBER_OF_SESSIONS) {\n            // enforce the session limit.\n            this.setState({max_sessions_reached: true,\n                           session: session});\n          } \n          else {\n            // Continue to next session. \n            // TODO: should this automatically add another lesson? or just use the same session number?\n            session.number = last_session_number + 1;\n            writeSessionEvent(this.conn, session, \n                              SessionEvent.SESSION_START);\n            this.setState({session: session});\n          }\n        }\n      }\n      else {\n        // The last session was finished. \n        ls.clear();\n        if (last_session_number >= MAX_NUMBER_OF_SESSIONS) {\n          // enforce the session limit.\n          this.setState({max_sessions_reached: true,\n                         session: session});\n        }\n        else {\n          if (!was_last_session_today(last_session)) {\n            // Start a new session\n            session.number = last_session_number + 1;\n            writeSessionEvent(this.conn, session, \n                              SessionEvent.SESSION_START);\n            this.setState({session: session});\n          }\n          else {\n            // No more sessions for today.\n            this.setState({session_done_for_today: true,\n                           session: session});\n          }\n        }\n      }\n    }\n  }\n\n  nextStep = () => {\n    const { step } = this.state;\n    let new_step;\n\n    // jump over pretest after the 1st session.\n    if (this.state.session && this.state.session.number && \n        this.state.session.number !== 1 && (step + 1 === this.steps.PRETEST_INFO || step + 1 === this.steps.PRETEST)) \n      new_step = this.steps.LESSON;\n    else \n      new_step = step + 1;\n\n    if (step > 1) // otherwise the key will be overwritten before loading.\n      ls.set('step', new_step);\n    this.stepWillChange(step, new_step);\n    this.setState({\n      step: new_step\n    });\n    this.stepChanged(new_step);\n  }\n\n  stepWillChange = (step, new_step) => {\n    if (step === this.steps.INTRO) {\n      does_user_sheet_exists(this.conn, this.data.id)\n        .then((sheet_exists) => { \n          this.setState({did_load_registration_list: true});\n          if (sheet_exists) {\n            this.setState({user_unregistered: false});\n            this.maybe_start_session(); \n          }\n          else this.setState({user_unregistered: true, session: {}});\n        }).catch(this.sessionDataLoadError);\n    }\n  } \n\n  stepChanged = (step) => {   \n    if (step === this.steps.FINISH) {\n      // end of session. \n      this.data.end_time = new Date().toString();\n\n      // write data\n      console.log(\"Saving data...\");\n      console.log(this.data.trials);\n\n      this.data.trials.forEach(t => { \n        t.id = this.data.id;\n        if (t.session_number === undefined)\n          t.session_number = this.state.session.number;\n        t.start_time = this.data.start_time;\n        t.end_time = this.data.end_time;\n      });\n\n      let that = this;\n      gs.write(this.conn, this.data.id, this.data.trials)\n        .then(res => { that.setState({done_saving: true});\n                       ls.clear(); })\n        .catch(this.dataSaveError);\n\n      // write session ended event\n      writeSessionEvent(this.conn, this.state.session, \n                        SessionEvent.SESSION_END, this.sessionEventError);\n      // TODO: need to make sure both writes finished before setting done_saving: true!\n\n      // clear session from local storage. TODO: also do this only after both saves are done.\n\n    }\n  }\n\n  dataSaveError = (response) => {\n    alert(\"Error while saving data: \" + response);\n  }\n\n  sessionEventError = (response) => { // TODO\n    alert(\"Error while writing session event.\");\n  }\n\n  sessionDataLoaded = (session_data) => {\n    this.setState({ is_loading_session: false });\n    this.sessions = session_data;\n  }\n\n  sessionDataLoadError = (response) => { // TODO\n    // ask to refresh the page, try again... contact info?\n    alert(\"Session data load error: \" + response);\n  }\n\n  componentDidMount() {\n    // read session data\n    var that = this;\n    \n    readSessionData(this.conn)\n      .then(that.sessionDataLoaded)\n      .catch(that.sessionDataLoadError);\n\n    this.data.start_time = new Date().toString();\n  }\n\n  getScreenForStep(step) {\n    let screen;\n    switch(step) {\n      case this.steps.INTRO:\n        screen = <IntroScreen data={this.data} next={this.nextStep} />;\n        break;\n      case this.steps.INFO:\n        this.state.session.continued = false;\n        const info = <InfoText lesson_type={this.state.session.lesson_type} />;\n        screen = <InfoScreen info={info} next={this.nextStep}/>;\n        break;\n      case this.steps.PRETEST_INFO:\n        this.state.session.continued = false;\n        const pretest_info = <PretestInfo />;\n        screen = <InfoScreen info={pretest_info} next={this.nextStep} />;\n        break;\n      case this.steps.PRETEST:\n        screen = <PretestBlock data={this.data} next={this.nextStep} session={this.state.session} />;\n        break;\n      case this.steps.LESSON:\n        screen = <LessonBlock data={this.data} next={this.nextStep} session={this.state.session} />;\n        break;\n      case this.steps.TRAINING:\n        screen = <TrainingBlock data={this.data} next={this.nextStep} session={this.state.session} />;\n        break;\n      case this.steps.FINISH:\n        screen = <FinishScreen done_saving={this.state.done_saving} session_number={this.state.session.number} />;\n    }\n    \n    return screen;\n  } \n\n  render() {\n    const {step} = this.state;\n\n    let screen;\n\n    if (this.state.is_loading_session || !this.state.did_load_lesson_type)\n      screen = <LoadingScreen />;\n    if (this.state.step === 2) {\n      // After entering ID on the intro screen we check the session data before continuing.\n      if (!this.state.did_load_registration_list || !this.state.session) \n        screen = <LoadingScreen />;\n      else {\n        if (this.state.max_sessions_reached)\n          screen = <ErrorScreen error=\"עברת את מספר ההפעלות המותר.\" />;\n        else if (this.state.session_done_for_today)\n          screen = <ErrorScreen error=\"ביצעת כבר הפעלה אחת של התוכנה היום. ניתן להתחבר שוב מחר.\" />;\n        else if (this.state.did_load_registration_list && this.state.user_unregistered)\n          screen = <ErrorScreen error=\"מספר הנבדק לא קיים במערכת! אנא צור קשר עם הנסיינית ונסה שוב.\" />;\n        else screen = this.getScreenForStep(step);\n      }\n    }\n    else screen = this.getScreenForStep(step);\n\n    return screen;\n  }\n}\n\nexport default TrainingExperiment;\n","import React from 'react';\nimport { Button, ContinueButton, ButtonTable } from '../ui.js';\nimport ls from 'local-storage';\nimport { randomSequence } from '../randomize.js';\n\nconst PretestTrial = ({button_labels, next, trial_idx, trial_chord}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"overlay-box\"><p>{trial_chord}</p></div>\n      <div className=\"row\">\n        <ButtonTable labels={button_labels} values={button_labels} next={next} key={trial_idx} />\n      </div>\n    </div>    \n\n  );\n};\n\nconst ContinueScreen = ({next, on_keep_going}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col text-center\">\n          <p>האם ברצונך להמשיך בתרגול היבש?</p>\n        </div>\n      </div>\n      <br/>\n      <div className=\"row\">\n        <div className=\"col-sm-2 offset-sm-4 text-center\">\n          <Button label=\"כן\" onClick={on_keep_going}/>\n        </div>      \n        <div className=\"col-sm-2 text-center\">\n          <Button label=\"לא\" onClick={next}/>\n        </div>\n      </div>            \n    </div>\n  );\n};\n\nexport class PretestBlock extends React.Component {\n  state = {\n    trial_idx: 0,\n    keep_going: false,\n  }\n\n  trials_count = 14;\n\n  ls_prefix = \"test_pretest_\";\n\n  constructor({data, next, button_labels}) {\n    super();\n    this.data = data;\n    this.next = next;\n    this.button_labels = button_labels;\n    \n    const cont_trial_idx = ls.get(this.ls_prefix + \"trial_idx\");\n    if (cont_trial_idx) {\n      this.sequence = ls.get(this.ls_prefix + \"sequence\");\n      this.state.trial_idx = cont_trial_idx;\n    }\n    else {\n      this.sequence = randomSequence(button_labels, this.trials_count);\n      ls.set(this.ls_prefix + \"sequence\", this.sequence);\n      ls.set(this.ls_prefix + \"trial_idx\", this.state.trial_idx);      \n    }\n    console.log(\"sequence:\");\n    console.log(this.sequence);\n  }\n\n  nextTrial = () => {\n    const { trial_idx } = this.state;\n    this.setState({trial_idx: trial_idx + 1,\n                   keep_going: false});\n    ls.set(this.ls_prefix + \"trial_idx\", trial_idx + 1);\n  }\n\n  keepGoing = () => {\n    this.sequence = randomSequence(this.button_labels, this.trials_count);\n    ls.set(this.ls_prefix + \"sequence\", this.sequence);      \n    console.log(\"sequence:\");\n    console.log(this.sequence);\n    this.setState({keep_going: true});\n  };\n  \n  render() {\n    const { trial_idx } = this.state;\n    if (trial_idx > 0 && this.state.keep_going === false && ((trial_idx) % this.trials_count === 0)) {\n      return <ContinueScreen next={this.next} on_keep_going={this.keepGoing} />;\n    }\n    else {\n      return <PretestTrial button_labels={this.button_labels} next={this.nextTrial} trial_idx={this.state.trial_idx} trial_chord={this.sequence[this.state.trial_idx % this.trials_count]}/>;\n    }\n  }\n}\n\n","import React from 'react';\nimport { ContinueButton } from '../ui.js';\n\nexport class SubtestsBlock extends React.Component {\n  constructor({data, next}) {\n    super();\n    this.data = data;\n    this.next = next;\n  }\n\n  render() { \n    return (\n      <div>\n        <p>SubtestsBlock</p>\n        <ContinueButton next={this.next}/>\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport { ContinueButton } from '../ui.js';\n\nexport class PersonalInfoScreen extends React.Component {\n  constructor({data, next}) {\n    super();\n    this.data = data;\n    this.next = next;\n  }\n\n  saveData = () => {\n    const age = document.getElementById('age').value;\n    if (!/^(0|[1-9]\\d*)$/.test(age)) {\n      alert(\"ערך הגיל שהכנסתם אינו חוקי.\");\n      return;\n    }\n\n    const genderMaleChecked = document.getElementById('male').checked;\n    const genderFemaleChecked = document.getElementById('female').checked;\n    if (!genderMaleChecked && !genderFemaleChecked) {\n      alert(\"אנא בחרו מין.\");\n      return;\n    }\n    const gender = genderMaleChecked ? 2 : 1;\n\n    const musical_background = document.getElementById('musical_background').value;\n\n    const big_maj_recognition = document.getElementById('big_maj_recognition').value;\n    const small_maj_recognition = document.getElementById('small_maj_recognition').value;\n    const small_min_recognition = document.getElementById('small_min_recognition').value;\n    const half_dim_recognition = document.getElementById('half_dim_recognition').value;\n    if (big_maj_recognition.length===0 || small_maj_recognition.length===0 ||\n        small_min_recognition.length===0 || half_dim_recognition.length===0) {\n      alert(\"אנא ענו על כל השאלות.\");\n      return;\n    }\n    this.data.trials.push({\n      age: age,\n      gender: gender,\n      musical_background: musical_background,\n      big_maj_recognition: big_maj_recognition,\n      small_maj_recognition: small_maj_recognition,\n      small_min_recognition: small_min_recognition,\n      half_dim_recognition: half_dim_recognition,\n    });\n\n    this.next();\n  }\n\n  render() { \n    return (\n      <div className=\"container\">\n        <div className=\"row\">\n          <div className=\"col-sm-6 offset-sm-3\">\n            <p>שאלון פרטים אישיים:</p>\n            <label htmlFor=\"age\">גיל:</label>\n            <input type=\"text\" id=\"age\" name=\"age\" maxlength=\"2\"/>\n            <br/>\n            <label htmlFor=\"gender\">מין:</label>\n            <label htmlFor=\"male\">זכר</label>\n            <input type=\"radio\" id=\"male\" name=\"gender\" value=\"male\"/>\n            <label htmlFor=\"female\">נקבה</label>\n            <input type=\"radio\" id=\"female\" name=\"gender\" value=\"female\"/>\n            <br/>\n            <label htmlFor=\"musical_background\">רקע מוזיקלי מוקדם:</label>\n            <select id=\"musical_background\" name=\"musical_background\">\n              <option value=\"1\">אין</option>\n              <option value=\"2\">ניגנתי פחות משנה</option>\n              <option value=\"3\">ניגנתי פחות משנתיים</option>\n            </select>\n            <label htmlFor=\"big_maj_recognition\">על סמך מה זיהית את אקורד \"מז'ור גדול\"?</label>\n            <textarea id=\"big_maj_recognition\" rows=\"4\" cols=\"50\"/>\n            <label htmlFor=\"small_maj_recognition\">על סמך מה זיהית את אקורד \"מז'ור קטן\"?</label>\n            <textarea id=\"small_maj_recognition\" rows=\"4\" cols=\"50\"/>\n            <label htmlFor=\"small_min_recognition\">על סמך מה זיהית את אקורד \"מינור קטן\"?</label>\n            <textarea id=\"small_min_recognition\" rows=\"4\" cols=\"50\"/>\n            <label htmlFor=\"half_dim_recognition\">על סמך מה זיהית את אקורד \"חצי מוקטן\"?</label>\n            <textarea id=\"half_dim_recognition\" rows=\"4\" cols=\"50\"/>            \n          </div>\n        </div>\n        <div className=\"row\">\n          <div className=\"col-sm-6 offset-sm-3 text-center\">\n            <ContinueButton next={this.saveData} />\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport '../Experiment.css';\nimport './TestExperiment.css';\nimport { InfoScreen, ContinueButton, ErrorScreen, LoadingScreen } from '../ui.js';\nimport { Chords } from '../defs.js';\nimport { PretestBlock } from './pretest.js';\nimport { SubtestsBlock } from './subtests.js';\nimport { PersonalInfoScreen } from './personal_info.js';\nimport ls from 'local-storage';\nimport { does_user_sheet_exists } from '../sessions.js';\nimport gs from '../spreadsheet_io.js';\nimport { shuffleArray } from '../randomize.js';\n\nconst LoginScreen = ({next, data}) => {\n  const handleContinue = () => {\n    data.id = document.getElementById('id_input').value;\n    next();\n  };\n\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col-md-8 offset-md-2 infotext\">\n          <p className=\"text-center\">תוכנת המבחן</p>\n          <p>\n            הכנס את מספר תעודת הזהות ולחץ על המשך כדי להתחיל.\n          </p>          \n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"col\"></div>\n        <div className=\"col text-center\">\n          <br/>\n          <label>ת\"ז: <input type=\"text\" id=\"id_input\"/><br/></label>\n          <p hidden>\"</p>\n          <br/>\n          <ContinueButton next={handleContinue} disabled={false} />            \n        </div>\n        <div className=\"col\"></div>\n      </div>      \n    </div>\n  );\n};\n\nconst FinishScreen = ({data, done_saving}) => {\n  return (\n    <div className=\"container\">\n      <div className=\"col-md-8 offset-md-2 finish-screen text-center\">\n        <h1>תודה רבה!</h1>\n        <p>{done_saving ? \"הנתונים נשמרו בהצלחה!\" : \"אנא המתן לשמירת הנתונים...\"}</p>\n      </div>\n    </div>\n  );\n};\n\nconst TestInfo = () => {\n  return (\n    <div>\n      <p>מיד תעברו למסך ובו ארבעה סוגי אקורדים: מז'ור גדול, מז'ור קטן, מינור קטן, וחצי מוקטן.</p>\n      <p>תחילה, תתבקשו לבצע ניסוי ללא קול: במרכז המסך יופיע אחד מסוגי האקורדים, ועליכם ללחוץ על סוג האקורד הזהה שבעיגול המקיף אותו.</p>\n      <p>לאחר מספר ניסיונות ללא קול, תעברו לשמיעת האקורדים.</p>\n      <p>לפני ההשמעה עליכם להניח את האצבע על סימן הפלוס שבאמצע המסך. יהיה עליכם לזהות את האקורד כמה שיותר מהר אך מבלי לוותר על דיוק. יהיה ניתן לשמוע את האקורד פעם אחת בלבד.</p>\n      <p>ברגע הזיהוי יש ללחוץ על סוג האקורד במהירות האפשרית.</p>\n      <p>בהצלחה!</p>\n    </div>\n  );\n};\n\nclass TestExperiment extends React.Component {\n  conn = { // read/write connection details for google spreadsheet.\n    spreadsheet_id: '1D2s3D13ldvchzueCFWTkvH8kzhNBEMZzizPnjGQnhMY',\n    api_key: 'AIzaSyDHFHbGy_GhEt1Q4FW61YYEX2jk3hZcSoQ',\n    write_url: 'https://script.google.com/macros/s/AKfycbxv6Uc9VsHlKI6SMe6YmH-MELryrJYvYg-uQnGFhyMF2X7zyC-O/exec',\n  }\n\n  ls_prefix = \"test_\";\n  sheet_suffix = \"-test\";\n\n  steps = {\n    LOGIN: 1,\n    INFO: 2,\n    PRETEST: 3,\n    SUB_TESTS: 4,\n    PERSONAL_INFO: 5,\n    FINISH: 6,\n  }\n\n  state = {\n    step: 1,\n    error: null,\n    loading: false,\n  }\n\n  data = {\n    id: undefined,\n    trials: [],\n  }\n\n  chord_button_labels = shuffleArray([Chords.BIG_MAJOR, Chords.SMALL_MAJOR, Chords.SMALL_MINOR, Chords.HALF_DIM]);\n\n  nextStep = () => {\n    const { step } = this.state;\n    const new_step = step + 1;\n\n    if (step > 1)\n      ls.set(this.ls_prefix + \"step\", new_step);\n\n    const altered_step = this.stepWillChange(step, new_step);\n    this.setState({step: altered_step || new_step});\n    this.stepChanged(new_step);\n  }\n\n  stepWillChange = (step, new_step) => {\n    if (step === this.steps.LOGIN) {\n      this.setState({loading: true});\n      does_user_sheet_exists(this.conn, this.data.id)\n        .then(sheet_exists => {\n          if (sheet_exists) {\n            this.setState({loading:false});\n          }\n          else {\n            this.setState({error: \"גיליון מבחן עבור נבדק \" + this.data.id + \" לא קיים במערכת.\",\n                           loading: false});\n          }\n\n        })\n        .catch(err => {\n          this.setState({error: \"לא ניתן להתחבר. בדקו את חיבור האינטרנט ונסו שוב. \" + err});\n        });\n\n      // try to recover from local storage\n      const cont_step = ls.get(this.ls_prefix + \"step\");\n      if (cont_step) {\n        console.log(\"Loading from local storage...\");\n        \n        const cont_data = ls.get(this.ls_prefix + \"data\");\n        if (cont_data) \n          this.data = cont_data;\n        \n        return cont_step;\n      }\n    }\n  }\n\n  stepChanged = (step) => {\n    if (step === this.steps.FINISH) {\n      this.data.end_time = new Date().toString();\n      console.log(\"Saving data...\");\n      console.log(this.data.trials);\n\n      this.data.trials.forEach(t => {\n        t.id = this.data.id;\n        t.start_time = this.data.start_time;\n        t.end_time = this.data.end_time;\n      });\n      \n      const that = this;\n      gs.write(this.conn, \"\" + this.data.id + this.sheet_suffix, this.data.trials)\n        .then(res => { \n          that.setState({done_saving: true});\n          ls.clear(); \n        })\n        .catch(this.dataSaveError);\n    }\n  }\n\n  dataSaveError(response) {\n    alert(\"Error while saving data: \" + response);\n  }\n\n  componentDidMount() {\n    this.data.start_time = new Date().toString();\n  }\n\n  render() {\n    const {step} = this.state;\n    console.log(\"rendering step \" + step);\n\n    if (this.state.error) {\n      return <ErrorScreen error={this.state.error} />;\n    } \n    else if (this.state.loading) {\n      return <LoadingScreen />;\n    } \n    else {\n      switch(step) {\n      case this.steps.LOGIN: \n        return <LoginScreen next={this.nextStep} data={this.data} />;\n      case this.steps.INFO:\n        const test_info = <TestInfo />;\n        return <InfoScreen info={test_info} next={this.nextStep} />;\n      case this.steps.PRETEST:\n        return <PretestBlock next={this.nextStep} button_labels={this.chord_button_labels} />;\n      case this.steps.SUB_TESTS:\n        return <SubtestsBlock next={this.nextStep} data={this.data} button_labels={this.chord_button_labels} />;\n      case this.steps.PERSONAL_INFO:\n        return <PersonalInfoScreen next={this.nextStep} data={this.data} />;\n      case this.steps.FINISH:\n        return <FinishScreen done_saving={this.state.done_saving} />;\n      default:\n        return <div>???</div>;\n      }\n    }\n  }\n}\n\nexport default TestExperiment;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport TrainingExperiment from './training_experiment/TrainingExperiment.js';\nimport TestExperiment from './test_experiment/TestExperiment.js';\nimport * as serviceWorker from './serviceWorker';\nimport { Switch, HashRouter, Route } from \"react-router-dom\";\n\nclass App extends React.Component {\n  render() {\n    return (\n      <HashRouter>\n        <Switch>\n          <Route exact path=\"/\"><TrainingExperiment/></Route>\n          <Route path=\"/test\"><TestExperiment/></Route>\n          <Route>הכתובת לא קיימת!</Route>\n        </Switch>\n      </HashRouter>\n    );\n  }\n}\n\nReactDOM.render(<App/>, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}